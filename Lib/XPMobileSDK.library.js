function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var logger={info:function(){console&&console.info(...arguments)},error:function(){console&&console.error(...arguments)},warn:function(){console&&console.warn(...arguments)},log:function(){console&&console.log(...arguments)},init:function(){XPMobileSDKSettings.EnableConsoleLog?"error"===XPMobileSDKSettings.EnableConsoleLog?(logger.log=function(){},logger.info=function(){},logger.warn=function(){}):"warn"===XPMobileSDKSettings.EnableConsoleLog&&(logger.log=function(){},logger.info=function(){}):(logger.log=function(){},logger.info=function(){},logger.error=function(){},logger.warn=function(){})}};for(logger.init(),"function"!=typeof Object.assign&&(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n}),function(){if(window.localStorage&&window.sessionStorage){var e,t=["sessionStorage","localStorage"];for(e in t)XPMobileSDK[t[e]]={storage:window[t[e]],setItem:function(e,t,n){n?(n={value:t,expiration:(new Date).getTime()+n},this.storage.setItem(e,"expiration::"+JSON.stringify(n))):"boolean"!=typeof t?"number"!=typeof t?"object"!=typeof t?this.storage.setItem(e,t):this.storage.setItem(e,"object::"+JSON.stringify(t)):this.storage.setItem(e,"number::"+t):this.storage.setItem(e,"boolean::"+t)},getItem:function(e){var t=this.storage.getItem(e);if(null==t)return null;if(0!=t.indexOf("expiration::"))return 0==t.indexOf("boolean::")?"boolean::true"==t:0==t.indexOf("number::")?parseFloat(t.substr(t.indexOf("::")+2)):0==t.indexOf("object::")?JSON.parse(t.substr(t.indexOf("::")+2)):t;t=JSON.parse(t.substr(t.indexOf("::")+2));return(new Date).getTime()>t.expiration?(this.storage.removeItem(e),null):t.value},removeItem:function(e){this.storage.removeItem(e)},clear:function(){this.storage.clear()},key:function(e){return this.storage.key(e)}}}}(),bpe=0,mask=0,radix=mask+1,digitsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\'\"+-",bpe=0;1<<bpe+1>1<<bpe;bpe++);function findPrimes(e){for(var t,n,r=new Array(e),o=0;o<e;o++)r[o]=0;for(r[0]=2,t=0;r[t]<e;){for(o=r[t]*r[t];o<e;o+=r[t])r[o]=1;for(r[++t]=r[t-1]+1;r[t]<e&&r[r[t]];r[t]++);}for(n=new Array(t),o=0;o<t;o++)n[o]=r[o];return n}function millerRabinInt(e,t){return mr_x1.length!=e.length&&(mr_x1=dup(e),mr_r=dup(e),mr_a=dup(e)),copyInt_(mr_a,t),millerRabin(e,mr_a)}function millerRabin(e,t){var n,r,o,i;for(mr_x1.length!=e.length&&(mr_x1=dup(e),mr_r=dup(e),mr_a=dup(e)),copy_(mr_a,t),copy_(mr_r,e),copy_(mr_x1,e),addInt_(mr_r,-1),addInt_(mr_x1,-1),n=o=0;n<mr_r.length;n++)for(r=1;r<mask;r<<=1)e[n]&r?(i=o<mr_r.length+bpe?o:0,n=mr_r.length,r=mask):o++;if(i&&rightShift_(mr_r,i),powMod_(mr_a,mr_r,e),!equalsInt(mr_a,1)&&!equals(mr_a,mr_x1)){for(r=1;r<=i-1&&!equals(mr_a,mr_x1);){if(squareMod_(mr_a,e),equalsInt(mr_a,1))return 0;r++}if(!equals(mr_a,mr_x1))return 0}return 1}function bitSize(e){for(var t,n,r=e.length-1;0==e[r]&&0<r;r--);for(t=0,n=e[r];n;n>>=1,t++);return t+=bpe*r}function expand(e,t){t=int2bigInt(0,(e.length>t?e.length:t)*bpe,0);return copy_(t,e),t}function randTruePrime(e){var t=int2bigInt(0,e,0);return randTruePrime_(t,e),trim(t,1)}function randProbPrime(e){return randProbPrimeRounds(e,600<=e?2:550<=e?4:500<=e?5:400<=e?6:350<=e?7:300<=e?9:250<=e?12:200<=e?15:150<=e?18:100<=e?27:40)}function randProbPrimeRounds(e,t){var n,r,o=int2bigInt(0,e,0);for(0==primes.length&&(primes=findPrimes(3e4)),rpprb.length!=o.length&&(rpprb=dup(o));;){for(randBigInt_(o,e,0),o[0]|=1,n=r=0;n<primes.length&&primes[n]<=3e4;n++)if(0==modInt(o,primes[n])&&!equalsInt(o,primes[n])){r=1;break}for(n=0;n<t&&!r;n++){for(randBigInt_(rpprb,e,0);!greater(o,rpprb);)randBigInt_(rpprb,e,0);millerRabin(o,rpprb)||(r=1)}if(!r)return o}}function mod(e,t){e=dup(e);return mod_(e,t),trim(e,1)}function addInt(e,t){e=expand(e,e.length+1);return addInt_(e,t),trim(e,1)}function mult(e,t){e=expand(e,e.length+t.length);return mult_(e,t),trim(e,1)}function powMod(e,t,n){e=expand(e,n.length);return powMod_(e,trim(t,2),trim(n,2),0),trim(e,1)}function sub(e,t){e=expand(e,e.length>t.length?e.length+1:t.length+1);return sub_(e,t),trim(e,1)}function add(e,t){e=expand(e,e.length>t.length?e.length+1:t.length+1);return add_(e,t),trim(e,1)}function inverseMod(e,t){e=expand(e,t.length);return inverseMod_(e,t)?trim(e,1):null}function multMod(e,t,n){e=expand(e,n.length);return multMod_(e,t,n),trim(e,1)}function randTruePrime_(e,t){var n,r,o,i,s,a,c,l,u;if(0==primes.length&&(primes=findPrimes(3e4)),0==pows.length)for(pows=new Array(512),o=0;o<512;o++)pows[o]=Math.pow(2,o/511-1);if(recLimit=20,s_i2.length!=e.length&&(s_i2=dup(e),s_R=dup(e),s_n1=dup(e),s_r2=dup(e),s_d=dup(e),s_x1=dup(e),s_x2=dup(e),s_b=dup(e),s_n=dup(e),s_i=dup(e),s_rm=dup(e),s_q=dup(e),s_a=dup(e),s_aa=dup(e)),t<=recLimit){for(n=(1<<(t+2>>1))-1,copyInt_(e,0),r=1;r;)for(e[r=0]=1|1<<t-1|Math.floor(Math.random()*(1<<t)),o=1;o<primes.length&&(primes[o]&n)==primes[o];o++)if(0==e[0]%primes[o]){r=1;break}carry_(e)}else{if(s=.1*t*t,40<t)for(i=1;t-t*i<=20;)i=pows[Math.floor(512*Math.random())];else i=.5;for(u=Math.floor(i*t)+1,randTruePrime_(s_q,u),copyInt_(s_i2,0),s_i2[Math.floor((t-2)/bpe)]|=1<<(t-2)%bpe,divide_(s_i2,s_q,s_i,s_rm),c=bitSize(s_i);;){for(;randBigInt_(s_R,c,0),!greater(s_i,s_R););for(addInt_(s_R,1),add_(s_R,s_i),copy_(s_n,s_q),mult_(s_n,s_R),multInt_(s_n,2),addInt_(s_n,1),copy_(s_r2,s_R),multInt_(s_r2,2),o=a=0;o<primes.length&&primes[o]<s;o++)if(0==modInt(s_n,primes[o])&&!equalsInt(s_n,primes[o])){a=1;break}if(!(a=!a&&!millerRabinInt(s_n,2)?1:a)){for(addInt_(s_n,-3),o=s_n.length-1;0==s_n[o]&&0<o;o--);for(l=0,w=s_n[o];w;w>>=1,l++);for(l+=bpe*o;randBigInt_(s_a,l,0),!greater(s_n,s_a););if(addInt_(s_n,3),addInt_(s_a,2),copy_(s_b,s_a),copy_(s_n1,s_n),addInt_(s_n1,-1),powMod_(s_b,s_n1,s_n),addInt_(s_b,-1),isZero(s_b)&&(copy_(s_b,s_a),powMod_(s_b,s_r2,s_n),addInt_(s_b,-1),copy_(s_aa,s_n),copy_(s_d,s_b),GCD_(s_d,s_n),equalsInt(s_d,1)))return void copy_(e,s_aa)}}}}function randBigInt(e,t){var n=int2bigInt(0,0,Math.floor((e-1)/bpe)+2);return randBigInt_(n,e,t),n}function randBigInt_(e,t,n){for(var r,o=0;o<e.length;o++)e[o]=0;for(r=Math.floor((t-1)/bpe)+1,o=0;o<r;o++)e[o]=Math.floor(Math.random()*(1<<bpe-1));e[r-1]&=(2<<(t-1)%bpe)-1,1==n&&(e[r-1]|=1<<(t-1)%bpe)}function GCD(e,t){e=dup(e);return GCD_(e,dup(t)),e}function GCD_(e,n){var r,o,i,s,a,c,l,u,d;for(T.length!=e.length&&(T=dup(e)),d=1;d;){for(d=0,r=1;r<n.length;r++)if(n[r]){d=1;break}if(!d)break;for(r=e.length;!e[r]&&0<=r;r--);for(o=e[r],i=n[r],c=a=0,l=s=1;i+c&&i+l&&(u=Math.floor((o+s)/(i+c)),qp=Math.floor((o+a)/(i+l)),u==qp);)t=s-u*c,s=c,c=t,t=a-u*l,a=l,l=t,t=o-u*i,o=i,i=t;a?(copy_(T,e),linComb_(e,n,s,a),linComb_(n,T,l,c)):(mod_(e,n),copy_(T,e),copy_(e,n),copy_(n,T))}if(0!=n[0])for(t=modInt(e,n[0]),copyInt_(e,n[0]),n[0]=t;n[0];)e[0]%=n[0],t=e[0],e[0]=n[0],n[0]=t}function inverseMod_(e,t){var n=1+2*Math.max(e.length,t.length);if(!(1&e[0]||1&t[0]))return copyInt_(e,0),0;for(eg_u.length!=n&&(eg_u=new Array(n),eg_v=new Array(n),eg_A=new Array(n),eg_B=new Array(n),eg_C=new Array(n),eg_D=new Array(n)),copy_(eg_u,e),copy_(eg_v,t),copyInt_(eg_A,1),copyInt_(eg_B,0),copyInt_(eg_C,0),copyInt_(eg_D,1);;){for(;!(1&eg_u[0]);)halve_(eg_u),1&eg_A[0]||1&eg_B[0]?(add_(eg_A,t),halve_(eg_A),sub_(eg_B,e)):halve_(eg_A),halve_(eg_B);for(;!(1&eg_v[0]);)halve_(eg_v),1&eg_C[0]||1&eg_D[0]?(add_(eg_C,t),halve_(eg_C),sub_(eg_D,e)):halve_(eg_C),halve_(eg_D);if(greater(eg_v,eg_u)?(sub_(eg_v,eg_u),sub_(eg_C,eg_A),sub_(eg_D,eg_B)):(sub_(eg_u,eg_v),sub_(eg_A,eg_C),sub_(eg_B,eg_D)),equalsInt(eg_u,0))return negative(eg_C)&&add_(eg_C,t),copy_(e,eg_C),equalsInt(eg_v,1)?1:(copyInt_(e,0),0)}}function inverseModInt(e,t){for(var n=1,r=0;;){if(1==e)return n;if(0==e)return 0;if(r-=n*Math.floor(t/e),1==(t%=e))return r;if(0==t)return 0;n-=r*Math.floor(e/t),e%=t}}function inverseModInt_(e,t){return inverseModInt(e,t)}function eGCD_(e,t,n,r,o){var i=0,s=Math.max(e.length,t.length);for(eg_u.length!=s&&(eg_u=new Array(s),eg_A=new Array(s),eg_B=new Array(s),eg_C=new Array(s),eg_D=new Array(s));!(1&e[0]||1&t[0]);)halve_(e),halve_(t),i++;for(copy_(eg_u,e),copy_(n,t),copyInt_(eg_A,1),copyInt_(eg_B,0),copyInt_(eg_C,0),copyInt_(eg_D,1);;){for(;!(1&eg_u[0]);)halve_(eg_u),1&eg_A[0]||1&eg_B[0]?(add_(eg_A,t),halve_(eg_A),sub_(eg_B,e)):halve_(eg_A),halve_(eg_B);for(;!(1&n[0]);)halve_(n),1&eg_C[0]||1&eg_D[0]?(add_(eg_C,t),halve_(eg_C),sub_(eg_D,e)):halve_(eg_C),halve_(eg_D);if(greater(n,eg_u)?(sub_(n,eg_u),sub_(eg_C,eg_A),sub_(eg_D,eg_B)):(sub_(eg_u,n),sub_(eg_A,eg_C),sub_(eg_B,eg_D)),equalsInt(eg_u,0))return negative(eg_C)&&(add_(eg_C,t),sub_(eg_D,e)),multInt_(eg_D,-1),copy_(r,eg_C),copy_(o,eg_D),void leftShift_(n,i)}}function negative(e){return e[e.length-1]>>bpe-1&1}function greaterShift(e,t,n){var r,o=e.length,i=t.length;for(k=o+n<i?o+n:i,r=i-1-n;r<o&&0<=r;r++)if(0<e[r])return 1;for(r=o-1+n;r<i;r++)if(0<t[r])return 0;for(r=k-1;n<=r;r--){if(e[r-n]>t[r])return 1;if(e[r-n]<t[r])return 0}return 0}function greater(e,t){for(var n=(e.length<t.length?e:t).length,r=e.length;r<t.length;r++)if(t[r])return 0;for(r=t.length;r<e.length;r++)if(e[r])return 1;for(r=n-1;0<=r;r--){if(e[r]>t[r])return 1;if(e[r]<t[r])return 0}return 0}function divide_(e,t,n,r){var o,i,s,a,c,l,u,d;for(copy_(r,e),i=t.length;0==t[i-1];i--);for(d=t[i-1],u=0;d;u++)d>>=1;for(leftShift_(t,u=bpe-u),leftShift_(r,u),o=r.length;0==r[o-1]&&i<o;o--);for(copyInt_(n,0);!greaterShift(t,r,o-i);)subShift_(r,t,o-i),n[o-i]++;for(s=o-1;i<=s;s--){for(r[s]==t[i-1]?n[s-i]=mask:n[s-i]=Math.floor((r[s]*radix+r[s-1])/t[i-1]);l=(c=(1<i?t[i-2]:0)*n[s-i])>>bpe,c&=mask,l=(a=l+n[s-i]*t[i-1])>>bpe,a&=mask,l==r[s]?a==r[s-1]?c>(1<s?r[s-2]:0):a>r[s-1]:l>r[s];)n[s-i]--;linCombShift_(r,t,-n[s-i],s-i),negative(r)&&(addShift_(r,t,s-i),n[s-i]--)}rightShift_(t,u),rightShift_(r,u)}function carry_(e){for(var t,n=e.length,r=0,o=0;o<n;o++)(r+=e[o])<(t=0)&&(r+=(t=-(r>>bpe))*radix),e[o]=r&mask,r=(r>>bpe)-t}function modInt(e,t){for(var n=0,r=e.length-1;0<=r;r--)n=(n*radix+e[r])%t;return n}function int2bigInt(e,t,n){t=Math.ceil(t/bpe)+1;return t=t<n?n:t,buff=new Array(t),copyInt_(buff,e),buff}function str2bigInt(e,t,n){var r,o,i,s,a,c=e.length;if(-1==t){for(i=new Array(0);;){for(s=new Array(i.length+1),o=0;o<i.length;o++)s[o+1]=i[o];if(s[0]=parseInt(e,10),i=s,(r=e.indexOf(",",0))<1)break;if(0==(e=e.substring(r+1)).length)break}return i.length<n?(copy_(s=new Array(n),i),s):i}for(i=int2bigInt(0,t*c,0),o=0;o<c&&(r=digitsStr.indexOf(e.substring(o,o+1),0),t<=36&&36<=r&&(r-=26),!(t<=r||r<0));o++)multInt_(i,t),addInt_(i,r);for(c=i.length;0<c&&!i[c-1];c--);for(c=c+1<n?n:c+1,s=new Array(c),a=c<i.length?c:i.length,o=0;o<a;o++)s[o]=i[o];for(;o<c;o++)s[o]=0;return s}function equalsInt(e,t){var n;if(e[0]!=t)return 0;for(n=1;n<e.length;n++)if(e[n])return 0;return 1}function equals(e,t){for(var n=(e.length<t.length?e:t).length,r=0;r<n;r++)if(e[r]!=t[r])return 0;if(e.length>t.length){for(;r<e.length;r++)if(e[r])return 0}else for(;r<t.length;r++)if(t[r])return 0;return 1}function isZero(e){for(var t=0;t<e.length;t++)if(e[t])return 0;return 1}function bigInt2str(e,t){var n,r,o="";if(s6.length!=e.length?s6=dup(e):copy_(s6,e),-1==t){for(n=e.length-1;0<n;n--)o+=e[n]+",";o+=e[0]}else for(;!isZero(s6);)r=divInt_(s6,t),o=digitsStr.substring(r,r+1)+o;return o=0==o.length?"0":o}function dup(e){return buff=new Array(e.length),copy_(buff,e),buff}function copy_(e,t){for(var n=(e.length<t.length?e:t).length,r=0;r<n;r++)e[r]=t[r];for(r=n;r<e.length;r++)e[r]=0}function copyInt_(e,t){for(var n=t,r=0;r<e.length;r++)e[r]=n&mask,n>>=bpe}function addInt_(e,t){var n,r,o,i;for(e[0]+=t,r=e.length,n=o=0;n<r;n++)if((o+=e[n])<(i=0)&&(o+=(i=-(o>>bpe))*radix),e[n]=o&mask,!(o=(o>>bpe)-i))return}function rightShift_(e,t){var n,r=Math.floor(t/bpe);if(r){for(n=0;n<e.length-r;n++)e[n]=e[n+r];for(;n<e.length;n++)e[n]=0;t%=bpe}for(n=0;n<e.length-1;n++)e[n]=mask&(e[n+1]<<bpe-t|e[n]>>t);e[n]>>=t}function halve_(e){for(var t=0;t<e.length-1;t++)e[t]=mask&(e[t+1]<<bpe-1|e[t]>>1);e[t]=e[t]>>1|e[t]&radix>>1}function leftShift_(e,t){var n,r=Math.floor(t/bpe);if(r){for(n=e.length;r<=n;n--)e[n]=e[n-r];for(;0<=n;n--)e[n]=0;t%=bpe}if(t){for(n=e.length-1;0<n;n--)e[n]=mask&(e[n]<<t|e[n-1]>>bpe-t);e[n]=mask&e[n]<<t}}function multInt_(e,t){var n,r,o,i;if(t)for(r=e.length,n=o=0;n<r;n++)(o+=e[n]*t)<(i=0)&&(o+=(i=-(o>>bpe))*radix),e[n]=o&mask,o=(o>>bpe)-i}function divInt_(e,t){for(var n,r=0,o=e.length-1;0<=o;o--)n=r*radix+e[o],e[o]=Math.floor(n/t),r=n%t;return r}function linComb_(e,t,n,r){for(var o=(e.length<t.length?e:t).length,i=e.length,s=0,a=0;a<o;a++)s+=n*e[a]+r*t[a],e[a]=s&mask,s>>=bpe;for(a=o;a<i;a++)s+=n*e[a],e[a]=s&mask,s>>=bpe}function linCombShift_(e,t,n,r){for(var o=e.length<r+t.length?e.length:r+t.length,i=e.length,s=0,a=r;a<o;a++)s+=e[a]+n*t[a-r],e[a]=s&mask,s>>=bpe;for(a=o;s&&a<i;a++)s+=e[a],e[a]=s&mask,s>>=bpe}function addShift_(e,t,n){for(var r=e.length<n+t.length?e.length:n+t.length,o=e.length,i=0,s=n;s<r;s++)i+=e[s]+t[s-n],e[s]=i&mask,i>>=bpe;for(s=r;i&&s<o;s++)i+=e[s],e[s]=i&mask,i>>=bpe}function subShift_(e,t,n){for(var r=e.length<n+t.length?e.length:n+t.length,o=e.length,i=0,s=n;s<r;s++)i+=e[s]-t[s-n],e[s]=i&mask,i>>=bpe;for(s=r;i&&s<o;s++)i+=e[s],e[s]=i&mask,i>>=bpe}function sub_(e,t){for(var n=(e.length<t.length?e:t).length,r=0,o=0;o<n;o++)r+=e[o]-t[o],e[o]=r&mask,r>>=bpe;for(o=n;r&&o<e.length;o++)r+=e[o],e[o]=r&mask,r>>=bpe}function add_(e,t){for(var n=(e.length<t.length?e:t).length,r=0,o=0;o<n;o++)r+=e[o]+t[o],e[o]=r&mask,r>>=bpe;for(o=n;r&&o<e.length;o++)r+=e[o],e[o]=r&mask,r>>=bpe}function mult_(e,t){var n;for(ss.length!=2*e.length&&(ss=new Array(2*e.length)),copyInt_(ss,0),n=0;n<t.length;n++)t[n]&&linCombShift_(ss,e,t[n],n);copy_(e,ss)}function mod_(e,t){s4.length!=e.length?s4=dup(e):copy_(s4,e),s5.length!=e.length&&(s5=dup(e)),divide_(s4,t,s5,e)}function multMod_(e,t,n){var r;for(s0.length!=2*e.length&&(s0=new Array(2*e.length)),copyInt_(s0,0),r=0;r<t.length;r++)t[r]&&linCombShift_(s0,e,t[r],r);mod_(s0,n),copy_(e,s0)}function squareMod_(e,t){for(var n,r,o,i,s=e.length;0<s&&!e[s-1];s--);for(i=s>t.length?2*s:2*t.length,s0.length!=i&&(s0=new Array(i)),copyInt_(s0,0),n=0;n<s;n++){for(o=s0[2*n]+e[n]*e[n],s0[2*n]=o&mask,o>>=bpe,r=n+1;r<s;r++)o=s0[n+r]+2*e[n]*e[r]+o,s0[n+r]=o&mask,o>>=bpe;s0[n+s]=o}mod_(s0,t),copy_(e,s0)}function trim(e,t){for(var n=e.length;0<n&&!e[n-1];n--);return copy_(t=new Array(n+t),e),t}function powMod_(e,t,n){var r,o,i,s;if(s7.length!=n.length&&(s7=dup(n)),0!=(1&n[0])){for(copyInt_(s7,0),i=n.length;0<i&&!n[i-1];i--);for(s=radix-inverseModInt(modInt(n,radix),radix),s7[i]=1,multMod_(e,s7,n),s3.length!=e.length?s3=dup(e):copy_(s3,e),r=t.length-1;0<r&!t[r];r--);if(0!=t[r]){for(o=1<<bpe-1;o&&!(t[r]&o);o>>=1);for(;;){if(!(o>>=1)){if(--r<0)return void mont_(e,one,n,s);o=1<<bpe-1}mont_(e,e,n,s),o&t[r]&&mont_(e,s3,n,s)}}else copyInt_(e,1)}else for(copy_(s7,e),copyInt_(e,1);!equalsInt(t,0);)1&t[0]&&multMod_(e,s7,n),divInt_(t,2),squareMod_(s7,n)}function mont_(e,t,n,r){var o,i,s,a,c,l,u=n.length,d=t.length;for(sa.length!=u&&(sa=new Array(u)),copyInt_(sa,0);0<u&&0==n[u-1];u--);for(;0<d&&0==t[d-1];d--);for(l=sa.length-1,o=0;o<u;o++){for(s=(c=sa[0]+e[o]*t[0])+(a=(c&mask)*r&mask)*n[0]>>bpe,c=e[o],i=1;i<d-4;)s+=sa[i]+a*n[i]+c*t[i],sa[i-1]=s&mask,s>>=bpe,i++,s+=sa[i]+a*n[i]+c*t[i],sa[i-1]=s&mask,s>>=bpe,i++,s+=sa[i]+a*n[i]+c*t[i],sa[i-1]=s&mask,s>>=bpe,i++,s+=sa[i]+a*n[i]+c*t[i],sa[i-1]=s&mask,s>>=bpe,i++,s+=sa[i]+a*n[i]+c*t[i],sa[i-1]=s&mask,s>>=bpe,i++;for(;i<d;)s+=sa[i]+a*n[i]+c*t[i],sa[i-1]=s&mask,s>>=bpe,i++;for(;i<u-4;)s+=sa[i]+a*n[i],sa[i-1]=s&mask,s>>=bpe,i++,s+=sa[i]+a*n[i],sa[i-1]=s&mask,s>>=bpe,i++,s+=sa[i]+a*n[i],sa[i-1]=s&mask,s>>=bpe,i++,s+=sa[i]+a*n[i],sa[i-1]=s&mask,s>>=bpe,i++,s+=sa[i]+a*n[i],sa[i-1]=s&mask,s>>=bpe,i++;for(;i<u;)s+=sa[i]+a*n[i],sa[i-1]=s&mask,s>>=bpe,i++;for(;i<l;)s+=sa[i],sa[i-1]=s&mask,s>>=bpe,i++;sa[i-1]=s&mask}greater(n,sa)||sub_(sa,n),copy_(e,sa)}bpe>>=1,mask=(1<<bpe)-1,radix=mask+1,one=int2bigInt(1,1,1),t=new Array(0),ss=t,s0=t,s1=t,s2=t,s3=t,s4=t,s5=t,s6=t,s7=t,T=t,sa=t,mr_x1=t,mr_r=t,mr_a=t,eg_v=t,eg_u=t,eg_A=t,eg_B=t,eg_C=t,eg_D=t,md_q1=t,md_q2=t,md_q3=t,md_r=t,md_r1=t,md_r2=t,md_tt=t,primes=t,pows=t,s_i=t,s_i2=t,s_R=t,s_rm=t,s_q=t,s_n1=t,s_a=t,s_r2=t,s_n=t,s_b=t,s_d=t,s_x1=t,s_x2=t,s_aa=t,rpprb=t;var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){for(var t,n,r,o,i,s,a="",c=0;c<e.length;)r=(s=e.charCodeAt(c++))>>2,o=(3&s)<<4|(t=e.charCodeAt(c++))>>4,i=(15&t)<<2|(n=e.charCodeAt(c++))>>6,s=63&n,isNaN(t)?i=s=64:isNaN(n)&&(s=64),a=a+this._keyStr.charAt(r)+this._keyStr.charAt(o)+this._keyStr.charAt(i)+this._keyStr.charAt(s);return a},encodeArray:function(e){for(var t,n,r,o,i,s,a="",c=0;c<e.length;)r=(s=e[c++])>>2,o=(3&s)<<4|(t=e[c++])>>4,i=(15&t)<<2|(n=e[c++])>>6,s=63&n,isNaN(t)?i=s=64:isNaN(n)&&(s=64),a=a+this._keyStr.charAt(r)+this._keyStr.charAt(o)+this._keyStr.charAt(i)+this._keyStr.charAt(s);return a},decode:function(e){var t,n,r,o,i,s,a="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)r=this._keyStr.indexOf(e.charAt(c++)),t=(15&(o=this._keyStr.indexOf(e.charAt(c++))))<<4|(i=this._keyStr.indexOf(e.charAt(c++)))>>2,n=(3&i)<<6|(s=this._keyStr.indexOf(e.charAt(c++))),a+=String.fromCharCode(r<<2|o>>4),64!=i&&(a+=String.fromCharCode(t)),64!=s&&(a+=String.fromCharCode(n));return a=Base64._utf8_decode(a)},decodeBinary:function(e,t){!function(){try{new Uint8Array(1);return}catch(e){}function r(e,t){return this.slice(e,t)}function o(e,t){arguments.length<2&&(t=0);for(var n=0,r=e.length;n<r;++n,++t)this[t]=255&e[n]}function e(e){if("number"==typeof e)for(var t=new Array(e),n=0;n<e;++n)t[n]=0;else t=e.slice(0);return t.subarray=r,(t.buffer=t).byteLength=t.length,t.set=o,"object"==typeof e&&e.buffer&&(t.buffer=e.buffer),t}window.Uint8Array=e,window.Uint32Array=e,window.Int32Array=e}();var n,r,o,i,s,a,c=this._keyStr.indexOf(e.charAt(e.length-1)),l=this._keyStr.indexOf(e.charAt(e.length-2)),u=e.length/4*3,u=parseInt(u);64==c&&u--,64==l&&u--;var d=0,f=0,h=t?new Uint8Array(t):new Uint8Array(u);for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),d=0;d<u;d+=3)o=this._keyStr.indexOf(e.charAt(f++)),n=(15&(i=this._keyStr.indexOf(e.charAt(f++))))<<4|(s=this._keyStr.indexOf(e.charAt(f++)))>>2,r=(3&s)<<6|(a=this._keyStr.indexOf(e.charAt(f++))),h[d]=o<<2|i>>4,64!=s&&(h[d+1]=n),64!=a&&(h[d+2]=r);return h},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(127<r&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){var t,n="",r=0;for(c1=c2=0;r<e.length;)(t=e.charCodeAt(r))<128?(n+=String.fromCharCode(t),r++):191<t&&t<224?(c2=e.charCodeAt(r+1),n+=String.fromCharCode((31&t)<<6|63&c2),r+=2):(c2=e.charCodeAt(r+1),c3=e.charCodeAt(r+2),n+=String.fromCharCode((15&t)<<12|(63&c2)<<6|63&c3),r+=3);return n}},CryptoJS=CryptoJS||function(a){function n(){}var e={},t=e.lib={},r=t.Base={extend:function(e){n.prototype=this;var t=new n;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=t.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||i).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var o=0;o<e;o++)t[r+o>>>2]|=(n[o>>>2]>>>24-o%4*8&255)<<24-(r+o)%4*8;else if(65535<n.length)for(o=0;o<e;o+=4)t[r+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),o=e.enc={},i=o.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var o=t[r>>>2]>>>24-r%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},s=o.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},l=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,r=t.sigBytes,o=this.blockSize,i=r/(4*o),i=e?a.ceil(i):a.max((0|i)-this._minBufferSize,0),r=a.min(4*(e=i*o),r);if(e){for(var s=0;s<e;s+=o)this._doProcessBlock(n,s);s=n.splice(0,e),t.sigBytes-=r}return new c.init(s,r)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});t.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new d.HMAC.init(n,t).finalize(e)}}});var d=e.algo={};return e}(Math);!function(){var e=CryptoJS,c=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var o=0;o<n;o+=3)for(var i=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<n;s++)e.push(r.charAt(i>>>6*(3-s)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;!(i=n.charAt(64))||-1!=(i=e.indexOf(i))&&(t=i);for(var r,o,i=[],s=0,a=0;a<t;a++)a%4&&(r=n.indexOf(e.charAt(a-1))<<a%4*2,o=n.indexOf(e.charAt(a))>>>6-a%4*2,i[s>>>2]|=(r|o)<<24-s%4*8,s++);return c.create(i,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(i){function I(e,t,n,r,o,i,s){return((e=e+(t&n|~t&r)+o+s)<<i|e>>>32-i)+t}function k(e,t,n,r,o,i,s){return((e=e+(t&r|n&~r)+o+s)<<i|e>>>32-i)+t}function P(e,t,n,r,o,i,s){return((e=e+(t^n^r)+o+s)<<i|e>>>32-i)+t}function D(e,t,n,r,o,i,s){return((e=e+(n^(t|~r))+o+s)<<i|e>>>32-i)+t}for(var e=CryptoJS,t=(r=e.lib).WordArray,n=r.Hasher,r=e.algo,E=[],o=0;o<64;o++)E[o]=4294967296*i.abs(i.sin(o+1))|0;r=r.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=e[o=t+n];e[o]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var n=this._hash.words,o=e[t+0],r=e[t+1],i=e[t+2],s=e[t+3],a=e[t+4],c=e[t+5],l=e[t+6],u=e[t+7],d=e[t+8],f=e[t+9],h=e[t+10],g=e[t+11],m=e[t+12],p=e[t+13],b=e[t+14],C=e[t+15],S=I(S=n[0],_=n[1],y=n[2],v=n[3],o,7,E[0]),v=I(v,S,_,y,r,12,E[1]),y=I(y,v,S,_,i,17,E[2]),_=I(_,y,v,S,s,22,E[3]),S=I(S,_,y,v,a,7,E[4]),v=I(v,S,_,y,c,12,E[5]),y=I(y,v,S,_,l,17,E[6]),_=I(_,y,v,S,u,22,E[7]),S=I(S,_,y,v,d,7,E[8]),v=I(v,S,_,y,f,12,E[9]),y=I(y,v,S,_,h,17,E[10]),_=I(_,y,v,S,g,22,E[11]),S=I(S,_,y,v,m,7,E[12]),v=I(v,S,_,y,p,12,E[13]),y=I(y,v,S,_,b,17,E[14]),S=k(S,_=I(_,y,v,S,C,22,E[15]),y,v,r,5,E[16]),v=k(v,S,_,y,l,9,E[17]),y=k(y,v,S,_,g,14,E[18]),_=k(_,y,v,S,o,20,E[19]),S=k(S,_,y,v,c,5,E[20]),v=k(v,S,_,y,h,9,E[21]),y=k(y,v,S,_,C,14,E[22]),_=k(_,y,v,S,a,20,E[23]),S=k(S,_,y,v,f,5,E[24]),v=k(v,S,_,y,b,9,E[25]),y=k(y,v,S,_,s,14,E[26]),_=k(_,y,v,S,d,20,E[27]),S=k(S,_,y,v,p,5,E[28]),v=k(v,S,_,y,i,9,E[29]),y=k(y,v,S,_,u,14,E[30]),S=P(S,_=k(_,y,v,S,m,20,E[31]),y,v,c,4,E[32]),v=P(v,S,_,y,d,11,E[33]),y=P(y,v,S,_,g,16,E[34]),_=P(_,y,v,S,b,23,E[35]),S=P(S,_,y,v,r,4,E[36]),v=P(v,S,_,y,a,11,E[37]),y=P(y,v,S,_,u,16,E[38]),_=P(_,y,v,S,h,23,E[39]),S=P(S,_,y,v,p,4,E[40]),v=P(v,S,_,y,o,11,E[41]),y=P(y,v,S,_,s,16,E[42]),_=P(_,y,v,S,l,23,E[43]),S=P(S,_,y,v,f,4,E[44]),v=P(v,S,_,y,m,11,E[45]),y=P(y,v,S,_,C,16,E[46]),S=D(S,_=P(_,y,v,S,i,23,E[47]),y,v,o,6,E[48]),v=D(v,S,_,y,u,10,E[49]),y=D(y,v,S,_,b,15,E[50]),_=D(_,y,v,S,c,21,E[51]),S=D(S,_,y,v,m,6,E[52]),v=D(v,S,_,y,s,10,E[53]),y=D(y,v,S,_,h,15,E[54]),_=D(_,y,v,S,r,21,E[55]),S=D(S,_,y,v,d,6,E[56]),v=D(v,S,_,y,C,10,E[57]),y=D(y,v,S,_,l,15,E[58]),_=D(_,y,v,S,p,21,E[59]),S=D(S,_,y,v,a,6,E[60]),v=D(v,S,_,y,g,10,E[61]),y=D(y,v,S,_,i,15,E[62]),_=D(_,y,v,S,f,21,E[63]);n[0]=n[0]+S|0,n[1]=n[1]+_|0,n[2]=n[2]+y|0,n[3]=n[3]+v|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32;var o=i.floor(n/4294967296);for(t[15+(64+r>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t[14+(64+r>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;n<4;n++)r=t[n],t[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.MD5=n._createHelper(r),e.HmacMD5=n._createHmacHelper(r)}(Math),function(){var e=CryptoJS,t=e.lib,n=t.Base,l=t.WordArray,r=(t=e.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(s=this.cfg).hasher.create(),r=l.create(),o=r.words,i=s.keySize,s=s.iterations;o.length<i;){a&&n.update(a);var a=n.update(e).finalize(t);n.reset();for(var c=1;c<s;c++)a=n.finalize(a),n.reset();r.concat(a)}return r.sigBytes=4*i,r}});e.EvpKDF=function(e,t,n){return r.create(n).compute(e,t)}}(),CryptoJS.lib.Cipher||function(){var e=(f=CryptoJS).lib,t=e.Base,s=e.WordArray,n=e.BufferedBlockAlgorithm,r=f.enc.Base64,o=f.algo.EvpKDF,i=e.Cipher=n.extend({cfg:t.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){n.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(r){return{encrypt:function(e,t,n){return("string"==typeof t?h:d).encrypt(r,e,t,n)},decrypt:function(e,t,n){return("string"==typeof t?h:d).decrypt(r,e,t,n)}}}});e.StreamCipher=i.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});function a(e,t,n){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var o=0;o<n;o++)e[t+o]^=r[o]}var c=f.mode={},l=(e.BlockCipherMode=t.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;a.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),l.Decryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,o=e.slice(t,t+r);n.decryptBlock(e,t),a.call(this,e,t,r),this._prevBlock=o}}),c=c.CBC=l,l=(f.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,r=(n=n-e.sigBytes%n)<<24|n<<16|n<<8|n,o=[],i=0;i<n;i+=4)o.push(r);n=s.create(o,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},e.BlockCipher=i.extend({cfg:i.cfg.extend({mode:c,padding:l}),reset:function(){i.reset.call(this);var e,t=(n=this.cfg).iv,n=n.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode=e.call(n,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var u=e.CipherParams=t.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),c=(f.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?s.create([1398893684,1701076831]).concat(e).concat(t):t).toString(r)},parse:function(e){var t,n=(e=r.parse(e)).words;return 1398893684==n[0]&&1701076831==n[1]&&(t=s.create(n.slice(2,4)),n.splice(0,4),e.sigBytes-=16),u.create({ciphertext:e,salt:t})}},d=e.SerializableCipher=t.extend({cfg:t.extend({format:c}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=e.createEncryptor(n,r);return t=o.finalize(t),o=o.cfg,u.create({ciphertext:t,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),f=(f.kdf={}).OpenSSL={execute:function(e,t,n,r){return r=r||s.random(8),e=o.create({keySize:t+n}).compute(e,r),n=s.create(e.words.slice(t),4*n),e.sigBytes=4*t,u.create({key:e,iv:n,salt:r})}},h=e.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:f}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=d.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,d.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,s=[],r=[],o=[],i=[],a=[],c=[],l=[],u=[],d=[],f=[],h=[],g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(var m=0,p=0,g=0;g<256;g++){var b=p^p<<1^p<<2^p<<3^p<<4;s[m]=b=b>>>8^255&b^99;var C=h[r[b]=m],S=h[C],v=h[S],y=257*h[b]^16843008*b;o[m]=y<<24|y>>>8,i[m]=y<<16|y>>>16,a[m]=y<<8|y>>>24,c[m]=y,l[b]=(y=16843009*v^65537*S^257*C^16843008*m)<<24|y>>>8,u[b]=y<<16|y>>>16,d[b]=y<<8|y>>>24,f[b]=y,m?(m=C^h[h[h[v^C]]],p^=h[h[p]]):m=p=1}var _=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=t.extend({_doReset:function(){for(var e,t=(r=this._key).words,n=r.sigBytes/4,r=4*((this._nRounds=n+6)+1),o=this._keySchedule=[],i=0;i<r;i++)i<n?o[i]=t[i]:(e=o[i-1],i%n?6<n&&4==i%n&&(e=s[e>>>24]<<24|s[e>>>16&255]<<16|s[e>>>8&255]<<8|s[255&e]):(e=s[(e=e<<8|e>>>24)>>>24]<<24|s[e>>>16&255]<<16|s[e>>>8&255]<<8|s[255&e],e^=_[i/n|0]<<24),o[i]=o[i-n]^e);for(t=this._invKeySchedule=[],n=0;n<r;n++)i=r-n,e=n%4?o[i]:o[i-4],t[n]=n<4||i<=4?e:l[s[e>>>24]]^u[s[e>>>16&255]]^d[s[e>>>8&255]]^f[s[255&e]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,i,a,c,s)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,u,d,f,r),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,o,i,s,a){for(var c=this._nRounds,l=e[t]^n[0],u=e[t+1]^n[1],d=e[t+2]^n[2],f=e[t+3]^n[3],h=4,g=1;g<c;g++)var m=r[l>>>24]^o[u>>>16&255]^i[d>>>8&255]^s[255&f]^n[h++],p=r[u>>>24]^o[d>>>16&255]^i[f>>>8&255]^s[255&l]^n[h++],b=r[d>>>24]^o[f>>>16&255]^i[l>>>8&255]^s[255&u]^n[h++],f=r[f>>>24]^o[l>>>16&255]^i[u>>>8&255]^s[255&d]^n[h++],l=m,u=p,d=b;m=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&f])^n[h++],p=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[f>>>8&255]<<8|a[255&l])^n[h++],b=(a[d>>>24]<<24|a[f>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^n[h++],f=(a[f>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^n[h++],e[t]=m,e[t+1]=p,e[t+2]=b,e[t+3]=f},keySize:8});e.AES=t._createHelper(n)}();CryptoJS=CryptoJS||function(a){function n(){}var e={},t=e.lib={},r=t.Base={extend:function(e){n.prototype=this;var t=new n;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=t.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||i).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var o=0;o<e;o++)t[r+o>>>2]|=(n[o>>>2]>>>24-o%4*8&255)<<24-(r+o)%4*8;else if(65535<n.length)for(o=0;o<e;o+=4)t[r+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),o=e.enc={},i=o.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var o=t[r>>>2]>>>24-r%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},s=o.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},l=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,r=t.sigBytes,o=this.blockSize,i=r/(4*o),i=e?a.ceil(i):a.max((0|i)-this._minBufferSize,0),r=a.min(4*(e=i*o),r);if(e){for(var s=0;s<e;s+=o)this._doProcessBlock(n,s);s=n.splice(0,e),t.sigBytes-=r}return new c.init(s,r)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});t.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new d.HMAC.init(n,t).finalize(e)}}});var d=e.algo={};return e}(Math);!function(o){function e(e){return 4294967296*(e-(0|e))|0}for(var t=CryptoJS,n=(i=t.lib).WordArray,r=i.Hasher,i=t.algo,s=[],g=[],a=2,c=0;c<64;){e:{for(var l=a,u=o.sqrt(l),d=2;d<=u;d++)if(!(l%d)){l=!1;break e}l=!0}l&&(c<8&&(s[c]=e(o.pow(a,.5))),g[c]=e(o.pow(a,1/3)),c++),a++}var m=[],i=i.SHA256=r.extend({_doReset:function(){this._hash=new n.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n,r,o=this._hash.words,i=o[0],s=o[1],a=o[2],c=o[3],l=o[4],u=o[5],d=o[6],f=o[7],h=0;h<64;h++)h<16?m[h]=0|e[t+h]:(n=m[h-15],r=m[h-2],m[h]=((n<<25|n>>>7)^(n<<14|n>>>18)^n>>>3)+m[h-7]+((r<<15|r>>>17)^(r<<13|r>>>19)^r>>>10)+m[h-16]),n=f+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&u^~l&d)+g[h]+m[h],r=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&s^i&a^s&a),f=d,d=u,u=l,l=c+n|0,c=a,a=s,s=i,i=n+r|0;o[0]=o[0]+i|0,o[1]=o[1]+s|0,o[2]=o[2]+a|0,o[3]=o[3]+c|0,o[4]=o[4]+l|0,o[5]=o[5]+u|0,o[6]=o[6]+d|0,o[7]=o[7]+f|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(64+r>>>9<<4)]=o.floor(n/4294967296),t[15+(64+r>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(i),t.HmacSHA256=r._createHmacHelper(i)}(Math);CryptoJS=CryptoJS||function(a){function n(){}var e={},t=e.lib={},r=t.Base={extend:function(e){n.prototype=this;var t=new n;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=t.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||i).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var o=0;o<e;o++)t[r+o>>>2]|=(n[o>>>2]>>>24-o%4*8&255)<<24-(r+o)%4*8;else if(65535<n.length)for(o=0;o<e;o+=4)t[r+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),o=e.enc={},i=o.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var o=t[r>>>2]>>>24-r%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},s=o.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},l=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,r=t.sigBytes,o=this.blockSize,i=r/(4*o),i=e?a.ceil(i):a.max((0|i)-this._minBufferSize,0),r=a.min(4*(e=i*o),r);if(e){for(var s=0;s<e;s+=o)this._doProcessBlock(n,s);s=n.splice(0,e),t.sigBytes-=r}return new c.init(s,r)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});t.Hasher=u.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new d.HMAC.init(n,t).finalize(e)}}});var d=e.algo={};return e}(Math);!function(){var e=CryptoJS,t=e.lib,o=t.Base,i=t.WordArray;(e=e.x64={}).Word=o.extend({init:function(e,t){this.high=e,this.low=t}}),e.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var o=e[r];n.push(o.high),n.push(o.low)}return i.create(n,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}})}(),function(){function e(){return r.create.apply(r,arguments)}for(var t=CryptoJS,n=t.lib.Hasher,r=(i=t.x64).Word,o=i.WordArray,i=t.algo,te=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],ne=[],s=0;s<80;s++)ne[s]=e();i=i.SHA512=n.extend({_doReset:function(){this._hash=new o.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=(l=this._hash.words)[0],r=l[1],o=l[2],i=l[3],s=l[4],a=l[5],c=l[6],l=l[7],u=n.high,d=n.low,f=r.high,h=r.low,g=o.high,m=o.low,p=i.high,b=i.low,C=s.high,S=s.low,v=a.high,y=a.low,_=c.high,I=c.low,k=l.high,P=l.low,D=u,E=d,M=f,w=h,T=g,A=m,x=p,B=b,K=C,R=S,X=v,O=y,N=_,F=I,q=k,L=P,V=0;V<80;V++){var H,z=ne[V];V<16?(H=z.high=0|e[t+2*V],W=z.low=0|e[t+2*V+1]):(H=((W=(H=ne[V-15]).high)>>>1|(Y=H.low)<<31)^(W>>>8|Y<<24)^W>>>7,Y=(Y>>>1|W<<31)^(Y>>>8|W<<24)^(Y>>>7|W<<25),Q=((W=(Q=ne[V-2]).high)>>>19|(U=Q.low)<<13)^(W<<3|U>>>29)^W>>>6,U=(U>>>19|W<<13)^(U<<3|W>>>29)^(U>>>6|W<<26),G=(W=ne[V-7]).high,ee=(j=ne[V-16]).high,j=j.low,H=(H=(H=H+G+((W=Y+W.low)>>>0<Y>>>0?1:0))+Q+((W=W+U)>>>0<U>>>0?1:0))+ee+((W=W+j)>>>0<j>>>0?1:0),z.high=H,z.low=W);var U,W,G=K&X^~K&N,j=R&O^~R&F,z=D&M^D&T^M&T,J=E&w^E&A^w&A,Y=(D>>>28|E<<4)^(D<<30|E>>>2)^(D<<25|E>>>7),Q=(E>>>28|D<<4)^(E<<30|D>>>2)^(E<<25|D>>>7),Z=(U=te[V]).high,$=U.low,ee=q+((K>>>14|R<<18)^(K>>>18|R<<14)^(K<<23|R>>>9))+((U=L+((R>>>14|K<<18)^(R>>>18|K<<14)^(R<<23|K>>>9)))>>>0<L>>>0?1:0),q=N,L=F,N=X,F=O,X=K,O=R,K=x+(ee=(ee=(ee=ee+G+((U=U+j)>>>0<j>>>0?1:0))+Z+((U=U+$)>>>0<$>>>0?1:0))+H+((U=U+W)>>>0<W>>>0?1:0))+((R=B+U|0)>>>0<B>>>0?1:0)|0,x=T,B=A,T=M,A=w,M=D,w=E,D=ee+(z=Y+z+((W=Q+J)>>>0<Q>>>0?1:0))+((E=U+W|0)>>>0<U>>>0?1:0)|0}d=n.low=d+E,n.high=u+D+(d>>>0<E>>>0?1:0),h=r.low=h+w,r.high=f+M+(h>>>0<w>>>0?1:0),m=o.low=m+A,o.high=g+T+(m>>>0<A>>>0?1:0),b=i.low=b+B,i.high=p+x+(b>>>0<B>>>0?1:0),S=s.low=S+R,s.high=C+K+(S>>>0<R>>>0?1:0),y=a.low=y+O,a.high=v+X+(y>>>0<O>>>0?1:0),I=c.low=I+F,c.high=_+N+(I>>>0<F>>>0?1:0),P=l.low=P+L,l.high=k+q+(P>>>0<L>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(128+r>>>10<<5)]=Math.floor(n/4294967296),t[31+(128+r>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=n._createHelper(i),t.HmacSHA512=n._createHmacHelper(i)}(),XPMobileSDK.library.SecureString={sharedKey:null,encrypt:function(e){var t=this.generateKey(),n={iv:CryptoJS.lib.WordArray.random(16)};Settings.DefaultEncryptionPadding&&CryptoJS.pad[Settings.DefaultEncryptionPadding]&&(n.padding=CryptoJS.pad[Settings.DefaultEncryptionPadding]);n=CryptoJS.AES.encrypt(e,CryptoJS.SHA256(t),n);return n.iv.toString(CryptoJS.enc.Base64)+":"+n.ciphertext.toString(CryptoJS.enc.Base64)},decrypt:function(e){var t,n,r="";return-1<e.indexOf(":")&&(t=this.generateKey(),n=e.split(":"),e=CryptoJS.enc.Base64.parse(n[0]),n=CryptoJS.enc.Base64.parse(n[1]),e={iv:e},Settings.DefaultEncryptionPadding&&CryptoJS.pad[Settings.DefaultEncryptionPadding]&&(e.padding=CryptoJS.pad[Settings.DefaultEncryptionPadding]),r=CryptoJS.AES.decrypt({ciphertext:n},CryptoJS.SHA256(t),e),r=CryptoJS.enc.Utf8.stringify(r)),r},generateKey:function(){var e="";return this.sharedKey?e=this.sharedKey:XPMobileSDK.library.Connection.dh?e=this.sharedKey=XPMobileSDK.library.Connection.dh.getSharedKey().toUpperCase():XPMobileSDK.library.CHAP.sharedKey&&(e=this.sharedKey=XPMobileSDK.library.CHAP.sharedKey.toUpperCase()),e}},XPMobileSDK.library.CHAP={challenges:[],sharedKey:"",minChallenges:200,haltThreshold:0,halt:!1,waitingForData:!1,initialize:function(){this.haltThreshold=5*this.minChallenges/100,XPMobileSDK.library.Connection.addObserver(this)},start:()=>{},cleanUp:function(){if(XPMobileSDK.library.Connection.connectionId&&!this.waitingForData){if(0<this.challenges.length)for(var e=0;e<this.challenges.length;e++)this.challenges[e].isValid()||(this.challenges[e].destroy(),this.challenges.splice(e,1));var t;this.challenges.length<this.minChallenges&&(t={NumChallenges:100},this.challenges.length<=this.haltThreshold&&(t.Reset="Yes"),this.waitingForData=!0,XPMobileSDK.requestChallenges(t,()=>{this.waitingForData=!1}))}},add:function(e){if("string"==typeof e){var t=new XPMobileSDK.library.Challenge(e);this.challenges.push(t)}else if("object"==typeof e&&0<e.length)for(var n=0;n<e.length;n++){t=new XPMobileSDK.library.Challenge(e[n]);this.challenges.push(t)}this.start()},takeValidChallenge:function(){if(this.cleanUp(),!(0<this.challenges.length))return logger.warn("No challenges in the list!"),{getValue:function(){},getTime:function(){}};for(var e=0;e<this.challenges.length;e++){var t=this.challenges.shift();if(this.challenges.length<this.haltThreshold?this.haltSystem():this.unHaltSystem(),t.isValid())return logger.log("Challenge:"+t.getValue(),"Seconds until expire:"+t.ttl),t;t.destroy()}},exportAll:function(){var t=[];return this.challenges.forEach(function(e){e=e.getValue();e&&t.push(e)}),t},sort:function(e,t){return t.getTime()-e.getTime()},calculate:function(){var e=this.takeValidChallenge();return e?{Challenge:e.getValue(),ChalAnswer:CryptoJS.SHA512((e.getValue()+this.sharedKey).toUpperCase()).toString(CryptoJS.enc.Base64),timeout:1e3*(e.ttl-e.getTime())}:{Challenge:void 0,ChalAnswer:void 0,timeout:void 0}},connectionLostConnection:function(){this.destroy()},connectionDidDisconnect:function(){this.destroy()},haltSystem(){document.getElementById("systemErrorModal").setAttribute("show",!0),this.halt=!0},unHaltSystem(){this.halt&&(this.halt=!1,document.getElementById("systemErrorModal").removeAttribute("show"))},connectionRequestSucceeded:function(e,t){"Yes"==XPMobileSDK.library.Connection.CHAPSupported&&t&&t.parameters&&t.parameters.Challenge&&XPMobileSDK.library.Connection.connectionId&&this.add(t.parameters.Challenge)},destroy:function(){if(0<this.challenges.length)for(var e=0;e<this.challenges.length;e++)this.challenges.shift().destroy();this.challenges=[],this.unHaltSystem(),XPMobileSDK.library.SecureString.sharedKey=null}},XPMobileSDK.library.Challenge=function(e){var t=Date.now();this.ttl=3540,this.isValid=function(){return this.getTime()/1e3<this.ttl},this.getValue=function(){return e},this.getTime=function(){return Date.now()-t},this.destroy=function(){}},XPMobileSDK.library.DiffieHellman=function(e){function t(e){e.length%2!=0&&(e="0"+e);for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substring(n,n+2),16));return t.reverse(),t}var n=str2bigInt({1024:"F488FD584E49DBCD20B49DE49107366B336C380D451D0F7C88B31C7C5B2D8EF6F3C923C043F0A55B188D8EBB558CB85D38D334FD7C175743A31D186CDE33212CB52AFF3CE1B1294018118D7C84A70A72D686C40319C807297ACA950CD9969FABD00A509B0246D3083D66A45D419F9C7CBD894B221926BAABA25EC355E92F78C7",2048:"87A8E61DB4B6663CFFBBD19C651959998CEEF608660DD0F25D2CEED4435E3B00E00DF8F1D61957D4FAF7DF4561B2AA3016C3D91134096FAA3BF4296D830E9A7C209E0C6497517ABD5A8A9D306BCF67ED91F9E6725B4758C022E0B1EF4275BF7B6C5BFC11D45F9088B941F54EB1E59BB8BC39A0BF12307F5C4FDB70C581B23F76B63ACAE1CAA6B7902D52526735488A0EF13C6D9A51BFA4AB3AD8347796524D8EF6A167B5A41825D967E144E5140564251CCACB83E6B486F6B3CA3F7971506026C0B857F689962856DED4010ABD0BE621C3A3960A54E710C375F26375D7014103A4B54330C198AF126116D2276E11715F693877FAD7EF09CADB094AE91E1A1597"}[XPMobileSDKSettings.primeLength],16,1),r=str2bigInt("2",10,1),o=[],s=null;this.createPublicKey=function(){o=randBigInt(160,0);var e=t(bigInt2str(powMod(r,o,n),16));return e.push(0),Base64.encodeArray(e)},this.setServerPublicKey=function(e){var t=Base64.decodeBinary(e),n=[];for(i=t.length-1;0<=i;i--)n.push(t[i]);s=CryptoJS.enc.Base64.parse(Base64.encodeArray(n)).toString()},this.getSharedKey=function(){var e=t(bigInt2str(powMod(str2bigInt(s,16,1),o,n),16));return CryptoJS.enc.Base64.parse(Base64.encodeArray(e)).toString()},this.encodeString=function(e){var t=this._sharedKey||this.getSharedKey().substring(0,96),n=CryptoJS.enc.Hex.parse(t.substring(32,96)),t={iv:CryptoJS.enc.Hex.parse(t.substring(0,32))};return XPMobileSDKSettings.defaultEncryptionPadding&&CryptoJS.pad[XPMobileSDKSettings.defaultEncryptionPadding]&&(t.padding=CryptoJS.pad[XPMobileSDKSettings.defaultEncryptionPadding]),CryptoJS.AES.encrypt(e,n,t).ciphertext.toString(CryptoJS.enc.Base64)}},CryptoJS.pad.Iso10126={pad:function(e,t){t=(t=4*t)-e.sigBytes%t;e.concat(CryptoJS.lib.WordArray.random(t-1)).concat(CryptoJS.lib.WordArray.create([t<<24],1))},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},XPMobileSDK.library.PKCECode={codeVerifier:"",getCodeVerifier:function(){return this.codeVerifier=CryptoJS.lib.WordArray.random(28).toString(),this.codeVerifier},getCodeChallenge:function(){return this.codeVerifier||this.getCodeVerifier(),encodeURIComponent(CryptoJS.SHA256(this.codeVerifier).toString(CryptoJS.enc.Base64).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""))}},XPMobileSDK.library.Ajax=new function(){this.Request=function(e,t){var n=t.timeout||0;delete t.timeout,t=Object.assign({method:"POST",contentType:"plain/text",responseType:"text",encoding:"utf-8",postBody:null,asynchronous:!0,onLoading:function(){},onComplete:function(){},onSuccess:function(){},onFailure:function(){},onTimeout:function(){}},t);var r=new XMLHttpRequest;return r.onreadystatechange=function(){1==r.readyState?t.onLoading(r):4==r.readyState&&(t.onComplete(r),(""!=r.responseType&&"text"!=r.responseType||0!=r.status||""!=r.responseText)&&("arraybuffer"!=r.responseType||0!=r.status||null!=r.response&&""!=r.response)&&(200==r.status||0==r.status)?t.onSuccess(r):t.onFailure(r))},r.open(t.method,e,t.asynchronous),t.asynchronous&&(r.responseType=t.responseType,r.timeout=n,r.ontimeout=t.onTimeout),r.setRequestHeader("Content-Type",t.contentType+"; charset="+t.encoding),r.send(t.postBody),r}},XPMobileSDK.library.Bytes=new function(){function n(e,t){var e=(e=e.length%2?"0"+e:e).match(/../g).splice(-t),n=new Array(t?t-e.length:0);return n.push.apply(n,e),n.forEach(function(e,t){n[t]=parseInt(e||0,16)}),n}return{fromInt:function(e,t){return n(e.toString(16),t)},fromGuid:function(e,t){return n(e.replace(/[^a-f0-9]/gi,""),t)},fromBase64:function(e,t){for(var n=atob(e.replace(/^.*?,/,"")).slice(-t),r=new Array(t?t-n.length:0),o=0;o<n.length;o++)r.push(n.charCodeAt(o));return r},fromHex:n}};var parseXML,XMLNodeTextContent,NETWORK={MIN_REQUEST_TIME_LOWER_BOUND:100,MIN_REQUEST_TIME_UPPER_BOUND:1e3,MAX_REQUEST_TIME:1e4,MAX_REQUEST_TIME_ON_FAILURE:4e3,REQUEST_TIME_GROW_PER_EMPTY_FRAME:1.32,REQUEST_TIME_GROW_PER_HTTP_ERROR:10,MIN_REQUEST_TIME_GROW:1.4,MIN_REQUEST_TIME_DECREASE:3e4,MIN_REQUEST_TIME_INCREASE:15e3,VIDEO_PROTOCOL_RECOVER_PACE:13,VIDEO_FAILS_MONITOR:7e3,minRequestTime:10,requestTime:10,requestTimeOnFailure:2e3,websocketSendMessage:1e3},CommunicationStability=new function(){var t=0,e=0,n=null;function r(e){return n&&(new Date).getTime()-n.getTime()>e}setInterval(function(){e=Math.max(0,e-1-parseInt(e/NETWORK.VIDEO_PROTOCOL_RECOVER_PACE)),NETWORK.requestTime=NETWORK.minRequestTime+e*NETWORK.REQUEST_TIME_GROW_PER_HTTP_ERROR,NETWORK.requestTimeOnFailure=Math.min(NETWORK.MAX_REQUEST_TIME_ON_FAILURE,NETWORK.requestTime*NETWORK.REQUEST_TIME_GROW_PER_HTTP_ERROR)},1e3),setInterval(function(){r(NETWORK.MIN_REQUEST_TIME_DECREASE)&&(NETWORK.minRequestTime=Math.max(NETWORK.MIN_REQUEST_TIME_LOWER_BOUND,.9*NETWORK.minRequestTime))},NETWORK.VIDEO_FAILS_MONITOR),this.addBreakDown=function(e){e.brokenDown||(t++,e.brokenDown=!0)},this.removeBreakDown=function(e){e.brokenDown&&(t--,e.brokenDown=!1)},this.addVideoBreakDown=function(){e++,n?r(NETWORK.MIN_REQUEST_TIME_INCREASE)&&(NETWORK.minRequestTime=Math.min(NETWORK.MIN_REQUEST_TIME_UPPER_BOUND,NETWORK.minRequestTime*NETWORK.MIN_REQUEST_TIME_GROW),n=new Date):n=new Date},this.isBrokenDown=function(){return 0<t}};if(XPMobileSDK.library.ConnectionStates={idle:1,connecting:2,loggingIn:3,working:4,lostConnection:5},XPMobileSDK.library.ConnectionObserverInterface={connectionStateChanged:function(){},connectionDidConnect:function(e){},connectionFailedToConnect:function(e){},connectionFailedToConnectWithId:function(e){},connectionRequiresCode:function(e){},connectionCodeError:function(){},connectionDidLogIn:function(){},connectionFailedToLogIn:function(e){},connectionLostConnection:function(){},connectionProcessingDisconnect:function(){},connectionDidDisconnect:function(){},connectionRequestSucceeded:function(e,t){},connectionVersionChanged:function(){},connectionReloadConfiguration:function(){},connectionReloadCameraConfiguration:function(){},closeStreamFinished:function(){}},Connection=function(){var c=this;this.connectionId=null,this.serverId=null,this.currentUserName=null,this.serverTimeout=30,this.state=XPMobileSDK.library.ConnectionStates.idle,this.DSServerStatus={NotAvailable:0,DoNotEnforce:1,EnforceWheneverPossible:2,Enforce:3};var s=[],r=[],e=0,o=0;this.initialize=function(e){e&&(c.storage=e,XPMobileSDK.features=c.storage.getItem("features"),c.resizeAvailable=c.storage.getItem("resizeAvailable"),c.webSocketServer=c.storage.getItem("webSocketServer"),c.webSocketBrowser=c.storage.getItem("webSocketBrowser"),c.directStreamingClient=c.storage.getItem("directStreamingClient"),c.directStreamingServer=c.storage.getItem("directStreamingServer"),c.exportToAvi=c.storage.getItem("exportToAvi"),c.exportToDb=c.storage.getItem("exportToDb"),c.exportToMkv=c.storage.getItem("exportToMkv"),c.analytics=c.storage.getItem("analytics")),c.server=XPMobileSDKSettings.MobileServerURL||window.location.origin,c.dh=new XPMobileSDK.library.DiffieHellman},this.addObserver=function(e){-1===r.indexOf(e)&&r.push(e)},this.removeObserver=function(e){e=r.indexOf(e);e<0?logger.error("Error removing observer. Observer does not exist."):r.splice(e,1)},this.cancelRequest=function(e){logger.log("Cancelling request: ",e),e.cancel(),Ie(e)},this.Connect=function(e,t,n){return e=e||{},Pe(XPMobileSDK.library.ConnectionStates.connecting),e.ProcessingMessage="No",c.sendCommand("Connect",e,{successCallback:t},a,n)};var a=function(e){Ie(e);var t,n=e.response;!n||n.isError?(t=n&&n.error,De("connectionFailedToConnect",t),e.options.failCallback&&e.options.failCallback(t)):(c.connectionId=n.outputParameters.ConnectionId,c.serverTimeout=parseInt(n.outputParameters.Timeout),c.serverId=n.outputParameters.ServerId,c.storage&&(c.webSocketServer="Yes"===n.outputParameters.WebSocketSupport,c.storage.setItem("webSocketServer",c.webSocketServer),"boolean"==typeof c.storage.getItem("webSocketBrowser")&&window.WebSocket?c.webSocketBrowser=c.storage.getItem("webSocketBrowser"):(c.webSocketBrowser=!!window.WebSocket,c.storage.setItem("webSocketBrowser",c.webSocketBrowser)),"boolean"==typeof c.storage.getItem("directStreamingClient")?c.directStreamingClient=c.storage.getItem("directStreamingClient"):(c.directStreamingClient=!!XPMobileSDKSettings.DirectStreaming,c.storage.setItem("directStreamingClient",c.directStreamingClient)),c.analytics=c.storage.getItem("analytics")),n.outputParameters.SecurityEnabled&&(c.SecurityEnabled=n.outputParameters.SecurityEnabled),n.outputParameters.PublicKey&&(c.PublicKey=n.outputParameters.PublicKey,c.dh&&c.dh.setServerPublicKey(n.outputParameters.PublicKey)),n.outputParameters.CHAPSupported&&"Yes"===n.outputParameters.CHAPSupported&&(c.CHAPSupported=n.outputParameters.CHAPSupported,XPMobileSDK.library.CHAP.sharedKey=c.dh&&c.dh.getSharedKey()),n.outputParameters.ServerProductCode&&(c.ServerProductCode=n.outputParameters.ServerProductCode),logger.info("Established connection"),Ee(),n=n.outputParameters,De("connectionDidConnect",n),e.options.successCallback&&e.options.successCallback(n))};this.connectWithId=function(e,t,n){c.server=e,c.connectionId=t,c.serverId=n,logger.log("Connecting with Id "+c.connectionId),Pe(XPMobileSDK.library.ConnectionStates.connecting),c.sendLiveMessage(),c.connectingViaExternalConnectionID=!0},this.Login=function(e,t,n){return logger.log("Log in with authentication type "+(e=e||{}).LoginType+" username "+e.Username+" password "+e.Password),Pe(XPMobileSDK.library.ConnectionStates.loggingIn),c.sendCommand("LogIn",e,{successCallback:t},l,n)};var l=function(e){Ie(e);var t,n=e.response;!n||n.isError?n&&n.error.code===XPMobileSDK.library.ConnectionError.SecondStepAuthenticationRequired?(t=n.outputParameters.SecondStepAuthenticationProvider,De("connectionRequiresCode",t),e.options.successCallback&&e.options.successCallback(t)):(c.connectionId=null,we(),t=n&&n.error,De("connectionFailedToLogIn",t),e.options.failCallback&&e.options.failCallback(t)):u(n,e.options.successCallback)},u=function(e,t){var n=XPMobileSDK.features&&XPMobileSDK.features.ServerVersion;c.directStreamingServer="Yes"===e.outputParameters.DirectStreamingLive,c.storage.setItem("directStreamingServer",c.directStreamingServer),c.exportToAvi="Yes"===e.outputParameters.ExportToAvi,c.storage.setItem("exportToAvi",c.exportToAvi),c.exportToDb="Yes"===e.outputParameters.ExportToDb,c.storage.setItem("exportToDb",c.exportToDb),c.exportToMkv="Yes"===e.outputParameters.ExportToMkv,c.storage.setItem("exportToMkv",c.exportToMkv),e.outputParameters.Username&&(c.currentUserName=e.outputParameters.Username),logger.info("Logged in"),Be(e.outputParameters),Pe(XPMobileSDK.library.ConnectionStates.working),De("connectionDidLogIn",e.outputParameters),t&&t(),n&&n!==XPMobileSDK.features.ServerVersion&&De("connectionVersionChanged")};this.requestCode=function(e,t){return c.sendCommand("RequestSecondStepAuthenticationPin",{},{successCallback:e},n,t)};var n=function(e){_e(e,"Error requesting validation code.",e.options.successCallback)};this.verifyCode=function(e){return c.sendCommand("VerifySecondStepAuthenticationPin",{SecondStepAuthenticationPin:e},null,t)};var t=function(e){Ie(e);e=e.response;!e||e.isError?e&&e.error.code===XPMobileSDK.library.ConnectionError.SecondStepAuthenticationCodeError?De("connectionCodeError"):(c.connectionId=null,we(),De("connectionFailedToLogIn",e&&e.error)):u(e)};this.Disconnect=function(e,t,n){De("connectionProcessingDisconnect"),we(),Pe(XPMobileSDK.library.ConnectionStates.idle),XPMobileSDK.library.VideoConnectionPool.clear();n=c.sendCommand("Disconnect",e=e||{},{successCallback:t},d,n);return c.connectionId=null,n};var d=function(e){Ie(e),De("connectionDidDisconnect"),c.destroy()};this.getViews=function(e,t,n){return c.sendCommand("GetViews",{ViewId:e},{successCallback:t,ViewId:e},f,n)};var f=function(c){_e(c,null,function(){for(var e=[],t=c.response.subItems.getElementsByTagName("Item"),n=0,r=t.length;n<r;n++){for(var o=t[n],i={},s=0;s<o.attributes.length;s++)i[o.attributes[s].name]=o.attributes[s].value;e.push(i)}var a={id:c.options.ViewId,subViews:e};c.options.successCallback&&c.options.successCallback(a)})};this.getAllViews=function(e,t){return c.sendCommand("GetAllViewsAndCameras",{},{successCallback:e},h,t)};var h=function(e){_e(e,"Error executing GetAllViewsAndCameras on the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.getAllCameras=function(e,t){return c.sendCommand("GetItems",{ItemKind:"Camera",Hierarchy:"UserDefined",IncludeRelatedDevices:"Yes"},{successCallback:e},g,t)};var g=function(e){_e(e,"Error executing GetItems on the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.getOsmServerAddresses=function(e,t){return c.sendCommand("GetOsmServerAddresses",{},{successCallback:e},m,t)};var m=function(e){_e(e,"Error getting OSM server addresses from the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.getGisMapCameras=function(e,t){return c.sendCommand("GetGisMapCameras",{},{successCallback:e},p,t)};var p=function(e){_e(e,"Error getting GIS map cameras from the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.getGisMapLocations=function(e,t){return c.sendCommand("GetGisMapLocations",{},{successCallback:e},b,t)};var b=function(e){_e(e,"Error getting GIS map cameras from the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.requestPushStream=function(e,t){return c.RequestStream({SignalType:"Upload",ByteOrder:"Network"},e,t)};this.requestStream=function(e,t,n,r,o){n=n||{};t={CameraId:e,DestWidth:Math.round(t.width),DestHeight:Math.round(t.height),SignalType:n.signal===XPMobileSDK.interfaces.VideoConnectionSignal.playback?"Playback":"Live",MethodType:"Push",Fps:15,ComprLevel:n.jpegCompressionLevel||70,KeyFramesOnly:n.keyFramesOnly?"Yes":"No",RequestSize:"Yes",StreamType:n.streamType===XPMobileSDK.library.VideoConnectionStream.FragmentedMP4?"FragmentedMP4":"Transcoded"};return n.fragmentDurationMs&&(t.FragmentDurationMs=n.fragmentDurationMs),n.time&&(t.SeekType="Time",t.Time=n.time),n.motionOverlay&&(t.MotionOverlay="Yes"),XPMobileSDK.features.MultiCameraPlayback&&n.playbackControllerId&&(t.PlaybackControllerId=n.playbackControllerId),n={successCallback:r,cameraId:e,signal:n.signal===XPMobileSDK.interfaces.VideoConnectionSignal.playback?"Playback":"Live",reuseConnection:!!n.reuseConnection},c.sendCommand("RequestStream",t,n,C,o)},this.RequestStream=function(e,t,n){return c.sendCommand("RequestStream",e,{successCallback:t},C,n)};var C=function(t){let e="Error starting stream for camera "+t.options.cameraId;t.response.errorCode===XPMobileSDK.library.ConnectionError.InsufficientUserRights&&(e=""),_e(t,e,function(){var e=t.response.outputParameters.VideoId;logger.log("Server prepared video ID "+e+" for camera "+t.options.cameraId);e=new VideoStream(e,t);t.options.reuseConnection&&XPMobileSDK.library.VideoConnectionPool.addCamera(t.options.cameraId,e),t.options.successCallback&&t.options.successCallback(e)})};this.RequestAudioStreamIn=function(e,t,n){return c.sendCommand("RequestAudioStreamIn",e,{successCallback:t},S,n)},this.requestAudioStreamIn=function(e,t,n,r){e={ItemId:e,AudioEncoding:"Pcm",AudioSamplingRate:8e3,AudioBitsPerSample:16,AudioChannelsNumber:1,StreamDataType:"Audio",SignalType:"Live",MethodType:"Push",StreamHeaders:"AllPresent",ByteOrder:"Network"};return(t=t||{}).AudioSamplingRate&&(e.AudioSamplingRate=t.AudioSamplingRate),t.AudioBitsPerSample&&(e.AudioBitsPerSample=t.AudioBitsPerSample),t.AudioChannelsNumber&&(e.AudioChannelsNumber=t.AudioChannelsNumber),c.sendCommand("RequestAudioStreamIn",e,t={successCallback:n},S,r)};var S=function(e){_e(e,"Error requesting video push stream from the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.RequestAudioStream=function(e,t,n){return c.sendCommand("RequestAudioStream",e,{successCallback:t},v,n)},this.requestAudioStream=function(e,t,n,r){var o={ItemId:e,MethodType:"Push",SignalType:(t=t||{}).signal===XPMobileSDK.interfaces.VideoConnectionSignal.playback?"Playback":"Live",StreamType:"Transcoded",StreamDataType:"Audio",AudioEncoding:"Mp3",CloseConnectionOnError:"Yes"};return t.playbackControllerId&&(o.PlaybackControllerId=t.playbackControllerId),t.AudioCompressionLevel?o.ComprLevel=t.AudioCompressionLevel:XPMobileSDKSettings.AudioCompressionLevel&&(o.ComprLevel=XPMobileSDKSettings.AudioCompressionLevel),c.sendCommand("RequestAudioStream",o,t={successCallback:n,microphoneId:e},v,r)};var v=function(t){_e(t,"Error starting stream for microphone "+t.options.microphoneId,function(){var e=t.response.outputParameters.StreamId;logger.log("Server prepared stream ID "+e+" for microphone "+t.options.microphoneId),t.options.successCallback&&t.options.successCallback(t)})};this.toggleDirectStreaming=function(e){c.directStreamingClient=!!e,c.storage&&c.storage.setItem("directStreamingClient",c.directStreamingClient),XPMobileSDK.library.VideoConnection.instances.forEach(function(e){e.getState()===XPMobileSDK.library.VideoConnectionState.running&&e.close()})},this.toggleAnalytics=function(e){c.analytics=!!e,c.storage&&c.storage.setItem("analytics",c.analytics),window.dispatchEvent(new CustomEvent("AnalyticsSettingChanged"))},this.changeStream=function(e,t,n,r,o){n={VideoConnection:e,VideoId:e.videoId,DestWidth:Math.round(n.width),DestHeight:Math.round(n.height)};return void 0!==t.top&&(n.SrcTop=Math.round(t.top)),void 0!==t.left&&(n.SrcLeft=Math.round(t.left)),void 0!==t.right?n.SrcRight=Math.round(t.right):void 0!==t.width&&(n.SrcRight=Math.round(t.width)+Math.round(t.left)),void 0!==t.bottom?n.SrcBottom=Math.round(t.bottom):void 0!==t.height&&(n.SrcBottom=Math.round(t.height)+Math.round(t.top)),c.ChangeStream(n,r,o)},this.ChangeStream=function(e,t,n){return c.sendCommand("ChangeStream",e,{successCallback:t},y,n)};var y=function(e){_e(e,"Error changing stream.",function(){XPMobileSDK.features.SupportTimeBetweenFrames&&e.VideoConnection.resetCommunication(),e.options.successCallback&&e.options.successCallback()})};this.motionDetection=function(e,t){var n={VideoId:e.videoId,VideoConnection:e},e=t.motion||t.MotionAmount;e&&(n.MotionAmount=Math.round(e));e=t.sensitivity||t.SensitivityAmount;e&&(n.SensitivityAmount=Math.round(e));e=t.cpu||t.CPUImpactAmount;e&&(n.CPUImpactAmount=Math.round(e));t=t.grid||t.RegionGrid;return/^\d+x\d+(;\d+)+$/.test(t)&&(n.RegionGrid=t),c.ChangeStream(n)},this.getPtzPresets=function(e,t,n){return c.sendCommand("GetPtzPresets",{CameraId:e},{successCallback:t},_,n)};var _=function(e){_e(e,"Error getting PTZ presets.",function(){delete e.response.outputParameters.Challenge,e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.closeStream=function(e){return c.CloseStream({VideoId:e})},this.closeAudioStream=function(e){return c.sendCommand("CloseStream",{VideoId:e},{successCallback:null},k)},this.CloseStream=function(e,t,n){return c.sendCommand("CloseStream",e,{successCallback:t},I,n)};var I=function(e){P(e),De("closeStreamFinished")},k=function(e){P(e)},P=function(e){Ie(e);var t=e.response;t&&!t.isError||Re(e)&&Xe()},D=new function(){var e=!1,t=!1,n=15,r=1,o=0;this.manage=function(e){e?(o=0,1<e&&this.decrease()):5<++o&&(this.increase(),o=0)}.bind(this),this.decrease=function(){e||1===n||(e=!0,n=r<n?r:1,logger.warn("Decreasing FPS to "+n),i(n,function(){e=!1}.bind(this)))}.bind(this),this.increase=function(){t||15===n||(t=!0,r=n++,logger.warn("Increasing FPS to "+n),i(n,function(){t=!1}.bind(this)))}.bind(this);var i=function(e,t,n){for(var r,o=0;o<XPMobileSDK.library.VideoConnectionPool.cameras.length;o++)(r=XPMobileSDK.library.VideoConnectionPool.cameras[o]).videoConnection&&r.videoConnection.videoId&&(r={VideoId:r.videoConnection.videoId,Fps:e,VideoConnection:r.videoConnection},c.ChangeStream(r,t,n))}.bind(this)};this.ptzPreset=function(e,t){t={CameraId:e.cameraId,PtzPreset:t};return c.sendCommand("ControlPTZ",t,null,M)},this.ptzMove=function(e,t){e={CameraId:e.cameraId,PtzMove:t,VideoConnection:e};return c.sendCommand("ControlPTZ",e,null,M)},this.ptzTapAndHold=function(e,t,n){return e.Type="TapAndHold",e.GestureTimeout=2e3,c.sendCommand("ControlPTZ",e,{successCallback:t},E,n)};var E=function(e){_e(e,"Error controlling PTZ",function(){e.options.successCallback&&e.options.successCallback()})};this.ptzSwipe=function(e,t){return e.Type="Swipe",e.GestureDuration=t,c.sendCommand("ControlPTZ",e,null,M)};var M=function(e){_e(e,"Error controlling PTZ")};this.playbackSpeed=function(e,t){e={VideoId:e.videoId,Speed:t,VideoConnection:e};return c.ChangeStream(e)},this.playbackSeek=function(e,t){e={VideoId:e.videoId,SeekType:t,VideoConnection:e};return c.ChangeStream(e)},this.playbackGoTo=function(e,t,n,r,o){e={VideoId:e.videoId,SeekType:n||"Time",Time:t,VideoConnection:e};return c.ChangeStream(e,r,o)},this.getThumbnail=function(e,t,n){return c.sendCommand("GetThumbnail",{CameraId:e,ComprLevel:70},{successCallback:t},w,n)};var w=function(e){_e(e,"Error getting thumbnail.",function(){e.response.thumbnailBase64&&e.options.successCallback&&e.options.successCallback(e.response.thumbnailBase64)})};this.getThumbnailByTime=function(e,t,n){var r={CameraId:e.cameraId,Time:e.time,SeekType:"Time"};return e.width&&(r.DestWidth=e.width),e.height&&(r.DestHeight=e.height),c.sendCommand("GetThumbnailByTime",r,{successCallback:t},T,n)};var T=function(e){_e(e,"Error getting thumbnail by time",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.Thumbnail,e.response.outputParameters.Timestamp)})};this.getDBStartTime=function(e,t,n){return c.sendCommand("GetRecordingTime",{CameraId:e,SeekType:"DbStart"},{successCallback:t},A,n)};var A=function(e){_e(e,"Error getting recording time",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.Time)})};this.getNextSequence=function(e,t,n,r){var o=(o=parseInt(((new Date).getTime()-t)/1e3))<0?0:o;return c.sendCommand("GetSequences",{ItemId:e,SeqType:"Recording",Time:t,AfterTime:o,AfterCount:1,ItemKind:"Camera"},{successCallback:n},x,r)};var x=function(e){_e(e,"Error getting sequences",function(){0<e.response.sequences.length?e.options.successCallback&&e.options.successCallback(e.response.sequences[0]):e.options.successCallback&&e.options.successCallback(null)})};this.getPrevSequence=function(e,t,n,r){t={ItemId:e,SeqType:"Recording",Time:t,BeforeTime:Date.daysToSeconds(30),BeforeCount:1,ItemKind:"Camera"};return c.sendCommand("GetSequences",t,{successCallback:n},B,r)};var B=function(e){_e(e,"Error getting sequences",function(){0<e.response.sequences.length?e.options.successCallback&&e.options.successCallback(e.response.sequences[0]):e.options.successCallback&&e.options.successCallback(null)})};this.getSequencesInInterval=function(e,t,n,r,o,i){t={ItemId:e,SeqType:"Recording",Time:t,AfterTime:parseInt((n-t)/1e3),AfterCount:1e4,ItemKind:"Camera"};return r&&(t.InvestigationId=r),c.sendCommand("GetSequences",t,{successCallback:o},K,i)};var K=function(e){_e(e,"Error getting sequences",function(){e.options.successCallback&&e.options.successCallback(e.response.sequences)})};this.getSequencesForView=function(e,t,n,r,o,i){var s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"Recording",a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"Camera",a={ItemId:e,SeqType:s,Time:t,AfterTime:parseInt((n-t)/1e3),AfterCount:1e4,ItemKind:a,MinTimeBetweenSequences:r||1};return c.sendCommand("GetSequences",a,{successCallback:o},R,i)};var R=function(e){_e(e,"Error getting sequences",function(){e.options.successCallback&&e.options.successCallback(e.response.sequences)})};this.startVideoExport=function(e,t,n,r,o){return c.sendCommand("StartExport",{CameraId:e,StartTime:t,EndTime:n,Type:"Avi"},{successCallback:r},X,o)},this.restartErroneousExport=function(e,t,n){return c.sendCommand("StartExport",{ExportId:e},{successCallback:t},X,n)};var X=function(e){_e(e,"Error starting export.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.ExportId)})};this.getUserExports=function(e,t){return c.sendCommand("GetExport",{ExportId:"00000000-0000-0000-0000-000000000000"},{successCallback:e},O,t)};var O=function(e){_e(e,"Error getting user exports",function(){e.options.successCallback&&e.options.successCallback(e.response.exports)})};this.getAllExports=function(e,t){return c.sendCommand("GetExport",{ExportId:"{A3B9C5FB-FAAD-42C8-AB73-B79D6FFFDBC1}"},{successCallback:e},N,t)};var N=function(e){_e(e,"Error getting all exports",function(){e.options.successCallback&&e.options.successCallback(e.response.exports)})};this.createExportDownloadLink=function(e,t,n,r,o){return c.sendCommand("CreateExportDownloadLink",{ExportId:e,InvestigationId:t,Type:n},{successCallback:r},F,o)};var F=function(e){_e(e,"Error getting export download link",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.ExportLink)})};this.getExport=function(e,t,n){return c.sendCommand("GetExport",{ExportId:e},{successCallback:t},q,n)};var q=function(e){_e(e,"Error getting export",function(){0!==e.response.exports.length?e.options.successCallback&&e.options.successCallback(e.response.exports[0]):e.options.successCallback&&e.options.successCallback(null)})};this.deleteExport=function(e,t,n){return c.sendCommand("DeleteExport",{ExportId:e},{successCallback:t},L,n)};var L=function(e){_e(e,"Error deleting export.",function(){e.options.successCallback&&e.options.successCallback()})};this.getOutputsAndEvents=function(e,t){return c.sendCommand("GetOutputsAndEvents",{CameraId:""},{successCallback:e},V,t)};var V=function(e){_e(e,"Error getting outputs and events",function(){e.options.successCallback&&e.options.successCallback(e.response.actions)})};this.getServerStatus=function(e,t){return c.sendCommand("GetServerStatus",{},{successCallback:e},H,t)};var H=function(e){_e(e,"Error getting server status",function(){e.options.successCallback&&e.options.successCallback(e.response.ServerStatus)})};this.triggerOutputOrEvent=function(e,t,n,r){return c.sendCommand("RequestActivation",{ObjectId:e,TriggerType:t},{successCallback:n},z,r)};var z=function(e){_e(e,"Error triggering output or event.",function(){e.options.successCallback&&e.options.successCallback()})};this.getCameraCapabilities=function(e,t,n){return c.sendCommand("GetCapabilities",{CameraId:e},{successCallback:t},U,n)};var U=function(e){_e(e,"Error getting camera capabilities",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.prepareUpload=function(e,t,n){return c.sendCommand("PrepareUpload",e,{successCallback:t},W,n)};var W=function(e){_e(e,"Error preparing upload",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.getUploadStatus=function(e,t,n){return c.sendCommand("GetUploadStatus",e,{successCallback:t},G,n)};var G=function(e){_e(e,"Error getting upload status",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.requestChallenges=function(e,t,n){return c.sendCommand("RequestChallenges",e,{successCallback:t},j,n)};var j=function(e){_e(e,"Error getting challenges.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.createPlaybackController=function(e,t,n){return e.MethodType="Push",e.CloseOldControllers||(e.CloseOldControllers="Yes"),c.sendCommand("CreatePlaybackController",e,{successCallback:t},J,n)};var J=function(e){var t=e.response,n=new XPMobileSDK.library.VideoConnection(t.outputParameters.PlaybackControllerId,e,{onClose:function(){},onRestart:function(){},onPushFailed:function(){}});_e(e,"Error creating playback controller",function(){e.options.successCallback&&e.options.successCallback(n)})};this.changeMultipleStreams=function(e,t,n){return c.sendCommand("ChangeMultipleStreams",e,{successCallback:t},Y,n)};var Y=function(e){_e(e,"Error getting multiple stream data",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.getAllInvestigations=function(e,t){return c.sendCommand("GetInvestigation",{ItemId:"{A3B9C5FB-FAAD-42C8-AB73-B79D6FFFDBC1}"},{successCallback:e},Q,t)},this.getUserInvestigations=function(e,t){return c.sendCommand("GetInvestigation",{ItemId:"00000000-0000-0000-0000-000000000000"},{successCallback:e},Q,t)};var Q=function(e){_e(e,"Error getting investigations",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.getInvestigation=function(e,t,n){return c.sendCommand("GetInvestigation",{ItemId:e},{successCallback:t},Z,n)};var Z=function(e){_e(e,"Error getting investigation",function(){e.options.successCallback&&e.options.successCallback(e.response.items[0])})};this.createInvestigation=function(e,t,n){return c.sendCommand("CreateInvestigation",e,{successCallback:t},ee,n)};var ee=function(e){_e(e,"Error creating investigation to the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.updateInvestigation=function(e,t,n){return c.sendCommand("UpdateInvestigation",e,{successCallback:t},te,n)},this.updateInvestigationData=function(e,t,n){return c.sendCommand("UpdateInvestigationData",e,{successCallback:t},te,n)};var te=function(e){_e(e,"Error updating investigation to the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.deleteInvestigation=function(e,t,n){return c.sendCommand("DeleteInvestigation",{ItemId:e},{successCallback:t},ne,n)};var ne=function(e){_e(e,"Error deleteing investigation from the server.",function(){e.options.successCallback&&e.options.successCallback(!e.response.isError)})};this.cancelInvestigation=function(e){return c.sendCommand("CancelInvestigationUpdate",{ItemId:e},null,re)};var re=function(e){_e(e,"Error canceling investigation update")};this.startInvestigationExport=function(e,t,n,r,o,i){n={InvestigationId:e,ExportType:t,IncludeAudio:n};return r&&(n.Password=r),c.sendCommand("StartInvestigationExport",n,{successCallback:o},oe,i)};var oe=function(e){_e(e,"Error starting investigation export.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.ExportId)})};this.deleteInvestigationExport=function(e,t,n,r){return c.sendCommand("DeleteInvestigationExport",{InvestigationId:e,ExportType:t},{successCallback:n},ie,r)};var ie=function(e){_e(e,"Error deleting investigation export.",e.options.successCallback)};this.getAlarmList=function(e,t,n){return e={MyAlarms:e.MyAlarms||"No",Timestamp:e.Timestamp,Operator:"LessThan",Count:e.Count,Priority:e.Priority,State:e.State},c.sendCommand("GetAlarmList",e,{successCallback:t},se,n)};var se=function(e){_e(e,"Error getting alarms",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.getAlarm=function(e,t,n){return c.sendCommand("GetAlarmList",{AlarmId:e},{successCallback:t},ae,n)};var ae=function(e){_e(e,"Error getting alarm",function(){e.options.successCallback&&e.options.successCallback(e.response.items[0])})};this.updateAlarm=function(e,t,n){return c.sendCommand("UpdateAlarm",e,{successCallback:t},ce,n)};var ce=function(e){_e(e,"Error updating alarms",function(){e.options.successCallback&&e.options.successCallback()})};this.getAlarmDataSettings=function(e,t){return c.sendCommand("GetAlarmDataSettings",{},{successCallback:e},le,t)};var le=function(e){_e(e,"Error getting alarm data settings",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.getAlarmUsers=function(e,t,n){return c.sendCommand("GetPermittedUsers",{SourceId:e},{successCallback:t},ue,n)};var ue=function(e){_e(e,"Error getting permitted users for alarm",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.acknowledgeAlarm=function(e,t,n){return c.sendCommand("AcknowledgeAlarm",{Id:e},{successCallback:t},de,n)};var de=function(e){_e(e,"Error acknowledging alarm",function(){e.options.successCallback&&e.options.successCallback()})};this.GetBookmarks=function(e,t,n){return c.sendCommand("GetBookmarks",e,{successCallback:t},fe,n)},this.getBookmarks=function(e,t,n){var r={MyBookmarks:e.MyBookmarks||"No",BookmarkId:e.BookmarkId};return e.Count&&(r.Count=e.Count),e.StartTime&&(r.StartTime=e.StartTime),e.EndTime&&(r.EndTime=e.EndTime),e.Keyword&&(r.Keyword=e.Keyword),e.SearchCameraIds&&(r.SearchCameraIds=e.SearchCameraIds),c.sendCommand("GetBookmarks",r,{successCallback:t},fe,n)};var fe=function(e){_e(e,"Error getting bookmarks",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.deleteBookmark=function(e,t,n){return c.sendCommand("DeleteBookmark",{BookmarkId:e},{successCallback:t},he,n)};var he=function(e){_e(e,"Error deleting bookmark.",function(){e.options.successCallback&&e.options.successCallback()})};this.prevCarouselCamera=function(e){return c.sendCommand("ControlCarousel",{VideoId:e,CarouselCommand:"PreviousCamera"},null,ge)};var ge=function(e){_e(e,"Error getting prev camera from carousel")};this.nextCarouselCamera=function(e){return c.sendCommand("ControlCarousel",{VideoId:e,CarouselCommand:"NextCamera"},null,me)};var me=function(e){_e(e,"Error getting next camera from carousel")};this.pauseCarousel=function(e){return c.sendCommand("ControlCarousel",{VideoId:e,CarouselCommand:"PauseCarousel"},null,pe)};var pe=function(e){_e(e,"Error pausing carousel")};this.resumeCarousel=function(e){return c.sendCommand("ControlCarousel",{VideoId:e,CarouselCommand:"ResumeCarousel"},null,be)};var be=function(e){_e(e,"Error resuming carousel")};this.registerForNotifications=function(e,t,n){var r=$.getBrowser(),r=r.name+" "+r.version+", "+r.os,r={Settings:e,DeviceName:XPMobileSDK.library.Connection.dh.encodeString(r),DeviceId:XPMobileSDK.library.Connection.connectionId};return c.RegisterForNotifications(r,t,n)},this.RegisterForNotifications=function(e,t,n){return c.sendCommand("RegisterForNotifications",e,{successCallback:t},Ce,n)};var Ce=function(e){_e(e,"Error register for notifications.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.CreateBookmark=function(e,t,n){return c.sendCommand("CreateBookmark",e,{successCallback:t},Se,n)};var Se=function(e){_e(e,"Error creating a bookmark.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})};this.RequestBookmarkCreation=function(e,t,n){return c.sendCommand("RequestBookmarkCreation",e,{successCallback:t},ve,n)};var ve=function(e){_e(e,"Error requesting a bookmark.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})};this.UpdateBookmark=function(e,t,n){return c.sendCommand("UpdateBookmark",e,{successCallback:t},ye,n)};var ye=function(e){_e(e,"Error update a bookmark.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})},_e=function(e,t,n){Ie(e);var r=e.response;!r||r.isError?Re(e)?(logger.error("The application has lost connection due to connectionRequestResponseIsTerminal"),logger.log(t),Xe()):(t&&logger.error(t),e.options.failCallback?e.options.failCallback(r.error,r):e.options.successCallback&&e.options.successCallback(null,r.error,r)):n&&n()};this.sendCommand=function(e,t,n,r,o){if(t=t||{},XPMobileSDKSettings.supportsCHAP&&"Yes"===c.SecurityEnabled&&"Yes"===c.CHAPSupported){var i=XPMobileSDK.library.CHAP.calculate();if(i.Challenge&&i.ChalAnswer)t.Challenge=i.Challenge,t.ChalAnswer=i.ChalAnswer;else if(XPMobileSDK.library.Connection.state===XPMobileSDK.library.ConnectionStates.working)return void logger.error("No challenges to perform the action")}n=n||{},o&&(n.failCallback=o),logger.log("Sending "+e+" on "+new Date+"with ",t);r=new XPMobileSDK.library.ConnectionRequest(e,ke(),t,n,r);return s.push(r),r};var Ie=function(e){var t=s.indexOf(e);-1<t&&s.splice(t,1);t={parameters:e.params,options:e.options},e=e.response&&{parameters:e.response.outputParameters};De("connectionRequestSucceeded",t,e)},ke=function(){return++e},Pe=function(e){c.state=e,De("connectionStateChanged")},De=function(){var t,n;arguments.length<1||(t=arguments[0],n=Array.prototype.slice.call(arguments,1),r.forEach(function(e){if(e[t])try{e[t].apply(e,n)}catch(e){logger.error(e),logger.log(e.stack)}}))},Ee=function(){c.liveMessageTimer||(c.liveMessageTimer=setInterval(c.sendLiveMessage,1e3*c.serverTimeout/3))};this.updateLiveMessageTimer=function(e){var t=1e3*c.serverTimeout/3;e&&"number"==typeof e&&(t=Math.min(t,e)),clearTimeout(c.liveMessageTimer),c.liveMessageTimer=setInterval(c.sendLiveMessage,t)};var Me,we=function(){c.liveMessageTimer&&(clearTimeout(c.liveMessageTimer),c.liveMessageTimer=null)};this.sendLiveMessage=function(){c.LiveMessage(),c.webSocketServer&&c.webSocketBrowser&&D.manage(o),o++};function Te(){we(),Pe(XPMobileSDK.library.ConnectionStates.idle),XPMobileSDK.library.VideoConnectionPool.clear(),De("connectionProcessingDisconnect"),c.connectionId=null,De("connectionDidDisconnect"),c.destroy()}function Ae(){Me=Me||setTimeout(Te,1e3*c.serverTimeout)}this.LiveMessage=function(e,t,n){c.sendCommand("LiveMessage",e=e||{},{successCallback:t},xe,n=n||Ae)};var xe=function(e){o--,Ie(e),clearTimeout(Me),Me=void 0;var t=e.response;if((!t||t.isError)&&Re(e))return c.connectingViaExternalConnectionID?(c.connectingViaExternalConnectionID=!1,logger.warn("Old connection ID has expired"),De("connectionFailedToConnectWithId",t&&t.error),c.connectionId=null):Xe(),void we();if(c.connectingViaExternalConnectionID&&(c.connectingViaExternalConnectionID=!1,logger.log("Started connection from external connection ID"),Pe(XPMobileSDK.library.ConnectionStates.working),De("connectionDidLogIn"),De("connectionDidConnectWithId")),"Yes"!==t.outputParameters.FolderDefinitionsChanged&&"Yes"!==t.outputParameters.ViewDefinitionsChanged||De("connectionReloadConfiguration"),"Yes"===t.outputParameters.CameraDefinitionsChanged&&De("connectionReloadCameraConfiguration"),t.items&&0<t.items.length)for(var n=0;n<t.items.length;n++)"Notification"===t.items[n].Type&&De("receivedNotification",t.items[n]);Ee()},Be=function(e){if(e){var t={};for(i in e)switch(i){case"Challenge":t.CHAPSupported=!0;break;case"ServerVersion":t.ServerVersion=e[i];break;case"ServerType":XPMobileSDKSettings.ServerType=e[i];break;case"ServerDescription":XPMobileSDKSettings.ServerDescription=e[i];break;default:var n=isNaN(Number(e[i]))?"Yes"===e[i]:Number(e[i]);t[i]=n}Ke(t),c.storage&&c.storage.setItem("features",t),XPMobileSDK.features=t}},Ke=function(e){e.NativeStreamingAvailable?e.TranscodedStreamingAvailable?e.NativeStreamingSuggested?e.DirectStreaming=c.DSServerStatus.EnforceWheneverPossible:e.DirectStreaming=c.DSServerStatus.DoNotEnforce:e.DirectStreaming=c.DSServerStatus.Enforce:e.DirectStreaming=c.DSServerStatus.NotAvailable},Re=function(e){e=e.response;return void 0===e||e.errorCode===XPMobileSDK.library.ConnectionError.WrongID||e.errorCode===XPMobileSDK.library.ConnectionError.ChallengesLimitReached||"Wrong connection ID"===e.errorString},Xe=function(){c.state!==XPMobileSDK.library.ConnectionStates.lostConnection&&(Pe(XPMobileSDK.library.ConnectionStates.lostConnection),c.connectionId=null,XPMobileSDK.library.VideoConnectionPool.clear(),c.destroy(),De("connectionLostConnection"))};this.destroy=function(){s=[],c.storage&&(c.storage.removeItem("features"),c.storage.removeItem("webSocketServer"),c.storage.removeItem("directStreamingServer"))}},XPMobileSDK.library.ConnectionError={NotImplemented:1,NotFullyImplemented:2,BadCommandType:10,BadCommandKind:11,WrongID:12,MissingInputParameter:13,WrongInputParameter:14,InvalidCredentials:15,IncorrectPublicKey:16,SurveillanceServerDown:17,InvalidLicense:18,SecurityError:19,UnknownCameraID:20,UnknownItemID:21,NoPresetsAvailable:22,NotAllowedInThisState:23,FeatureIsDisabled:24,InsufficientUserRights:25,TooManySessions:26,NewConfigurationNotAvailable:27,AddressesNotReachable:28,PlaybackStreamsLimitReached:29,Redirection:30,MovingInvestigations:31,NoRecordingsFound:32,NoRecordingsInInterval:33,SecondStepAuthenticationRequired:34,SecondStepAuthenticationEnabledUsersOnly:35,SecondStepAuthenticationCodeError:36,SecondStepAuthenticationCodeExpired:37,InputParameterTooLong:43,ChallengesLimitReached:51,UknownIdOrInsufficientRightForSomeItems:52,UknownIdOrInsufficientRightForAllItems:53,ItemNotPlayable:54,ChangePassword:60,AccountLockedOut:61,Unknown:2147483647,IncorrectServerResponse:this.Unknown-21,SdkNotConnected:this.Unknown-20,HttpResponseError:this.Unknown-11,HttpRequestError:this.Unknown-10,CommandProcessingError:this.Unknown-3,CommandTimedOut:this.Unknown-2,InternalError:this.Unknown-1},function(){var b=0;XPMobileSDK.library.ConnectionRequest=function(r,e,o,t,i){var s=this;XPMobileSDK.addObserver(this),s.options=t||{},s.response=null,o.VideoConnection&&(s.VideoConnection=o.VideoConnection,delete o.VideoConnection),s.params=o||{};var a,n,c=!1,l=0,u=function(){var t="";for(key in o){function n(e,t){return'<Param Name="'+e+'" Value="'+(t=(t=void 0!==t&&t.toString?t.toString():"").replaceAll("&","&amp;").replace(/(\r\n|\r|\n)/g,"&#10;").replaceAll('"',"&quot;").replaceAll("<","&lt;"))+'" />'}void 0!==o[key]&&o[key]instanceof Array?o[key].forEach(function(e){t+=n(key,e)}):t+=n(key,o[key])}return'<?xml version="1.0" encoding="utf-8"?><Communication xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">'+(XPMobileSDK.library.Connection.connectionId?"<ConnectionId>"+XPMobileSDK.library.Connection.connectionId+"</ConnectionId >":"")+'<Command SequenceId="'+e+'"><Type>Request</Type><Name>'+r+"</Name><InputParams>"+t+"</InputParams></Command></Communication>\r\n\r\n"}(),d=function(e){if(/^http(s)?:/i.test(e))return e;var t=window.location.protocol+"//",n=document.location.hostname,r=document.location.port&&!/^:\d+/.test(e)?":"+document.location.port:"";return t+n+r+e}(XPMobileSDK.library.Connection.server)+XPMobileSDKSettings.communicationChanel,f=!1;function h(){"LiveMessage"==r&&(b=Date.now()),logger.log(u),a=XPMobileSDK.library.Ajax.Request(d,{contentType:"text/xml",postBody:u,onSuccess:m,onComplete:g,onFailure:s.options.failCallback||function(){p()}})}function g(e){4==e.readyState&&200!=e.status&&("LiveMessage"==r&&Date.now()-b<XPMobileSDKSettings.liveMessageMinimumInterval||function(){f||(logger.error("Command "+r+" failed"),"LiveMessage"!=r&&"CloseStream"!=r&&"RequestStream"!=r&&"Disconnect"!=r||(logger.warn("Restarting "+r),CommunicationStability.addBreakDown(s),setTimeout(function(){c=!1,h()}.bind(this),1e3)))}())}function m(){CommunicationStability.removeBreakDown(s),n&&(clearTimeout(n),n=null),c||(p(),c=!0),a=null}function p(){var e;try{var t=a.responseText}catch(e){return}for("<?xml"!=t.trim().substr(0,5)&&(s.response={isError:!0,errorCode:"The response from the server is not well-formatted",outputParameters:[]},i&&i(s));0<(e=t.indexOf("\r\n\r\n",l));){var n=t.substring(l,e);n&&((n=new XPMobileSDK.library.ConnectionResponse(n)).isProcessing||(s.response=n,c=!0,i&&i(s))),l=e+4}}h(),this.cancel=function(){n&&(clearTimeout(n),n=null),a&&(a.onreadystatechange=function(){},a.abort(),a=null,XPMobileSDK.library.Ajax.activeRequestCount--)},this.connectionDidDisconnect=function(){f=!0}}}(),XPMobileSDK.library.ConnectionResponse=function(t){var o=this;o.sequenceID=0,o.command="",o.isResponse=!1,o.isProcessing=!1,o.isError=!1,o.outputParameters=null,o.subItems=null,o.thumbnailBase64=null,o.exports=[],o.sequences=[],o.actions=[],o.items=[],o.errorCode=0,o.errorString="";var n,r,i,a,e,s=parseXML(t).getElementsByTagName("Communication")[0].getElementsByTagName("Command")[0],c=s.getElementsByTagName("Type")[0];if("Processing"==XMLNodeTextContent(c))logger.log("Processing..."),o.isProcessing=!0;else if("Response"==XMLNodeTextContent(c)){if(o.isResponse=!0,0<(c=s.getElementsByTagName("OutputParams")).length){o.outputParameters={};for(var l=c[0].getElementsByTagName("Param"),u=0,d=l.length;u<d;u++){for(var f,h="",g="",m=l[u].attributes,p=0;p<m.length;p++){var b=m[p];"Name"==b.name?h=b.value:"Value"==b.name&&(g=b.value)}h&&g&&(this.outputParameters[h]&&"string"==typeof this.outputParameters[h]?(f=this.outputParameters[h],this.outputParameters[h]=new Array,this.outputParameters[h].push(f)):"object"==typeof this.outputParameters[h]?this.outputParameters[h].push(g):this.outputParameters[h]=g)}}0<(c=s.getElementsByTagName("SubItems")).length&&(o.subItems=c[0]),0<(c=s.getElementsByTagName("ServerStatus")).length&&(o.ServerStatus={},0<(C=c[0].getElementsByTagName("CpuUsage")).length&&(o.ServerStatus.CPU=XMLNodeTextContent(C[0])),0<(C=c[0].getElementsByTagName("DiskUsage")).length&&(o.ServerStatus.HDD={},0<(e=C[0].getElementsByTagName("RecordingDiskUsageInBytes")).length&&(o.ServerStatus.HDD.recorded=XMLNodeTextContent(e[0])),0<(e=C[0].getElementsByTagName("ExportsDiskUsageInBytes")).length&&(o.ServerStatus.HDD.exports=XMLNodeTextContent(e[0])),0<(e=C[0].getElementsByTagName("UserDiskUsageInBytes")).length&&(o.ServerStatus.HDD.user=XMLNodeTextContent(e[0])),0<(e=C[0].getElementsByTagName("OtherDiskUsageInBytes")).length&&(o.ServerStatus.HDD.other=XMLNodeTextContent(e[0])),0<(e=C[0].getElementsByTagName("FreeSpaceInBytes")).length&&(o.ServerStatus.HDD.free=XMLNodeTextContent(e[0])))),(e=(C=s).getElementsByTagName("Thumbnail")[0])?o.thumbnailBase64="data:image/jpeg;base64,"+XMLNodeTextContent(e):(C=C.getElementsByTagName("ThumbnailJSON")[0])&&(o.thumbnailJSON=XMLNodeTextContent(C)),function(e){e=e.getElementsByTagName("Exports");if(0<e.length){o.exports=[];for(var t=e[0].getElementsByTagName("Export"),n=0;n<t.length;n++){var r=S(t[n],{numbers:["Size","State"],dates:["StartTime","EndTime","CompletedTime","QueuedTime"]});o.exports.push(r)}}}(s),function(e){e=e.getElementsByTagName("Sequences");if(0<e.length){o.sequences=[];for(var t=e[0].getElementsByTagName("Sequence"),n=0;n<t.length;n++){var r=S(t[n],{dates:["StartTime","EndTime","TimeStamp"]});o.sequences.push(r)}}}(s),function(e){var n="00000000-0000-0000-0000-000000000000";o.actions=[];e=e.getElementsByTagName("OEHeaderGroup");0!=e.length&&(Array.prototype.forEach.call(e,function(t){var e=t.getElementsByTagName("OEItem");Array.prototype.forEach.call(e,function(e){e=S(e);e.Type=t.getAttribute("Name"),o.actions.push(e)})}),o.actions.sort(function(e,t){return"Outputs"==e.Type&&"Events"==t.Type?-1:"Events"==e.Type&&"Outputs"==t.Type?1:e.CameraId!=n&&t.CameraId==n?-1:e.CameraId==n&&t.CameraId!=n?1:e.Name<t.Name?-1:e.Name>t.Name?1:0}))}(s),i=s,a=function(e){for(var t=[],n=e.childNodes,r=0;r<n.length;r++)if("Item"==n[r].nodeName){var o={};if(0<n[r].attributes.length)for(var i=0;i<n[r].attributes.length;i++)o[n[r].attributes[i].name]=v(n[r].attributes[i].value);for(i=0;i<n[r].childNodes.length;i++)if("Properties"==n[r].childNodes[i].nodeName)for(var s=0;s<n[r].childNodes[i].attributes.length;s++)o[n[r].childNodes[i].attributes[s].name]=v(n[r].childNodes[i].attributes[s].value);else"Items"==n[r].childNodes[i].nodeName&&(o.Items=a(n[r].childNodes[i]));t.push(o)}return t},function(){for(var e=i.childNodes,t=null,n=0;n<e.length;n++)"Items"==e[n].nodeName&&(t=e[n]);t&&(o.items=a(t))}();var C=s.getElementsByTagName("Result")[0];if("OK"!=XMLNodeTextContent(C)){o.isError=!0,0<(c=s.getElementsByTagName("ErrorString")).length&&(o.errorString=XMLNodeTextContent(c[0])),0<(c=s.getElementsByTagName("ErrorCode")).length&&(o.errorCode=parseInt(XMLNodeTextContent(c[0]))),o.error={code:o.errorCode||XPMobileSDK.library.ConnectionError.Unknown,message:o.errorString||""};s=s.getElementsByTagName("Name");if(0<s.length){s=XMLNodeTextContent(s[0]);let e="CloseStream"===s?!1:!0;"LogIn"===s&&o.errorCode===XPMobileSDK.library.ConnectionError.SecondStepAuthenticationRequired&&(e=!1),e&&logger.error("Response error "+(o.errorString||(n=o.errorCode,Object.keys(XPMobileSDK.library.ConnectionError).forEach(function(e){XPMobileSDK.library.ConnectionError[e]==n&&(r=e)}),r))+" "+(o.errorCode||"")+" Complete response: "+t)}}}function S(e,t){for(var n={},r=0;r<e.attributes.length;r++){var o=e.attributes[r];t&&t.numbers&&-1!=t.numbers.indexOf(o.name)?n[o.name]=Number(o.value):t&&t.dates&&-1!=t.dates.indexOf(o.name)?n[o.name]=new Date(parseInt(o.value)):n[o.name]=v(o.value)}return n}function v(e){for(var t=["<",">"],n=0,r=t.length;n<r;++n)e=e.replace(new RegExp(t[n],"g"),"");return e}},void 0!==window.DOMParser)parseXML=function(e){return(new window.DOMParser).parseFromString(e,"text/xml")},XMLNodeTextContent=function(e){return e.textContent};else{if(void 0===window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))throw new Error("No XML parser found");parseXML=function(e){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t},XMLNodeTextContent=function(e){return e.text}}XPMobileSDK.library.PullConnectionObserverInterface={onError:function(e){},onHTTPError:function(e){},onPushFailed:function(){},notifyChannel:function(e){},notifyObservers:function(e){},videoConnectionTemporaryDown:function(e){},restart:function(){}},XPMobileSDK.library.PullConnection=function(n,e){var r={method:"post",contentType:"text/xml",onLoading:function(e){{var t;l()&&(f(),t=XPMobileSDKSettings.videoConnectionTimeout,o.ajaxRequestTimeout=setTimeout(function(){e&&(logger.warn("aborting video request for "+o.videoId),e.onreadystatechange=function(){},e.abort(),XPMobileSDK.library.Ajax.activeRequestCount--,h("onError",e))}.bind(this),t))}},onSuccess:function(t){if(0!=t.status||t.response&&0!==t.response.byteLength){if(c()){h("notifyChannel",!0),f();try{var e,n=t.response,r=new XPMobileSDK.library.VideoHeaderParser(n);r.duration&&(e=1e3*r.duration*.8),h("notifyObservers",r),f(),o.videoConnectionState==XPMobileSDK.library.VideoConnectionState.running&&(r.stream&&r.stream.timeBetweenFrames?(s=2*r.stream.timeBetweenFrames/3,o.requestNextFrameInterval=s):s?o.requestNextFrameInterval=s:r.dataSize||o.signalType!=XPMobileSDK.interfaces.VideoConnectionSignal.live?o.requestNextFrameInterval=e||NETWORK.requestTime:o.requestNextFrameInterval=Math.min(NETWORK.MAX_REQUEST_TIME,o.requestNextFrameInterval*function(e){var t=e-10,e=e+10;return Math.floor(Math.random()*(e-t+1))+t}(100*NETWORK.REQUEST_TIME_GROW_PER_EMPTY_FRAME)/100),a(o.requestNextFrameInterval)),0}catch(e){logger.error("Exception in video connection ajax response",e),logger.error(e.stack),h("onHTTPError",t)}}}else h("onHTTPError",t)},onFailure:function(e){logger.error("ERROR in ajax request for frame for video channel "+n),h("onHTTPError",e)}};e.signalType;"undefined"!=typeof ArrayBuffer&&(r.responseType="arraybuffer");var o=this;o.videoConnectionState=XPMobileSDK.library.VideoConnectionState.running;var i=[],s=0;function a(e){var t;(l()||c()||u())&&(t=e,!CommunicationStability.isBrokenDown()||(setTimeout(function(){a(t)},200),!1))&&u()&&(o.nextFrameTimeout=setTimeout(function(){d(),o.videoConnectionState!=XPMobileSDK.library.VideoConnectionState.closed&&(o.ajaxRequest=new XPMobileSDK.library.Ajax.Request(n,r))},e||1))}function c(){return o.videoConnectionState!=XPMobileSDK.library.VideoConnectionState.closed}function l(){return!o.ajaxRequest}function u(){return!o.nextFrameTimeout}function d(){o.nextFrameTimeout&&(clearTimeout(o.nextFrameTimeout),o.nextFrameTimeout=null)}function f(){o.ajaxRequestTimeout&&(clearTimeout(o.ajaxRequestTimeout),o.ajaxRequestTimeout=null)}function h(t,n){i.forEach(function(e){e&&e[t]&&e[t](n)})}this.restartConnection=function(e){try{if(h("videoConnectionTemporaryDown",e?e.status:-2),o.videoConnectionState==XPMobileSDK.library.VideoConnectionState.closed)return;h("restart")}catch(e){h("videoConnectionTemporaryDown",-1)}},this.cleanupCommunication=function(){d(),f(),o.ajaxRequest&&(4==o.ajaxRequest.readyState&&200==o.ajaxRequest.status||o.ajaxRequest.abort(),delete o.ajaxRequest,o.ajaxRequest=null),s=0},this.startCommunication=function(e){this.cleanupCommunication(),a(e)},this.videoConnectionChangedState=function(e){o.videoConnectionState=e},this.addObserver=function(e){i.push(e)},this.removeObserver=function(e){e=i.indexOf(e);-1!=e&&i.splice(e,1)}},XPMobileSDK.library.PushConnectionObserverInterface={onError:function(e){},onHTTPError:function(e){},onPushFailed:function(){},notifyChannel:function(e){},notifyObservers:function(e){},videoConnectionTemporaryDown:function(e){},restart:function(){}},XPMobileSDK.library.PushConnection=function(e,t){t.signalType;var n,r=null;this.videoConnectionState=XPMobileSDK.library.VideoConnectionState.notOpened;var o=[],i=null;this.startCommunication=function(){n||(i?Date.now()-i<XPMobileSDKSettings.videoStreamRestartMinimumInterval?setTimeout(function(){logger.warn("Restarting socket."),s()}.bind(this),XPMobileSDKSettings.socketRestartMinimumInterval):d("restart"):s())}.bind(this);var s=function(){try{n=new WebSocket(e)}catch(e){return this.videoConnectionState==XPMobileSDK.library.VideoConnectionState.closed?void 0:(logger.error("WebSocket initialization failed. Falling back to AJAX..."),void d("onPushFailed"))}n.binaryType="arraybuffer",n.onerror=function(e){d("onError",n)},n.onopen=a,n.onclose=function(){var e={readyState:n.readyState,status:n.status};n=null,i=i||new Date,d("onError",e)}.bind(this)}.bind(this);this.restartConnection=function(e){logger.warn("Restarting socket."),this.startCommunication()}.bind(this),this.close=function(){n&&(n.onopen=null,n.onmessage=null,n.onerror=null,n.onclose=null,n.close(),n=null,this.messageInterval&&(clearInterval(this.messageInterval),this.messageInterval=null),logger.log("WebSocket closed"))}.bind(this);var a=function(e){n.onmessage=c,n.onerror=l,n.onclose=u,window.addEventListener("beforeunload",this.close),this.messageInterval=setInterval(function(){n&&n.send("")},NETWORK.websocketSendMessage),d("notifyChannel",!0),logger.log("WebSocket open")}.bind(this),c=function(e){r&&(delete r,r=null),r=new XPMobileSDK.library.VideoHeaderParser(e.data),d("notifyObservers",r)}.bind(this),l=function(e){logger.error("WebSocket error",e),this.messageInterval&&(clearInterval(this.messageInterval),this.messageInterval=null)}.bind(this),u=function(e){n.onopen=null,n.onmessage=null,n.onerror=null,n.onclose=null,n=null,this.messageInterval&&(clearInterval(this.messageInterval),this.messageInterval=null),this.videoConnectionState==XPMobileSDK.library.VideoConnectionState.running&&XPMobileSDK.library.Connection.connectionId&&(this.restartConnection(),d("videoConnectionTemporaryDown"))}.bind(this);this.cleanupCommunication=function(){this.close()},this.videoConnectionChangedState=function(e){this.videoConnectionState=e},this.addObserver=function(e){o.push(e)},this.removeObserver=function(e){e=o.indexOf(e);-1!=e&&o.splice(e,1)};var d=function(t,n){o.forEach(function(e){e&&e[t]&&e[t](n)})}.bind(this)},XPMobileSDK.library.VideoConnectionSignal={live:1,playback:2},XPMobileSDK.library.VideoConnectionState={notOpened:0,running:1,closed:2,closing:3},XPMobileSDK.library.VideoConnectionStream={native:1,transcoded:3,FragmentedMP4:4},XPMobileSDK.library.VideoConnectionObserverInterface={videoConnectionReceivedFrame:function(e){},videoConnectionFailed:function(){},videoConnectionTemporaryDown:function(e){},videoConnectionRecovered:function(){},videoConnectionChangedState:function(){},videoConnectionStreamingError:function(){}},XPMobileSDK.library.VideoConnection=function(e,t,n){XPMobileSDK.library.VideoConnection.instances.push(this),(n=n||{}).onClose=n.onClose||function(e){},n.onRestart=n.onRestart||function(e){},n.onPushFailed=n.onPushFailed||function(){};var r=this,o=[],i=XPMobileSDK.library.VideoConnectionState.notOpened;r.request={parameters:t.params,options:t.options},r.response={parameters:t.response.outputParameters},r.videoId=e,r.request.options&&(r.cameraId=r.request.options.cameraId,r.signalType=r.request.options.signal,r.isReusable=r.request.options.reuseConnection),r.isPush="Push"==r.request.parameters.MethodType,r.isDirectStreaming="FragmentedMP4"==r.request.parameters.StreamType,r.supportsPTZ="Yes"==r.response.parameters.PTZ,r.supportsPTZPresets="Yes"==r.response.parameters.Preset,r.supportsPlayback="Yes"==r.response.parameters.Playback,r.supportsExport="Yes"==r.response.parameters.ExportAvi;var s=null,a=new function(e){this.connected=!1,this.current;for(var t,n=[],r=0;t=e["VideoChannel"+r];r++)n.push(m(t));n.length||n.push(m(XPMobileSDKSettings.MobileServerURL+XPMobileSDKSettings.videoChanel));logger.log("Available video channels: ",n),this.getNext=function(){return this.connected||(this.current=n.shift()),this.current}.bind(this),this.hasNext=function(){return!this.connected&&n.length}.bind(this),this.getNext()}(r.response.parameters),c=a.current,l=null;this.open=function(){switch(i){case XPMobileSDK.library.VideoConnectionState.notOpened:p(XPMobileSDK.library.VideoConnectionState.running),window.Worker&&XPMobileSDKSettings.supportsMultiThreaded?(logger.info("Opening multithreaded video connection "+r.videoId+" with Web Worker"),r.worker=new Worker("js/ThreadConnection.js"),r.worker.addEventListener("message",function(e){"onPushFailed"==e.data.message?n.onPushFailed():y(e.data.message,e.data.result)},!1),r.worker.postMessage({message:"startCommunication",arguments:{url:c+"/"+r.videoId+"/",signalType:r.signalType,isPush:r.isPush}})):(r.isPush?(logger.info("Opening WebSocket video connection "+r.videoId),r.communication=new XPMobileSDK.library.PushConnection(c+"/"+r.videoId+"/",{signalType:r.signalType})):(logger.info("Opening AJAX video connection "+r.videoId),r.communication=new XPMobileSDK.library.PullConnection(c+"/"+r.videoId+"/",{signalType:r.signalType})),r.communication.addObserver({onError:S,onHTTPError:C,onPushFailed:b,notifyChannel:h,notifyObservers:f,videoConnectionTemporaryDown:v,restart:r.restart}),r.addObserver(r.communication),r.communication.startCommunication()),y("videoConnectionChangedState",i),i==XPMobileSDK.library.VideoConnectionState.running&&u();break;case XPMobileSDK.library.VideoConnectionState.running:r.isReusable?logger.info("Opening a reusable video connection from the pool "+r.videoId):logger.warn("WARNING: Attempting to open a running connection!"),u();break;case XPMobileSDK.library.VideoConnectionState.closed:logger.warn("WARNING: Attempting to re-open a closed connection!"),d()}};var u=function(){l&&clearTimeout(l),l=setTimeout(function(){y("noVideoTimeout")},XPMobileSDKSettings.NoVideoTimeout)},d=function(){l&&clearTimeout(l)};function f(e){if(e.stream&&e.stream.error)switch(e.stream.error){case XPMobileSDK.library.ItemHeaderParser.Error.NonFatal:r.request.parameters.StreamType="Transcoded",r.restart();break;case XPMobileSDK.library.ItemHeaderParser.Error.Fatal:y("videoConnectionStreamingError"),r.close()}else 0<o.length?(y("videoConnectionReceivedFrame",e),u(),r.wasConnectionDown&&(r.wasConnectionDown=!1,y("videoConnectionRecovered"))):(logger.warn("Video connection received an item but doesn't have observer to send it to!"),r.close())}function h(e){a.connected=e}function g(){y("cleanupCommunication"),r.worker&&XPMobileSDKSettings.supportsMultiThreaded&&(r.worker.terminate(),r.worker=null)}function m(e){return/^(http|ws)(s)?:/i.test(e)||(e=window.location.protocol+"//"+document.location.hostname+(document.location.port&&!/^:\d+/.test(e)?":"+document.location.port:"")+e),r.isPush?e.replace(/^http(s)?:/i,"ws$1:"):e.replace(/^ws(s)?:/i,"http$1:")}function p(e){i!=e&&y("videoConnectionChangedState",i=e)}function b(){n.onPushFailed()}function C(e){a.connected&&CommunicationStability.addVideoBreakDown(),S(e)}function S(e){if(i!=XPMobileSDK.library.VideoConnectionState.closed&&null!=XPMobileSDK.library.Connection.connectionId){if(a.connected)if(e.status){if(410==e.status)return void y("restartConnection",e);v(e.status)}else e.readyState&&e.readyState==WebSocket.CLOSED||0!=e.status||e.response&&0!==e.response.byteLength||v(e.status);else{if(!a.hasNext())return void y("videoConnectionNotAvailable");logger.log("Try next video channel."),c=a.getNext()}y("startCommunication",NETWORK.requestTimeOnFailure)}}function v(e){r.wasConnectionDown=!0,y("videoConnectionTemporaryDown",e)}function y(t,n){o.forEach(function(e){e&&e[t]&&e[t](n),r.worker&&r.worker.postMessage({message:t,arguments:n})})}this.restart=function(){i!=XPMobileSDK.library.VideoConnectionState.closed&&(logger.warn("Restarting video connection "+r.videoId+" for camera "+r.cameraId),p(XPMobileSDK.library.VideoConnectionState.closed),n.onRestart(r),g())},this.close=function(){d(),i!=XPMobileSDK.library.VideoConnectionState.closed&&i!=XPMobileSDK.library.VideoConnectionState.closing&&(p(XPMobileSDK.library.VideoConnectionState.closing),r.worker&&XPMobileSDKSettings.supportsMultiThreaded&&r.worker.terminate(),logger.log("Closing video connection "+r.videoId+" for camera "+r.cameraId),p(XPMobileSDK.library.VideoConnectionState.closed),n.onClose(r),g())},this.addObserver=function(e){o.push(e)},this.removeObserver=function(e){e=o.indexOf(e);-1!=e&&o.splice(e,1)},this.resetCommunication=function(){y("startCommunication")},this.destroy=function(){r.close(),s&&(s.destroy(),s=null),o=[],r.isPush||(onAjaxComplete=null,onAjaxFailure=null,onAjaxLoading=null,frameRequestParams=null,-1!=XPMobileSDK.library.VideoConnection.indexOf(this)&&XPMobileSDK.library.VideoConnection.splice(XPMobileSDK.library.VideoConnection.indexOf(this),1))},this.getState=function(){return i}},XPMobileSDK.library.VideoConnection.instances=[];let VideoStreamState={new:0,open:1,closed:2};class VideoStream{constructor(e,t,n){this.videoConnectionElement=document.createElement("video-connection"),this.videoConnectionElement.videoId=this.videoId=e,this.videoConnectionElement.location=XPMobileSDKSettings.MobileServerURL+XPMobileSDKSettings.videoChanel,this.videoConnectionElement.addEventListener("onReceivedFrame",this.onReceivedFrame.bind(this));let r=document.getElementsByTagName("videos-video-connection-manager")[0];r&&r.appendChild(this.videoConnectionElement),this.request={parameters:t.params,options:t.options},this.response={parameters:t.response.outputParameters},this.request.options&&(this.cameraId=this.request.options.cameraId,this.signalType=this.request.options.signal,this.isReusable=this.request.options.reuseConnection),this.isPush="Push"==this.request.parameters.MethodType,this.isDirectStreaming="FragmentedMP4"==this.request.parameters.StreamType,this.supportsPTZ="Yes"==this.response.parameters.PTZ,this.supportsPTZPresets="Yes"==this.response.parameters.Preset,this.supportsPlayback="Yes"==this.response.parameters.Playback,this.supportsExport="Yes"==this.response.parameters.ExportAvi,this.callbacks=n||{},this.callbacks.onClose=this.callbacks.onClose||function(e){},this.callbacks.onRestart=this.callbacks.onRestart||function(e){},this.callbacks.onPushFailed=this.callbacks.onPushFailed||function(){},this.observers=[],this.state=VideoStreamState.new}open(){this.state!==VideoStreamState.closed&&(this.videoConnectionElement.dispatchEvent(new CustomEvent("start")),this.state=VideoStreamState.closed)}close(){let e=document.getElementsByTagName("videos-video-connection-manager")[0];e&&e.contains(this.videoConnectionElement)&&e.removeChild(this.videoConnectionElement),this.videoConnectionElement.dispatchEvent(new CustomEvent("destroy")),XPMobileSDK.closeStream(this.videoId),this.state=VideoStreamState.close}onReceivedFrame(e){0<this.observers.length?this.callMethodOnObservers("videoConnectionReceivedFrame",e.detail.frame):(logger.warn("Video connection received an item but doesn't have observer to send it to!"),this.close())}addObserver(e){this.observers.push(e)}removeObserver(e){e=this.observers.indexOf(e);-1!=e&&this.observers.splice(e,1)}callMethodOnObservers(t,n){this.observers.forEach(function(e){e&&e[t]&&e[t](n)})}}!function(){function f(c){var o=this,l=0,t=function(e){return e},n=function(e){return Array.prototype.reverse.call(e)};function r(e){l+=e}function i(e){var t=new Uint8Array(c,l,e),n=0;l+=e;for(var r=0;r<e;r++)n+=t[r]*Math.pow(2,8*r);return n}function s(e,t){for(var n,r,o,i=t(new Uint8Array(c,l,e)),s="",a=0;a<e;a++)s+=(n=i[a],o=r=void 0,r="",r+=(o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"])[(240&n)>>4],r+=o[15&n]);return l+=e,s}function a(e){return s(e,t)}function u(e){return s(e,n)}function d(){var e="";return e+=u(4),e+="-",e+=u(2),e+="-",e+=u(2),e+="-",e+=a(2),e+="-",e+=a(6)}o.readBytes=i,o.skipBytes=r,o.getGUID=d,o.parseSizeInformation=function(){o.sizeInfo={sourceSize:{},sourceCrop:{},destinationSize:{}},o.sizeInfo.sourceSize.width=i(4),o.sizeInfo.sourceSize.height=i(4),o.sizeInfo.sourceCrop.left=i(4),o.sizeInfo.sourceCrop.top=i(4),o.sizeInfo.sourceCrop.right=i(4),o.sizeInfo.sourceCrop.bottom=i(4),o.sizeInfo.sourceCrop.width=o.sizeInfo.sourceCrop.right-o.sizeInfo.sourceCrop.left,o.sizeInfo.sourceCrop.height=o.sizeInfo.sourceCrop.bottom-o.sizeInfo.sourceCrop.top,o.sizeInfo.destinationSize.width=i(4),o.sizeInfo.destinationSize.height=i(4),o.sizeInfo.destinationSize.resampling=i(4),o.sizeInfo.destinationSize.top=i(4),o.sizeInfo.destinationSize.right=i(4),o.sizeInfo.destinationSize.bottom=i(4)},o.parseLiveInformation=function(){o.currentLiveEvents=i(4),o.changedLiveEvents=i(4)},o.parsePlaybackInformation=function(){o.currentPlaybackEvents=i(4),o.changedPlaybackEvents=i(4)},o.parsePlaybackInfo=function(){o.requestedTimeStampUtcMs=i(8),i(4),i(4)},o.parseStreamInfo=function(){o.stream={},o.stream.headerSize=i(4),o.stream.headerVesion=i(4),o.stream.reserved=i(4),o.stream.validFields=i(4),o.stream.timeBetweenFrames=i(4),o.stream.dataType=function(e,t){for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(i(1)));return(t?n.reverse():n).join("")}(4,!0),o.stream.flags=i(4),o.stream.profile=i(4),o.stream.level=i(4),o.stream.compatibility=i(4),o.stream.constrains=i(8),o.stream.frameCount=i(4),o.stream.hasKeyFrame=(o.stream.flags&f.StreamInfoFlags.HasKeyFrame)===f.StreamInfoFlags.HasKeyFrame},o.retrieveData=function(){o.data=new Uint8Array(c,o.headerSize,o.dataSize)},o.parseDynamicInformation=function(){var e;r(8),e=i(4),i(4)==f.DynamicInfoDataType.HeaderTypeDeviceStateInfo&&function(e){var t,n;o.errorCodes=[];for(var r=0;r<e;r++)n=d(),t=i(8),o.errorCodes.push({code:t,guid:n})}(e)}}(f.Type={}).Frame=1,f.Type.Fragment=2,(f.Error={}).NonFatal=1,f.Error.Fatal=2,f.MainHeaderLength=36,f.SizeInfoHeaderLength=32,f.LiveInfoHeaderLength=8,f.PlaybackInfoHeaderLength=8,f.HeaderExtensionSize=1,f.HeaderExtensionLiveEvents=2,f.HeaderExtensionPlaybackEvents=4,f.HeaderExtensionNative=8,f.HeaderExtensionMotionEvents=16,f.HeaderExtensionLocationInfo=32,f.HeaderExtensionStreamInfo=64,f.HeaderExtensionCarouselInfo=128,f.HeaderExtensionDynamicInfo=256,f.HeaderExtensionPlaybackInfo=512,(f.LiveFlags={}).LiveFeed=1,f.LiveFlags.Motion=2,f.LiveFlags.Recording=4,f.LiveFlags.Notification=8,f.LiveFlags.CameraConnectionLost=16,f.LiveFlags.DatabaseFail=32,f.LiveFlags.DiskFull=64,f.LiveFlags.ClientLiveStopped=128,(f.PlaybackFlags={}).Stopped=1,f.PlaybackFlags.Forward=2,f.PlaybackFlags.Backward=4,f.PlaybackFlags.DatabaseStart=16,f.PlaybackFlags.DatabaseEnd=32,f.PlaybackFlags.DatabaseError=64,f.PlaybackFlags.RangeNoData=256,f.PlaybackFlags.OutOfRange=512,(f.DynamicInfoDataType={}).HeaderTypeDeviceStateInfo=0,(f.StreamInfoFlags={}).HasKeyFrame=1,XPMobileSDK.library.ItemHeaderParser=f}(),XPMobileSDK.library.VideoHeaderParser=function(e){var t=this;XPMobileSDK.library.ItemHeaderParser.call(t,e),t.parseMotionInformation=function(){t.motionHeaderSize=readBytes(4),t.motionAmount=readBytes(4)},t.convertToImage=function(){t.type=XPMobileSDK.library.ItemHeaderParser.Type.Frame,t.blob=new Blob([t.data],{type:"image/jpeg"})},t.parseCarouselInfo=function(){t.carousel={},t.carousel.headerSize=readBytes(4),t.carousel.headerVesion=readBytes(4),t.carousel.itemId=getGUID()},function(){t.uuid=t.getGUID(),t.timestamp=new Date(t.readBytes(8)),t.frameNumber=t.readBytes(4),t.dataSize=t.readBytes(4),t.headerSize=t.readBytes(2);var e=t.readBytes(2);t.hasSizeInformation=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionSize,t.hasLiveInformation=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionLiveEvents,t.hasPlaybackInformation=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionPlaybackEvents,t.hasNativeData=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionNative,t.hasMotionInformation=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionMotionEvents,t.hasLocationData=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionLocationInfo,t.hasStreamInfo=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionStreamInfo,t.hasCarouselInfo=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionCarouselInfo,t.hasPlaybackInfo=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionPlaybackInfo,t.hasSizeInformation&&t.parseSizeInformation(),t.hasLiveInformation&&t.parseLiveInformation(),t.hasPlaybackInformation&&t.parsePlaybackInformation(),t.hasNativeData&&t.readBytes(readBytes(4)),t.hasMotionInformation&&t.parseMotionInformation(),t.hasLocationData&&t.readBytes(readBytes(4)),t.hasStreamInfo&&t.parseStreamInfo(),t.hasCarouselInfo&&t.parseCarouselInfo(),t.hasPlaybackInfo&&t.parsePlaybackInfo()}(),t.dataSize<=0||(t.retrieveData(),t.stream&&"JPEG"!==t.stream.dataType||t.convertToImage())},XPMobileSDK.library.AudioHeaderParser=function(e){var t=this;XPMobileSDK.library.ItemHeaderParser.call(t,e),function(){t.uuid=t.getGUID(),t.skipBytes(18);var e=t.readBytes(2);t.skipBytes(4),e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionDynamicInfo&&t.parseDynamicInformation()}()},XPMobileSDK.library.VideoConnectionPool=new function(){function n(e,t){this.id=e,this.videoConnection=t,this.response=void 0,this.count=1,this.pendingCallbacks=[]}this.cameras=[],this.containsCameraByVideoId=function(t,n){return this.cameras.some(e=>e.id===t&&e.videoConnection&&e.videoConnection.videoId===n)},this.addCamera=function(e,t){this.cameras.push(new n(e,t))},this.removeCamera=function(t,n){var e=this.cameras.findIndex(e=>e.id==t&&e.videoConnection&&e.videoConnection.videoId==n);this.cameras.splice(e,1)},this.clear=function(){this.cameras=[]},this.getCameraByVideoId=function(t,n){return this.cameras.find(e=>e.id===t&&e.videoConnection&&e.videoConnection.videoId==n)}.bind(this)},XPMobileSDK.library.VideoPushConnection=function(e,t,n){this.open=function(e,t){l.onStreamSuccess=e||l.onStreamSuccess,l.onStreamError=t||l.onStreamError,g()||(o=XPMobileSDK.requestPushStream(h))},this.close=f,this.send=function(e){var t=XPMobileSDK.library.Bytes.fromBase64(e),n=new ArrayBuffer(a+t.length),e=new Uint8Array(n);e.set(XPMobileSDK.library.Bytes.fromGuid(r.videoId,16)),e.set(XPMobileSDK.library.Bytes.fromInt((new Date).getTime(),8),16),e.set(XPMobileSDK.library.Bytes.fromInt(++c,4),24),e.set(XPMobileSDK.library.Bytes.fromInt(t.length,4),28),e.set(XPMobileSDK.library.Bytes.fromInt(a,2),32),e.set(XPMobileSDK.library.Bytes.fromInt(0,2),34),e.set(t,a);t=XPMobileSDKSettings.MobileServerURL+XPMobileSDKSettings.videoChanel+"/"+r.videoId+"/",n={method:"post",contentType:"arraybuffer",postBody:n,onLoading:m,onSuccess:p,onFailure:b};new XPMobileSDK.library.Ajax.Request(t,n)},this.destroy=function(){f(),i&&(i.getTracks().forEach(function(e){e.stop()}),i=null)},this.isOpen=g,this.getMediaStream=function(){return i};var r,o,i,s=this,a=36,c=0,l={onSuccess:function(e){},onError:function(e){},onStreamSuccess:function(e){},onStreamError:function(e){}};function u(e){i=e,l.onSuccess(s)}function d(e){logger.error(e.name),l.onError(e)}function f(){g()&&(o&&(XPMobileSDK.cancelRequest(o),o=null),r&&(XPMobileSDK.closeStream(r.videoId),r=null))}function h(e,t){o=null,e?(r=e,l.onStreamSuccess(s)):l.onStreamError(t)}function g(){return r||o}function m(e){}function p(e){}function b(e){logger.error("ERROR in ajax request for video push with videoId "+r.videoId)}l.onSuccess=e||l.onSuccess,l.onError=t||l.onError,n?l.onSuccess(s):navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(u).catch(d):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:!0,audio:!1},u,d):logger.warn("Video push not supported!"))},XPMobileSDK.library.AudioPushConnection=function(r,o,e,t){this.open=function(e,t,n){l.onStreamSuccess=e||l.onStreamSuccess,l.onStreamError=t||l.onStreamError,h()||(t={AudioSamplingRate:o||8e3,AudioBitsPerSample:16},s=XPMobileSDK.requestAudioStreamIn(r,t,d,f))},this.close=u,this.send=function(e){var t,n;i&&(n=new ArrayBuffer(a+e.length),(t=new Int8Array(n)).set(XPMobileSDK.library.Bytes.fromGuid(i.StreamId,16)),t.set(XPMobileSDK.library.Bytes.fromInt((new Date).getTime(),8),16),t.set(XPMobileSDK.library.Bytes.fromInt(++c,4),24),t.set(XPMobileSDK.library.Bytes.fromInt(e.length,4),28),t.set(XPMobileSDK.library.Bytes.fromInt(a,2),32),t.set(XPMobileSDK.library.Bytes.fromInt(0,2),34),t.set(e,a),e=XPMobileSDKSettings.MobileServerURL+XPMobileSDKSettings.audioChannel+"/"+i.StreamId,n={method:"post","Transfer-Encoding":"chunked",contentType:"arraybuffer",postBody:n,timeout:2e3,responseType:"arraybuffer",onLoading:l.onAjaxLoading,onSuccess:l.onAjaxSuccess,onFailure:l.onAjaxFailure,onTimeout:l.onAjaxFailure},new XPMobileSDK.library.Ajax.Request(e,n))},this.destroy=function(){u()},this.isOpen=h;var i,s,n=this,a=36,c=0,l={onStreamSuccess:function(e){},onStreamError:function(e){},onAjaxLoading:function(){},onAjaxSuccess:function(e){},onAjaxFailure:function(){logger.error("ERROR in ajax request for audio push")}};function u(){h()&&(s&&(XPMobileSDK.cancelRequest(s),s=null),i&&(XPMobileSDK.closeStream(i.StreamId),i=null))}function d(e,t){s=null,e?(i=e,l.onStreamSuccess(n)):l.onStreamError(t)}function f(e){i=s=null,l.onStreamError(e)}function h(){return i||s}l.onAjaxSuccess=e||l.onAjaxSuccess,l.onAjaxFailure=t||l.onAjaxFailure};class AudioAvailability{static isOutgoingAudioNotSupported(){return!XPMobileSDKSettings.SupportsAudioIn||!XPMobileSDK.features.SupportsOutgoingAudio}static isOutgoingPTTAudioNotSupported(){return!XPMobileSDKSettings.SupportsAudioIn||!XPMobileSDK.features.SupportsOutgoingPTTAudio}static isLiveFeatureNotSupported(){return AudioAvailability.isOutgoingAudioNotSupported()}static isPlaybackFeatureNotSupported(){return AudioAvailability.isOutgoingAudioNotSupported()&&AudioAvailability.isOutgoingPTTAudioNotSupported()}static noAvailableMics(e){return AudioAvailability.isOutgoingAudioNotSupported()||!e||!e.length}static noAvailableSpeakers(e){return AudioAvailability.isOutgoingPTTAudioNotSupported()||!e||!e.length}}_defineProperty(AudioAvailability,"mimecodec","audio/mpeg"),XPMobileSDK.library.AudioAvailability=AudioAvailability;
//# sourceMappingURL=../maps/XPMobileSDK.library.js.map
