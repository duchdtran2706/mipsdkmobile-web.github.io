function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}var logger={info:function(){console&&console.info(...arguments)},error:function(){console&&console.error(...arguments)},warn:function(){console&&console.warn(...arguments)},log:function(){console&&console.log(...arguments)},init:function(){XPMobileSDKSettings.EnableConsoleLog?"error"===XPMobileSDKSettings.EnableConsoleLog?(logger.log=function(){},logger.info=function(){},logger.warn=function(){}):"warn"===XPMobileSDKSettings.EnableConsoleLog&&(logger.log=function(){},logger.info=function(){}):(logger.log=function(){},logger.info=function(){},logger.error=function(){},logger.warn=function(){})}};for(logger.init(),"function"!=typeof Object.assign&&(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=1;o<arguments.length;o++){var r=arguments[o];if(r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n}),!function(){if(window.localStorage&&window.sessionStorage){var e,t=["sessionStorage","localStorage"];for(e in t)XPMobileSDK[t[e]]={storage:window[t[e]],setItem:function(e,t,n){n?(n={value:t,expiration:(new Date).getTime()+n},this.storage.setItem(e,"expiration::"+JSON.stringify(n))):"boolean"==typeof t?this.storage.setItem(e,"boolean::"+t):"number"==typeof t?this.storage.setItem(e,"number::"+t):"object"==typeof t?this.storage.setItem(e,"object::"+JSON.stringify(t)):this.storage.setItem(e,t)},getItem:function(e){var t,n=this.storage.getItem(e);return null==n?null:0==n.indexOf("expiration::")?(t=JSON.parse(n.substr(n.indexOf("::")+2)),(new Date).getTime()>t.expiration?(this.storage.removeItem(e),null):t.value):0==n.indexOf("boolean::")?"boolean::true"==n:0==n.indexOf("number::")?parseFloat(n.substr(n.indexOf("::")+2)):0==n.indexOf("object::")?JSON.parse(n.substr(n.indexOf("::")+2)):n},removeItem:function(e){this.storage.removeItem(e)},clear:function(){this.storage.clear()},key:function(e){return this.storage.key(e)}}}}(),bpe=0,mask=0,radix=mask+1,digitsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\'\"+-",bpe=0;1<<bpe+1>1<<bpe;bpe++);function findPrimes(e){for(var t,n,o=new Array(e),r=0;r<e;r++)o[r]=0;for(o[0]=2,t=0;o[t]<e;){for(r=o[t]*o[t];r<e;r+=o[t])o[r]=1;for(o[++t]=o[t-1]+1;o[t]<e&&o[o[t]];o[t]++);}for(n=new Array(t),r=0;r<t;r++)n[r]=o[r];return n}function millerRabinInt(e,t){return mr_x1.length!=e.length&&(mr_x1=dup(e),mr_r=dup(e),mr_a=dup(e)),copyInt_(mr_a,t),millerRabin(e,mr_a)}function millerRabin(e,t){var n,o,r,i;for(mr_x1.length!=e.length&&(mr_x1=dup(e),mr_r=dup(e),mr_a=dup(e)),copy_(mr_a,t),copy_(mr_r,e),copy_(mr_x1,e),addInt_(mr_r,-1),addInt_(mr_x1,-1),n=r=0;n<mr_r.length;n++)for(o=1;o<mask;o<<=1)e[n]&o?(i=r<mr_r.length+bpe?r:0,n=mr_r.length,o=mask):r++;if(i&&rightShift_(mr_r,i),powMod_(mr_a,mr_r,e),!equalsInt(mr_a,1)&&!equals(mr_a,mr_x1)){for(o=1;o<=i-1&&!equals(mr_a,mr_x1);){if(squareMod_(mr_a,e),equalsInt(mr_a,1))return 0;o++}if(!equals(mr_a,mr_x1))return 0}return 1}function bitSize(e){for(var t,n,o=e.length-1;0==e[o]&&0<o;o--);for(t=0,n=e[o];n;n>>=1,t++);return t+=bpe*o}function expand(e,t){t=int2bigInt(0,(e.length>t?e.length:t)*bpe,0);return copy_(t,e),t}function randTruePrime(e){var t=int2bigInt(0,e,0);return randTruePrime_(t,e),trim(t,1)}function randProbPrime(e){return randProbPrimeRounds(e,600<=e?2:550<=e?4:500<=e?5:400<=e?6:350<=e?7:300<=e?9:250<=e?12:200<=e?15:150<=e?18:100<=e?27:40)}function randProbPrimeRounds(e,t){var n,o,r=int2bigInt(0,e,0);for(0==primes.length&&(primes=findPrimes(3e4)),rpprb.length!=r.length&&(rpprb=dup(r));;){for(randBigInt_(r,e,0),r[0]|=1,n=o=0;n<primes.length&&primes[n]<=3e4;n++)if(0==modInt(r,primes[n])&&!equalsInt(r,primes[n])){o=1;break}for(n=0;n<t&&!o;n++){for(randBigInt_(rpprb,e,0);!greater(r,rpprb);)randBigInt_(rpprb,e,0);millerRabin(r,rpprb)||(o=1)}if(!o)return r}}function mod(e,t){e=dup(e);return mod_(e,t),trim(e,1)}function addInt(e,t){e=expand(e,e.length+1);return addInt_(e,t),trim(e,1)}function mult(e,t){e=expand(e,e.length+t.length);return mult_(e,t),trim(e,1)}function powMod(e,t,n){e=expand(e,n.length);return powMod_(e,trim(t,2),trim(n,2),0),trim(e,1)}function sub(e,t){e=expand(e,e.length>t.length?e.length+1:t.length+1);return sub_(e,t),trim(e,1)}function add(e,t){e=expand(e,e.length>t.length?e.length+1:t.length+1);return add_(e,t),trim(e,1)}function inverseMod(e,t){e=expand(e,t.length);return inverseMod_(e,t)?trim(e,1):null}function multMod(e,t,n){e=expand(e,n.length);return multMod_(e,t,n),trim(e,1)}function randTruePrime_(e,t){var n,o,r,i,s,a,c,l,u;if(0==primes.length&&(primes=findPrimes(3e4)),0==pows.length)for(pows=new Array(512),r=0;r<512;r++)pows[r]=Math.pow(2,r/511-1);if(recLimit=20,s_i2.length!=e.length&&(s_i2=dup(e),s_R=dup(e),s_n1=dup(e),s_r2=dup(e),s_d=dup(e),s_x1=dup(e),s_x2=dup(e),s_b=dup(e),s_n=dup(e),s_i=dup(e),s_rm=dup(e),s_q=dup(e),s_a=dup(e),s_aa=dup(e)),t<=recLimit){for(n=(1<<(t+2>>1))-1,copyInt_(e,0),o=1;o;)for(e[o=0]=1|1<<t-1|Math.floor(Math.random()*(1<<t)),r=1;r<primes.length&&(primes[r]&n)==primes[r];r++)if(0==e[0]%primes[r]){o=1;break}carry_(e)}else{if(s=.1*t*t,40<t)for(i=1;t-t*i<=20;)i=pows[Math.floor(512*Math.random())];else i=.5;for(u=Math.floor(i*t)+1,randTruePrime_(s_q,u),copyInt_(s_i2,0),s_i2[Math.floor((t-2)/bpe)]|=1<<(t-2)%bpe,divide_(s_i2,s_q,s_i,s_rm),c=bitSize(s_i);;){for(;randBigInt_(s_R,c,0),!greater(s_i,s_R););for(addInt_(s_R,1),add_(s_R,s_i),copy_(s_n,s_q),mult_(s_n,s_R),multInt_(s_n,2),addInt_(s_n,1),copy_(s_r2,s_R),multInt_(s_r2,2),r=a=0;r<primes.length&&primes[r]<s;r++)if(0==modInt(s_n,primes[r])&&!equalsInt(s_n,primes[r])){a=1;break}if(!(a=a||millerRabinInt(s_n,2)?a:1)){for(addInt_(s_n,-3),r=s_n.length-1;0==s_n[r]&&0<r;r--);for(l=0,w=s_n[r];w;w>>=1,l++);for(l+=bpe*r;randBigInt_(s_a,l,0),!greater(s_n,s_a););if(addInt_(s_n,3),addInt_(s_a,2),copy_(s_b,s_a),copy_(s_n1,s_n),addInt_(s_n1,-1),powMod_(s_b,s_n1,s_n),addInt_(s_b,-1),isZero(s_b)&&(copy_(s_b,s_a),powMod_(s_b,s_r2,s_n),addInt_(s_b,-1),copy_(s_aa,s_n),copy_(s_d,s_b),GCD_(s_d,s_n),equalsInt(s_d,1)))return void copy_(e,s_aa)}}}}function randBigInt(e,t){var n=int2bigInt(0,0,Math.floor((e-1)/bpe)+2);return randBigInt_(n,e,t),n}function randBigInt_(e,t,n){for(var o,r=0;r<e.length;r++)e[r]=0;for(o=Math.floor((t-1)/bpe)+1,r=0;r<o;r++)e[r]=Math.floor(Math.random()*(1<<bpe-1));e[o-1]&=(2<<(t-1)%bpe)-1,1==n&&(e[o-1]|=1<<(t-1)%bpe)}function GCD(e,t){e=dup(e);return GCD_(e,dup(t)),e}function GCD_(e,n){var o,r,i,s,a,c,l,u,d;for(T.length!=e.length&&(T=dup(e)),d=1;d;){for(d=0,o=1;o<n.length;o++)if(n[o]){d=1;break}if(!d)break;for(o=e.length;!e[o]&&0<=o;o--);for(r=e[o],i=n[o],c=a=0,l=s=1;i+c&&i+l&&(u=Math.floor((r+s)/(i+c)))==(qp=Math.floor((r+a)/(i+l)));)t=s-u*c,s=c,c=t,t=a-u*l,a=l,l=t,t=r-u*i,r=i,i=t;a?(copy_(T,e),linComb_(e,n,s,a),linComb_(n,T,l,c)):(mod_(e,n),copy_(T,e),copy_(e,n),copy_(n,T))}if(0!=n[0])for(t=modInt(e,n[0]),copyInt_(e,n[0]),n[0]=t;n[0];)e[0]%=n[0],t=e[0],e[0]=n[0],n[0]=t}function inverseMod_(e,t){var n=1+2*Math.max(e.length,t.length);if(!(1&e[0]||1&t[0]))return copyInt_(e,0),0;for(eg_u.length!=n&&(eg_u=new Array(n),eg_v=new Array(n),eg_A=new Array(n),eg_B=new Array(n),eg_C=new Array(n),eg_D=new Array(n)),copy_(eg_u,e),copy_(eg_v,t),copyInt_(eg_A,1),copyInt_(eg_B,0),copyInt_(eg_C,0),copyInt_(eg_D,1);;){for(;!(1&eg_u[0]);)halve_(eg_u),1&eg_A[0]||1&eg_B[0]?(add_(eg_A,t),halve_(eg_A),sub_(eg_B,e)):halve_(eg_A),halve_(eg_B);for(;!(1&eg_v[0]);)halve_(eg_v),1&eg_C[0]||1&eg_D[0]?(add_(eg_C,t),halve_(eg_C),sub_(eg_D,e)):halve_(eg_C),halve_(eg_D);if(greater(eg_v,eg_u)?(sub_(eg_v,eg_u),sub_(eg_C,eg_A),sub_(eg_D,eg_B)):(sub_(eg_u,eg_v),sub_(eg_A,eg_C),sub_(eg_B,eg_D)),equalsInt(eg_u,0))return negative(eg_C)&&add_(eg_C,t),copy_(e,eg_C),equalsInt(eg_v,1)?1:(copyInt_(e,0),0)}}function inverseModInt(e,t){for(var n=1,o=0;;){if(1==e)return n;if(0==e)return 0;if(o-=n*Math.floor(t/e),1==(t%=e))return o;if(0==t)return 0;n-=o*Math.floor(e/t),e%=t}}function inverseModInt_(e,t){return inverseModInt(e,t)}function eGCD_(e,t,n,o,r){var i=0,s=Math.max(e.length,t.length);for(eg_u.length!=s&&(eg_u=new Array(s),eg_A=new Array(s),eg_B=new Array(s),eg_C=new Array(s),eg_D=new Array(s));!(1&e[0]||1&t[0]);)halve_(e),halve_(t),i++;for(copy_(eg_u,e),copy_(n,t),copyInt_(eg_A,1),copyInt_(eg_B,0),copyInt_(eg_C,0),copyInt_(eg_D,1);;){for(;!(1&eg_u[0]);)halve_(eg_u),1&eg_A[0]||1&eg_B[0]?(add_(eg_A,t),halve_(eg_A),sub_(eg_B,e)):halve_(eg_A),halve_(eg_B);for(;!(1&n[0]);)halve_(n),1&eg_C[0]||1&eg_D[0]?(add_(eg_C,t),halve_(eg_C),sub_(eg_D,e)):halve_(eg_C),halve_(eg_D);if(greater(n,eg_u)?(sub_(n,eg_u),sub_(eg_C,eg_A),sub_(eg_D,eg_B)):(sub_(eg_u,n),sub_(eg_A,eg_C),sub_(eg_B,eg_D)),equalsInt(eg_u,0))return negative(eg_C)&&(add_(eg_C,t),sub_(eg_D,e)),multInt_(eg_D,-1),copy_(o,eg_C),copy_(r,eg_D),void leftShift_(n,i)}}function negative(e){return e[e.length-1]>>bpe-1&1}function greaterShift(e,t,n){var o,r=e.length,i=t.length;for(k=r+n<i?r+n:i,o=i-1-n;o<r&&0<=o;o++)if(0<e[o])return 1;for(o=r-1+n;o<i;o++)if(0<t[o])return 0;for(o=k-1;n<=o;o--){if(e[o-n]>t[o])return 1;if(e[o-n]<t[o])return 0}return 0}function greater(e,t){for(var n=(e.length<t.length?e:t).length,o=e.length;o<t.length;o++)if(t[o])return 0;for(o=t.length;o<e.length;o++)if(e[o])return 1;for(o=n-1;0<=o;o--){if(e[o]>t[o])return 1;if(e[o]<t[o])return 0}return 0}function divide_(e,t,n,o){var r,i,s,a,c,l,u,d;for(copy_(o,e),i=t.length;0==t[i-1];i--);for(d=t[i-1],u=0;d;u++)d>>=1;for(leftShift_(t,u=bpe-u),leftShift_(o,u),r=o.length;0==o[r-1]&&i<r;r--);for(copyInt_(n,0);!greaterShift(t,o,r-i);)subShift_(o,t,r-i),n[r-i]++;for(s=r-1;i<=s;s--){for(o[s]==t[i-1]?n[s-i]=mask:n[s-i]=Math.floor((o[s]*radix+o[s-1])/t[i-1]);l=(c=(1<i?t[i-2]:0)*n[s-i])>>bpe,c&=mask,l=(a=l+n[s-i]*t[i-1])>>bpe,a&=mask,l==o[s]?a==o[s-1]?c>(1<s?o[s-2]:0):a>o[s-1]:l>o[s];)n[s-i]--;linCombShift_(o,t,-n[s-i],s-i),negative(o)&&(addShift_(o,t,s-i),n[s-i]--)}rightShift_(t,u),rightShift_(o,u)}function carry_(e){for(var t,n=e.length,o=0,r=0;r<n;r++)(o+=e[r])<(t=0)&&(o+=(t=-(o>>bpe))*radix),e[r]=o&mask,o=(o>>bpe)-t}function modInt(e,t){for(var n=0,o=e.length-1;0<=o;o--)n=(n*radix+e[o])%t;return n}function int2bigInt(e,t,n){t=Math.ceil(t/bpe)+1;return copyInt_(buff=new Array(t<n?n:t),e),buff}function str2bigInt(e,t,n){var o,r,i,s,a,c=e.length;if(-1==t){for(i=new Array(0);;){for(s=new Array(i.length+1),r=0;r<i.length;r++)s[r+1]=i[r];if(s[0]=parseInt(e,10),i=s,(o=e.indexOf(",",0))<1)break;if(0==(e=e.substring(o+1)).length)break}return i.length<n?(copy_(s=new Array(n),i),s):i}for(i=int2bigInt(0,t*c,0),r=0;r<c&&(o=digitsStr.indexOf(e.substring(r,r+1),0),t<=36&&36<=o&&(o-=26),!(t<=o||o<0));r++)multInt_(i,t),addInt_(i,o);for(c=i.length;0<c&&!i[c-1];c--);for(c=c+1<n?n:c+1,s=new Array(c),a=c<i.length?c:i.length,r=0;r<a;r++)s[r]=i[r];for(;r<c;r++)s[r]=0;return s}function equalsInt(e,t){var n;if(e[0]!=t)return 0;for(n=1;n<e.length;n++)if(e[n])return 0;return 1}function equals(e,t){for(var n=(e.length<t.length?e:t).length,o=0;o<n;o++)if(e[o]!=t[o])return 0;if(e.length>t.length){for(;o<e.length;o++)if(e[o])return 0}else for(;o<t.length;o++)if(t[o])return 0;return 1}function isZero(e){for(var t=0;t<e.length;t++)if(e[t])return 0;return 1}function bigInt2str(e,t){var n,o,r="";if(s6.length!=e.length?s6=dup(e):copy_(s6,e),-1==t){for(n=e.length-1;0<n;n--)r+=e[n]+",";r+=e[0]}else for(;!isZero(s6);)o=divInt_(s6,t),r=digitsStr.substring(o,o+1)+r;return r=0==r.length?"0":r}function dup(e){return copy_(buff=new Array(e.length),e),buff}function copy_(e,t){for(var n=(e.length<t.length?e:t).length,o=0;o<n;o++)e[o]=t[o];for(o=n;o<e.length;o++)e[o]=0}function copyInt_(e,t){for(var n=t,o=0;o<e.length;o++)e[o]=n&mask,n>>=bpe}function addInt_(e,t){var n,o,r,i;for(e[0]+=t,o=e.length,n=r=0;n<o;n++)if((r+=e[n])<(i=0)&&(r+=(i=-(r>>bpe))*radix),e[n]=r&mask,!(r=(r>>bpe)-i))return}function rightShift_(e,t){var n,o=Math.floor(t/bpe);if(o){for(n=0;n<e.length-o;n++)e[n]=e[n+o];for(;n<e.length;n++)e[n]=0;t%=bpe}for(n=0;n<e.length-1;n++)e[n]=mask&(e[n+1]<<bpe-t|e[n]>>t);e[n]>>=t}function halve_(e){for(var t=0;t<e.length-1;t++)e[t]=mask&(e[t+1]<<bpe-1|e[t]>>1);e[t]=e[t]>>1|e[t]&radix>>1}function leftShift_(e,t){var n,o=Math.floor(t/bpe);if(o){for(n=e.length;o<=n;n--)e[n]=e[n-o];for(;0<=n;n--)e[n]=0;t%=bpe}if(t){for(n=e.length-1;0<n;n--)e[n]=mask&(e[n]<<t|e[n-1]>>bpe-t);e[n]=mask&e[n]<<t}}function multInt_(e,t){var n,o,r,i;if(t)for(o=e.length,n=r=0;n<o;n++)(r+=e[n]*t)<(i=0)&&(r+=(i=-(r>>bpe))*radix),e[n]=r&mask,r=(r>>bpe)-i}function divInt_(e,t){for(var n,o=0,r=e.length-1;0<=r;r--)n=o*radix+e[r],e[r]=Math.floor(n/t),o=n%t;return o}function linComb_(e,t,n,o){for(var r=(e.length<t.length?e:t).length,i=e.length,s=0,a=0;a<r;a++)s+=n*e[a]+o*t[a],e[a]=s&mask,s>>=bpe;for(a=r;a<i;a++)s+=n*e[a],e[a]=s&mask,s>>=bpe}function linCombShift_(e,t,n,o){for(var r=e.length<o+t.length?e.length:o+t.length,i=e.length,s=0,a=o;a<r;a++)s+=e[a]+n*t[a-o],e[a]=s&mask,s>>=bpe;for(a=r;s&&a<i;a++)s+=e[a],e[a]=s&mask,s>>=bpe}function addShift_(e,t,n){for(var o=e.length<n+t.length?e.length:n+t.length,r=e.length,i=0,s=n;s<o;s++)i+=e[s]+t[s-n],e[s]=i&mask,i>>=bpe;for(s=o;i&&s<r;s++)i+=e[s],e[s]=i&mask,i>>=bpe}function subShift_(e,t,n){for(var o=e.length<n+t.length?e.length:n+t.length,r=e.length,i=0,s=n;s<o;s++)i+=e[s]-t[s-n],e[s]=i&mask,i>>=bpe;for(s=o;i&&s<r;s++)i+=e[s],e[s]=i&mask,i>>=bpe}function sub_(e,t){for(var n=(e.length<t.length?e:t).length,o=0,r=0;r<n;r++)o+=e[r]-t[r],e[r]=o&mask,o>>=bpe;for(r=n;o&&r<e.length;r++)o+=e[r],e[r]=o&mask,o>>=bpe}function add_(e,t){for(var n=(e.length<t.length?e:t).length,o=0,r=0;r<n;r++)o+=e[r]+t[r],e[r]=o&mask,o>>=bpe;for(r=n;o&&r<e.length;r++)o+=e[r],e[r]=o&mask,o>>=bpe}function mult_(e,t){var n;for(copyInt_(ss=ss.length!=2*e.length?new Array(2*e.length):ss,0),n=0;n<t.length;n++)t[n]&&linCombShift_(ss,e,t[n],n);copy_(e,ss)}function mod_(e,t){s4.length!=e.length?s4=dup(e):copy_(s4,e),s5.length!=e.length&&(s5=dup(e)),divide_(s4,t,s5,e)}function multMod_(e,t,n){var o;for(copyInt_(s0=s0.length!=2*e.length?new Array(2*e.length):s0,0),o=0;o<t.length;o++)t[o]&&linCombShift_(s0,e,t[o],o);mod_(s0,n),copy_(e,s0)}function squareMod_(e,t){for(var n,o,r,i,s=e.length;0<s&&!e[s-1];s--);for(i=s>t.length?2*s:2*t.length,copyInt_(s0=s0.length!=i?new Array(i):s0,0),n=0;n<s;n++){for(r=s0[2*n]+e[n]*e[n],s0[2*n]=r&mask,r>>=bpe,o=n+1;o<s;o++)r=s0[n+o]+2*e[n]*e[o]+r,s0[n+o]=r&mask,r>>=bpe;s0[n+s]=r}mod_(s0,t),copy_(e,s0)}function trim(e,t){for(var n=e.length;0<n&&!e[n-1];n--);return copy_(t=new Array(n+t),e),t}function powMod_(e,t,n){var o,r,i,s;if(s7.length!=n.length&&(s7=dup(n)),0==(1&n[0]))for(copy_(s7,e),copyInt_(e,1);!equalsInt(t,0);)1&t[0]&&multMod_(e,s7,n),divInt_(t,2),squareMod_(s7,n);else{for(copyInt_(s7,0),i=n.length;0<i&&!n[i-1];i--);for(s=radix-inverseModInt(modInt(n,radix),radix),s7[i]=1,multMod_(e,s7,n),s3.length!=e.length?s3=dup(e):copy_(s3,e),o=t.length-1;0<o&!t[o];o--);if(0==t[o])copyInt_(e,1);else{for(r=1<<bpe-1;r&&!(t[o]&r);r>>=1);for(;;){if(!(r>>=1)){if(--o<0)return void mont_(e,one,n,s);r=1<<bpe-1}mont_(e,e,n,s),r&t[o]&&mont_(e,s3,n,s)}}}}function mont_(e,t,n,o){var r,i,s,a,c,l,u=n.length,d=t.length;for(copyInt_(sa=sa.length!=u?new Array(u):sa,0);0<u&&0==n[u-1];u--);for(;0<d&&0==t[d-1];d--);for(l=sa.length-1,r=0;r<u;r++){for(s=(c=sa[0]+e[r]*t[0])+(a=(c&mask)*o&mask)*n[0]>>bpe,c=e[r],i=1;i<d-4;)s+=sa[i]+a*n[i]+c*t[i],sa[i-1]=s&mask,i++,s=(s>>=bpe)+(sa[i]+a*n[i]+c*t[i]),sa[i-1]=s&mask,i++,s=(s>>=bpe)+(sa[i]+a*n[i]+c*t[i]),sa[i-1]=s&mask,i++,s=(s>>=bpe)+(sa[i]+a*n[i]+c*t[i]),sa[i-1]=s&mask,i++,s=(s>>=bpe)+(sa[i]+a*n[i]+c*t[i]),sa[i-1]=s&mask,s>>=bpe,i++;for(;i<d;)s+=sa[i]+a*n[i]+c*t[i],sa[i-1]=s&mask,s>>=bpe,i++;for(;i<u-4;)s+=sa[i]+a*n[i],sa[i-1]=s&mask,i++,s=(s>>=bpe)+(sa[i]+a*n[i]),sa[i-1]=s&mask,i++,s=(s>>=bpe)+(sa[i]+a*n[i]),sa[i-1]=s&mask,i++,s=(s>>=bpe)+(sa[i]+a*n[i]),sa[i-1]=s&mask,i++,s=(s>>=bpe)+(sa[i]+a*n[i]),sa[i-1]=s&mask,s>>=bpe,i++;for(;i<u;)s+=sa[i]+a*n[i],sa[i-1]=s&mask,s>>=bpe,i++;for(;i<l;)s+=sa[i],sa[i-1]=s&mask,s>>=bpe,i++;sa[i-1]=s&mask}greater(n,sa)||sub_(sa,n),copy_(e,sa)}bpe>>=1,mask=(1<<bpe)-1,radix=mask+1,one=int2bigInt(1,1,1),t=new Array(0),ss=t,s2=s1=s0=t,s3=t,s4=t,s5=t,s6=t,s7=t,T=t,sa=t,mr_x1=t,mr_r=t,mr_a=t,eg_v=t,eg_u=t,eg_A=t,eg_B=t,eg_C=t,md_tt=md_r2=md_r1=md_r=md_q3=md_q2=md_q1=eg_D=t,primes=t,pows=t,s_i=t,s_i2=t,s_R=t,s_rm=t,s_q=t,s_n1=t,s_a=t,s_r2=t,s_n=t,s_b=t,s_d=t,s_x1=t,s_x2=t,s_aa=t,rpprb=t;var parseXML,XMLNodeTextContent,Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){for(var t,n,o,r,i,s,a="",c=0;c<e.length;)o=(t=e.charCodeAt(c++))>>2,r=(3&t)<<4|(t=e.charCodeAt(c++))>>4,i=(15&t)<<2|(n=e.charCodeAt(c++))>>6,s=63&n,isNaN(t)?i=s=64:isNaN(n)&&(s=64),a=a+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(i)+this._keyStr.charAt(s);return a},encodeArray:function(e){for(var t,n,o,r,i,s,a="",c=0;c<e.length;)o=(t=e[c++])>>2,r=(3&t)<<4|(t=e[c++])>>4,i=(15&t)<<2|(n=e[c++])>>6,s=63&n,isNaN(t)?i=s=64:isNaN(n)&&(s=64),a=a+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(i)+this._keyStr.charAt(s);return a},decode:function(e){var t,n,o,r,i,s,a="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)o=this._keyStr.indexOf(e.charAt(c++)),t=(15&(r=this._keyStr.indexOf(e.charAt(c++))))<<4|(i=this._keyStr.indexOf(e.charAt(c++)))>>2,n=(3&i)<<6|(s=this._keyStr.indexOf(e.charAt(c++))),a+=String.fromCharCode(o<<2|r>>4),64!=i&&(a+=String.fromCharCode(t)),64!=s&&(a+=String.fromCharCode(n));return a=Base64._utf8_decode(a)},decodeBinary:function(e,t){!function(){try{new Uint8Array(1);return}catch(e){}function o(e,t){return this.slice(e,t)}function r(e,t){arguments.length<2&&(t=0);for(var n=0,o=e.length;n<o;++n,++t)this[t]=255&e[n]}function e(e){if("number"==typeof e)for(var t=new Array(e),n=0;n<e;++n)t[n]=0;else t=e.slice(0);return t.subarray=o,(t.buffer=t).byteLength=t.length,t.set=r,"object"==typeof e&&e.buffer&&(t.buffer=e.buffer),t}window.Uint8Array=e,window.Uint32Array=e,window.Int32Array=e}();var n,o,r,i,s,a,c=this._keyStr.indexOf(e.charAt(e.length-1)),l=this._keyStr.indexOf(e.charAt(e.length-2)),u=e.length/4*3,u=parseInt(u),d=(64==c&&u--,64==l&&u--,0),h=0,f=t?new Uint8Array(t):new Uint8Array(u);for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),d=0;d<u;d+=3)r=this._keyStr.indexOf(e.charAt(h++)),n=(15&(i=this._keyStr.indexOf(e.charAt(h++))))<<4|(s=this._keyStr.indexOf(e.charAt(h++)))>>2,o=(3&s)<<6|(a=this._keyStr.indexOf(e.charAt(h++))),f[d]=r<<2|i>>4,64!=s&&(f[d+1]=n),64!=a&&(f[d+2]=o);return f},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):t=127<o&&o<2048?(t+=String.fromCharCode(o>>6|192))+String.fromCharCode(63&o|128):(t=(t+=String.fromCharCode(o>>12|224))+String.fromCharCode(o>>6&63|128))+String.fromCharCode(63&o|128)}return t},_utf8_decode:function(e){var t,n="",o=0;for(c1=c2=0;o<e.length;)(t=e.charCodeAt(o))<128?(n+=String.fromCharCode(t),o++):191<t&&t<224?(c2=e.charCodeAt(o+1),n+=String.fromCharCode((31&t)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),n+=String.fromCharCode((15&t)<<12|(63&c2)<<6|63&c3),o+=3);return n}},CryptoJS=CryptoJS||function(a){function n(){}var e={},t=e.lib={},o=t.Base={extend:function(e){n.prototype=this;var t=new n;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=t.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||i).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes;if(e=e.sigBytes,this.clamp(),o%4)for(var r=0;r<e;r++)t[o+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(o+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[o+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),r=e.enc={},i=r.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;o<e;o++){var r=t[o>>>2]>>>24-o%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new c.init(n,t/2)}},s=r.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;o<e;o++)n.push(String.fromCharCode(t[o>>>2]>>>24-o%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new c.init(n,t)}},l=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,o=t.sigBytes,r=this.blockSize,i=o/(4*r),i=e?a.ceil(i):a.max((0|i)-this._minBufferSize,0),o=a.min(4*(e=i*r),o);if(e){for(var s=0;s<e;s+=r)this._doProcessBlock(n,s);s=n.splice(0,e),t.sigBytes-=o}return new c.init(s,o)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(t.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new d.HMAC.init(n,t).finalize(e)}}}),e.algo={});return e}(Math),CryptoJS=(!function(){var e=CryptoJS,c=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,o=this._map;e.clamp(),e=[];for(var r=0;r<n;r+=3)for(var i=(t[r>>>2]>>>24-r%4*8&255)<<16|(t[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|t[r+2>>>2]>>>24-(r+2)%4*8&255,s=0;s<4&&r+.75*s<n;s++)e.push(o.charAt(i>>>6*(3-s)&63));if(t=o.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(i=n.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var o,r,i=[],s=0,a=0;a<t;a++)a%4&&(o=n.indexOf(e.charAt(a-1))<<a%4*2,r=n.indexOf(e.charAt(a))>>>6-a%4*2,i[s>>>2]|=(o|r)<<24-s%4*8,s++);return c.create(i,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),!function(i){function I(e,t,n,o,r,i,s){return((e=e+(t&n|~t&o)+r+s)<<i|e>>>32-i)+t}function P(e,t,n,o,r,i,s){return((e=e+(t&o|n&~o)+r+s)<<i|e>>>32-i)+t}function k(e,t,n,o,r,i,s){return((e=e+(t^n^o)+r+s)<<i|e>>>32-i)+t}function D(e,t,n,o,r,i,s){return((e=e+(n^(t|~o))+r+s)<<i|e>>>32-i)+t}for(var e=CryptoJS,t=(o=e.lib).WordArray,n=o.Hasher,o=e.algo,E=[],r=0;r<64;r++)E[r]=4294967296*i.abs(i.sin(r+1))|0;o=o.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=e[r=t+n];e[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var n=this._hash.words,r=e[t+0],o=e[t+1],i=e[t+2],s=e[t+3],a=e[t+4],c=e[t+5],l=e[t+6],u=e[t+7],d=e[t+8],h=e[t+9],f=e[t+10],g=e[t+11],m=e[t+12],p=e[t+13],b=e[t+14],C=e[t+15],S=I(n[0],_=n[1],v=n[2],y=n[3],r,7,E[0]),y=I(y,S,_,v,o,12,E[1]),v=I(v,y,S,_,i,17,E[2]),_=I(_,v,y,S,s,22,E[3]),S=I(S,_,v,y,a,7,E[4]),y=I(y,S,_,v,c,12,E[5]),v=I(v,y,S,_,l,17,E[6]),_=I(_,v,y,S,u,22,E[7]),S=I(S,_,v,y,d,7,E[8]),y=I(y,S,_,v,h,12,E[9]),v=I(v,y,S,_,f,17,E[10]),_=I(_,v,y,S,g,22,E[11]),S=I(S,_,v,y,m,7,E[12]),y=I(y,S,_,v,p,12,E[13]),v=I(v,y,S,_,b,17,E[14]),S=P(S,_=I(_,v,y,S,C,22,E[15]),v,y,o,5,E[16]),y=P(y,S,_,v,l,9,E[17]),v=P(v,y,S,_,g,14,E[18]),_=P(_,v,y,S,r,20,E[19]),S=P(S,_,v,y,c,5,E[20]),y=P(y,S,_,v,f,9,E[21]),v=P(v,y,S,_,C,14,E[22]),_=P(_,v,y,S,a,20,E[23]),S=P(S,_,v,y,h,5,E[24]),y=P(y,S,_,v,b,9,E[25]),v=P(v,y,S,_,s,14,E[26]),_=P(_,v,y,S,d,20,E[27]),S=P(S,_,v,y,p,5,E[28]),y=P(y,S,_,v,i,9,E[29]),v=P(v,y,S,_,u,14,E[30]),S=k(S,_=P(_,v,y,S,m,20,E[31]),v,y,c,4,E[32]),y=k(y,S,_,v,d,11,E[33]),v=k(v,y,S,_,g,16,E[34]),_=k(_,v,y,S,b,23,E[35]),S=k(S,_,v,y,o,4,E[36]),y=k(y,S,_,v,a,11,E[37]),v=k(v,y,S,_,u,16,E[38]),_=k(_,v,y,S,f,23,E[39]),S=k(S,_,v,y,p,4,E[40]),y=k(y,S,_,v,r,11,E[41]),v=k(v,y,S,_,s,16,E[42]),_=k(_,v,y,S,l,23,E[43]),S=k(S,_,v,y,h,4,E[44]),y=k(y,S,_,v,m,11,E[45]),v=k(v,y,S,_,C,16,E[46]),S=D(S,_=k(_,v,y,S,i,23,E[47]),v,y,r,6,E[48]),y=D(y,S,_,v,u,10,E[49]),v=D(v,y,S,_,b,15,E[50]),_=D(_,v,y,S,c,21,E[51]),S=D(S,_,v,y,m,6,E[52]),y=D(y,S,_,v,s,10,E[53]),v=D(v,y,S,_,f,15,E[54]),_=D(_,v,y,S,o,21,E[55]),S=D(S,_,v,y,d,6,E[56]),y=D(y,S,_,v,C,10,E[57]),v=D(v,y,S,_,l,15,E[58]),_=D(_,v,y,S,p,21,E[59]),S=D(S,_,v,y,a,6,E[60]),y=D(y,S,_,v,g,10,E[61]),v=D(v,y,S,_,i,15,E[62]),_=D(_,v,y,S,h,21,E[63]);n[0]=n[0]+S|0,n[1]=n[1]+_|0,n[2]=n[2]+v|0,n[3]=n[3]+y|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes,r=(t[o>>>5]|=128<<24-o%32,i.floor(n/4294967296));for(t[15+(64+o>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t[14+(64+o>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;n<4;n++)o=t[n],t[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.MD5=n._createHelper(o),e.HmacMD5=n._createHmacHelper(o)}(Math),!function(){var e=CryptoJS,t=e.lib,n=t.Base,l=t.WordArray,o=(t=e.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(s=this.cfg).hasher.create(),o=l.create(),r=o.words,i=s.keySize,s=s.iterations;r.length<i;){a&&n.update(a);var a=n.update(e).finalize(t);n.reset();for(var c=1;c<s;c++)a=n.finalize(a),n.reset();o.concat(a)}return o.sigBytes=4*i,o}});e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),CryptoJS.lib.Cipher||function(){function i(e,t,n){var o=this._iv;o?this._iv=void 0:o=this._prevBlock;for(var r=0;r<n;r++)e[t+r]^=o[r]}var e=(h=CryptoJS).lib,t=e.Base,s=e.WordArray,n=e.BufferedBlockAlgorithm,o=h.enc.Base64,r=h.algo.EvpKDF,a=e.Cipher=n.extend({cfg:t.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){n.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(o){return{encrypt:function(e,t,n){return("string"==typeof t?f:d).encrypt(o,e,t,n)},decrypt:function(e,t,n){return("string"==typeof t?f:d).decrypt(o,e,t,n)}}}}),c=(e.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h.mode={}),l=(e.BlockCipherMode=t.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend(),u=(l.Encryptor=l.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize;i.call(this,e,t,o),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+o)}}),l.Decryptor=l.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,r=e.slice(t,t+o);n.decryptBlock(e,t),i.call(this,e,t,o),this._prevBlock=r}}),c=c.CBC=l,l=(h.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,o=(n=n-e.sigBytes%n)<<24|n<<16|n<<8|n,r=[],i=0;i<n;i+=4)r.push(o);n=s.create(r,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},e.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:l}),reset:function(){a.reset.call(this);var e,t=(n=this.cfg).iv,n=n.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode=e.call(n,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),e.CipherParams=t.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),c=(h.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?s.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){var t,n=(e=o.parse(e)).words;return 1398893684==n[0]&&1701076831==n[1]&&(t=s.create(n.slice(2,4)),n.splice(0,4),e.sigBytes-=16),u.create({ciphertext:e,salt:t})}},d=e.SerializableCipher=t.extend({cfg:t.extend({format:c}),encrypt:function(e,t,n,o){o=this.cfg.extend(o);var r=e.createEncryptor(n,o);return t=r.finalize(t),r=r.cfg,u.create({ciphertext:t,key:n,iv:r.iv,algorithm:e,mode:r.mode,padding:r.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),e.createDecryptor(n,o).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),h=(h.kdf={}).OpenSSL={execute:function(e,t,n,o){return o=o||s.random(8),e=r.create({keySize:t+n}).compute(e,o),n=s.create(e.words.slice(t),4*n),e.sigBytes=4*t,u.create({key:e,iv:n,salt:o})}},f=e.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:h}),encrypt:function(e,t,n,o){return n=(o=this.cfg.extend(o)).kdf.execute(n,e.keySize,e.ivSize),o.iv=n.iv,(e=d.encrypt.call(this,e,t,n.key,o)).mixIn(n),e},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),n=o.kdf.execute(n,e.keySize,e.ivSize,t.salt),o.iv=n.iv,d.decrypt.call(this,e,t,n.key,o)}})}(),!function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,s=[],o=[],r=[],i=[],a=[],c=[],l=[],u=[],d=[],h=[],f=[],g=0;g<256;g++)f[g]=g<128?g<<1:g<<1^283;for(var m=0,p=0,g=0;g<256;g++){var b=p^p<<1^p<<2^p<<3^p<<4,C=f[o[s[m]=b=b>>>8^255&b^99]=m],S=f[C],y=f[S],v=257*f[b]^16843008*b;r[m]=v<<24|v>>>8,i[m]=v<<16|v>>>16,a[m]=v<<8|v>>>24,c[m]=v,l[b]=(v=16843009*y^65537*S^257*C^16843008*m)<<24|v>>>8,u[b]=v<<16|v>>>16,d[b]=v<<8|v>>>24,h[b]=v,m?(m=C^f[f[f[y^C]]],p^=f[f[p]]):m=p=1}var _=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=t.extend({_doReset:function(){for(var e,t=(o=this._key).words,n=o.sigBytes/4,o=4*((this._nRounds=n+6)+1),r=this._keySchedule=[],i=0;i<o;i++)i<n?r[i]=t[i]:(e=r[i-1],i%n?6<n&&4==i%n&&(e=s[e>>>24]<<24|s[e>>>16&255]<<16|s[e>>>8&255]<<8|s[255&e]):(e=s[(e=e<<8|e>>>24)>>>24]<<24|s[e>>>16&255]<<16|s[e>>>8&255]<<8|s[255&e],e^=_[i/n|0]<<24),r[i]=r[i-n]^e);for(t=this._invKeySchedule=[],n=0;n<o;n++)i=o-n,e=n%4?r[i]:r[i-4],t[n]=n<4||i<=4?e:l[s[e>>>24]]^u[s[e>>>16&255]]^d[s[e>>>8&255]]^h[s[255&e]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,r,i,a,c,s)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,u,d,h,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,o,r,i,s,a){for(var c=this._nRounds,l=e[t]^n[0],u=e[t+1]^n[1],d=e[t+2]^n[2],h=e[t+3]^n[3],f=4,g=1;g<c;g++)var m=o[l>>>24]^r[u>>>16&255]^i[d>>>8&255]^s[255&h]^n[f++],p=o[u>>>24]^r[d>>>16&255]^i[h>>>8&255]^s[255&l]^n[f++],b=o[d>>>24]^r[h>>>16&255]^i[l>>>8&255]^s[255&u]^n[f++],h=o[h>>>24]^r[l>>>16&255]^i[u>>>8&255]^s[255&d]^n[f++],l=m,u=p,d=b;m=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^n[f++],p=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&l])^n[f++],b=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^n[f++],h=(a[h>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^n[f++],e[t]=m,e[t+1]=p,e[t+2]=b,e[t+3]=h},keySize:8});e.AES=t._createHelper(n)}(),CryptoJS||function(a){function n(){}var e={},t=e.lib={},o=t.Base={extend:function(e){n.prototype=this;var t=new n;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=t.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||i).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes;if(e=e.sigBytes,this.clamp(),o%4)for(var r=0;r<e;r++)t[o+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(o+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[o+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),r=e.enc={},i=r.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;o<e;o++){var r=t[o>>>2]>>>24-o%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new c.init(n,t/2)}},s=r.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;o<e;o++)n.push(String.fromCharCode(t[o>>>2]>>>24-o%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new c.init(n,t)}},l=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,o=t.sigBytes,r=this.blockSize,i=o/(4*r),i=e?a.ceil(i):a.max((0|i)-this._minBufferSize,0),o=a.min(4*(e=i*r),o);if(e){for(var s=0;s<e;s+=r)this._doProcessBlock(n,s);s=n.splice(0,e),t.sigBytes-=o}return new c.init(s,o)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(t.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new d.HMAC.init(n,t).finalize(e)}}}),e.algo={});return e}(Math)),CryptoJS=(!function(r){function e(e){return 4294967296*(e-(0|e))|0}for(var t=CryptoJS,n=(i=t.lib).WordArray,o=i.Hasher,i=t.algo,s=[],g=[],a=2,c=0;c<64;){e:{for(var l=a,u=r.sqrt(l),d=2;d<=u;d++)if(!(l%d)){l=!1;break e}l=!0}l&&(c<8&&(s[c]=e(r.pow(a,.5))),g[c]=e(r.pow(a,1/3)),c++),a++}var m=[],i=i.SHA256=o.extend({_doReset:function(){this._hash=new n.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n,o,r=this._hash.words,i=r[0],s=r[1],a=r[2],c=r[3],l=r[4],u=r[5],d=r[6],h=r[7],f=0;f<64;f++)m[f]=f<16?0|e[t+f]:(((n=m[f-15])<<25|n>>>7)^(n<<14|n>>>18)^n>>>3)+m[f-7]+(((o=m[f-2])<<15|o>>>17)^(o<<13|o>>>19)^o>>>10)+m[f-16],n=h+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&u^~l&d)+g[f]+m[f],o=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&s^i&a^s&a),h=d,d=u,u=l,l=c+n|0,c=a,a=s,s=i,i=n+o|0;r[0]=r[0]+i|0,r[1]=r[1]+s|0,r[2]=r[2]+a|0,r[3]=r[3]+c|0,r[4]=r[4]+l|0,r[5]=r[5]+u|0,r[6]=r[6]+d|0,r[7]=r[7]+h|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(64+o>>>9<<4)]=r.floor(n/4294967296),t[15+(64+o>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(i),t.HmacSHA256=o._createHmacHelper(i)}(Math),CryptoJS||function(a){function n(){}var e={},t=e.lib={},o=t.Base={extend:function(e){n.prototype=this;var t=new n;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=t.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||i).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes;if(e=e.sigBytes,this.clamp(),o%4)for(var r=0;r<e;r++)t[o+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(o+r)%4*8;else if(65535<n.length)for(r=0;r<e;r+=4)t[o+r>>>2]=n[r>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=a.ceil(t/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*a.random()|0);return new c.init(t,e)}}),r=e.enc={},i=r.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;o<e;o++){var r=t[o>>>2]>>>24-o%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new c.init(n,t/2)}},s=r.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],o=0;o<e;o++)n.push(String.fromCharCode(t[o>>>2]>>>24-o%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new c.init(n,t)}},l=r.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},u=t.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,o=t.sigBytes,r=this.blockSize,i=o/(4*r),i=e?a.ceil(i):a.max((0|i)-this._minBufferSize,0),o=a.min(4*(e=i*r),o);if(e){for(var s=0;s<e;s+=r)this._doProcessBlock(n,s);s=n.splice(0,e),t.sigBytes-=o}return new c.init(s,o)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(t.Hasher=u.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new d.HMAC.init(n,t).finalize(e)}}}),e.algo={});return e}(Math)),NETWORK=(!function(){var e=CryptoJS,t=e.lib,r=t.Base,i=t.WordArray;(e=e.x64={}).Word=r.extend({init:function(e,t){this.high=e,this.low=t}}),e.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],o=0;o<t;o++){var r=e[o];n.push(r.high),n.push(r.low)}return i.create(n,this.sigBytes)},clone:function(){for(var e=r.clone.call(this),t=e.words=this.words.slice(0),n=t.length,o=0;o<n;o++)t[o]=t[o].clone();return e}})}(),!function(){function e(){return o.create.apply(o,arguments)}for(var t=CryptoJS,n=t.lib.Hasher,o=(i=t.x64).Word,r=i.WordArray,i=t.algo,ee=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],te=[],s=0;s<80;s++)te[s]=e();i=i.SHA512=n.extend({_doReset:function(){this._hash=new r.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(X,O){for(var e=(a=this._hash.words)[0],t=a[1],n=a[2],o=a[3],r=a[4],i=a[5],s=a[6],a=a[7],N=e.high,c=e.low,F=t.high,l=t.low,q=n.high,u=n.low,L=o.high,d=o.low,H=r.high,h=r.low,V=i.high,f=i.low,z=s.high,g=s.low,U=a.high,m=a.low,p=N,b=c,C=F,S=l,y=q,v=u,W=L,_=d,I=H,P=h,j=V,k=f,G=z,D=g,J=U,Y=m,E=0;E<80;E++)var M,w=te[E],Q=(E<16?(M=w.high=0|X[O+2*E],R=w.low=0|X[O+2*E+1]):(M=((R=(M=te[E-15]).high)>>>1|(A=M.low)<<31)^(R>>>8|A<<24)^R>>>7,A=(A>>>1|R<<31)^(A>>>8|R<<24)^(A>>>7|R<<25),B=((R=(B=te[E-2]).high)>>>19|(x=B.low)<<13)^(R<<3|x>>>29)^R>>>6,x=(x>>>19|R<<13)^(x<<3|R>>>29)^(x>>>6|R<<26),Q=(R=te[E-7]).high,K=(T=te[E-16]).high,T=T.low,M=(M=(M=M+Q+((R=A+R.low)>>>0<A>>>0?1:0))+B+((R=R+x)>>>0<x>>>0?1:0))+K+((R=R+T)>>>0<T>>>0?1:0),w.high=M,w.low=R),I&j^~I&G),T=P&k^~P&D,w=p&C^p&y^C&y,A=(p>>>28|b<<4)^(p<<30|b>>>2)^(p<<25|b>>>7),B=(b>>>28|p<<4)^(b<<30|p>>>2)^(b<<25|p>>>7),x=ee[E],Z=x.high,$=x.low,K=(K=(K=(K=J+((I>>>14|P<<18)^(I>>>18|P<<14)^(I<<23|P>>>9))+((x=Y+((P>>>14|I<<18)^(P>>>18|I<<14)^(P<<23|I>>>9)))>>>0<Y>>>0?1:0))+Q+((x=x+T)>>>0<T>>>0?1:0))+Z+((x=x+$)>>>0<$>>>0?1:0))+M+((x=x+R)>>>0<R>>>0?1:0),R=B+(b&S^b&v^S&v),J=G,Y=D,G=j,D=k,j=I,k=P,I=W+K+((P=_+x|0)>>>0<_>>>0?1:0)|0,W=y,_=v,y=C,v=S,C=p,S=b,p=K+(w=A+w+(R>>>0<B>>>0?1:0))+((b=x+R|0)>>>0<x>>>0?1:0)|0;c=e.low=c+b,e.high=N+p+(c>>>0<b>>>0?1:0),l=t.low=l+S,t.high=F+C+(l>>>0<S>>>0?1:0),u=n.low=u+v,n.high=q+y+(u>>>0<v>>>0?1:0),d=o.low=d+_,o.high=L+W+(d>>>0<_>>>0?1:0),h=r.low=h+P,r.high=H+I+(h>>>0<P>>>0?1:0),f=i.low=f+k,i.high=V+j+(f>>>0<k>>>0?1:0),g=s.low=g+D,s.high=z+G+(g>>>0<D>>>0?1:0),m=a.low=m+Y,a.high=U+J+(m>>>0<Y>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[30+(128+o>>>10<<5)]=Math.floor(n/4294967296),t[31+(128+o>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=n._createHelper(i),t.HmacSHA512=n._createHmacHelper(i)}(),XPMobileSDK.library.SecureString={sharedKey:null,encrypt:function(e){var t=this.generateKey(),n={iv:CryptoJS.lib.WordArray.random(16)},e=(Settings.DefaultEncryptionPadding&&CryptoJS.pad[Settings.DefaultEncryptionPadding]&&(n.padding=CryptoJS.pad[Settings.DefaultEncryptionPadding]),CryptoJS.AES.encrypt(e,CryptoJS.SHA256(t),n));return e.iv.toString(CryptoJS.enc.Base64)+":"+e.ciphertext.toString(CryptoJS.enc.Base64)},decrypt:function(e){var t,n,o="";return-1<e.indexOf(":")&&(t=this.generateKey(),e=e.split(":"),n=CryptoJS.enc.Base64.parse(e[0]),e=CryptoJS.enc.Base64.parse(e[1]),n={iv:n},Settings.DefaultEncryptionPadding&&CryptoJS.pad[Settings.DefaultEncryptionPadding]&&(n.padding=CryptoJS.pad[Settings.DefaultEncryptionPadding]),o=CryptoJS.AES.decrypt({ciphertext:e},CryptoJS.SHA256(t),n),o=CryptoJS.enc.Utf8.stringify(o)),o},generateKey:function(){var e="";return this.sharedKey?e=this.sharedKey:XPMobileSDK.library.Connection.dh?e=this.sharedKey=XPMobileSDK.library.Connection.dh.getSharedKey().toUpperCase():XPMobileSDK.library.CHAP.sharedKey&&(e=this.sharedKey=XPMobileSDK.library.CHAP.sharedKey.toUpperCase()),e}},XPMobileSDK.library.CHAP={challenges:[],sharedKey:"",minChallenges:200,haltThreshold:0,halt:!1,waitingForData:!1,initialize:function(){this.haltThreshold=5*this.minChallenges/100,XPMobileSDK.library.Connection.addObserver(this)},start:()=>{},cleanUp:function(){if(XPMobileSDK.library.Connection.connectionId&&!this.waitingForData){if(0<this.challenges.length)for(var e=0;e<this.challenges.length;e++)this.challenges[e].isValid()||(this.challenges[e].destroy(),this.challenges.splice(e,1));var t;this.challenges.length<this.minChallenges&&(t={NumChallenges:100},this.challenges.length<=this.haltThreshold&&(t.Reset="Yes"),this.waitingForData=!0,XPMobileSDK.requestChallenges(t,()=>{this.waitingForData=!1}))}},add:function(e){if("string"==typeof e){var t=new XPMobileSDK.library.Challenge(e);this.challenges.push(t)}else if("object"==typeof e&&0<e.length)for(var n=0;n<e.length;n++){t=new XPMobileSDK.library.Challenge(e[n]);this.challenges.push(t)}this.start()},takeValidChallenge:function(){if(this.cleanUp(),!(0<this.challenges.length))return logger.warn("No challenges in the list!"),{getValue:function(){},getTime:function(){}};for(var e=0;e<this.challenges.length;e++){var t=this.challenges.shift();if(this.challenges.length<this.haltThreshold?this.haltSystem():this.unHaltSystem(),t.isValid())return logger.log("Challenge:"+t.getValue(),"Seconds until expire:"+t.ttl),t;t.destroy()}},exportAll:function(){var t=[];return this.challenges.forEach(function(e){e=e.getValue();e&&t.push(e)}),t},sort:function(e,t){return t.getTime()-e.getTime()},calculate:function(){var e=this.takeValidChallenge();return e?{Challenge:e.getValue(),ChalAnswer:CryptoJS.SHA512((e.getValue()+this.sharedKey).toUpperCase()).toString(CryptoJS.enc.Base64),timeout:1e3*(e.ttl-e.getTime())}:{Challenge:void 0,ChalAnswer:void 0,timeout:void 0}},connectionLostConnection:function(){this.destroy()},connectionDidDisconnect:function(){this.destroy()},haltSystem(){document.getElementById("systemErrorModal").setAttribute("show",!0),this.halt=!0},unHaltSystem(){this.halt&&(this.halt=!1,document.getElementById("systemErrorModal").removeAttribute("show"))},connectionRequestSucceeded:function(e,t){"Yes"==XPMobileSDK.library.Connection.CHAPSupported&&t&&t.parameters&&t.parameters.Challenge&&XPMobileSDK.library.Connection.connectionId&&this.add(t.parameters.Challenge)},destroy:function(){if(0<this.challenges.length)for(var e=0;e<this.challenges.length;e++)this.challenges.shift().destroy();this.challenges=[],this.unHaltSystem(),XPMobileSDK.library.SecureString.sharedKey=null}},XPMobileSDK.library.Challenge=function(e){var t=Date.now();this.ttl=3540,this.isValid=function(){return this.getTime()/1e3<this.ttl},this.getValue=function(){return e},this.getTime=function(){return Date.now()-t},this.destroy=function(){}},XPMobileSDK.library.DiffieHellman=function(e){function t(e){e.length%2!=0&&(e="0"+e);for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substring(n,n+2),16));return t.reverse(),t}var n=str2bigInt({1024:"F488FD584E49DBCD20B49DE49107366B336C380D451D0F7C88B31C7C5B2D8EF6F3C923C043F0A55B188D8EBB558CB85D38D334FD7C175743A31D186CDE33212CB52AFF3CE1B1294018118D7C84A70A72D686C40319C807297ACA950CD9969FABD00A509B0246D3083D66A45D419F9C7CBD894B221926BAABA25EC355E92F78C7",2048:"87A8E61DB4B6663CFFBBD19C651959998CEEF608660DD0F25D2CEED4435E3B00E00DF8F1D61957D4FAF7DF4561B2AA3016C3D91134096FAA3BF4296D830E9A7C209E0C6497517ABD5A8A9D306BCF67ED91F9E6725B4758C022E0B1EF4275BF7B6C5BFC11D45F9088B941F54EB1E59BB8BC39A0BF12307F5C4FDB70C581B23F76B63ACAE1CAA6B7902D52526735488A0EF13C6D9A51BFA4AB3AD8347796524D8EF6A167B5A41825D967E144E5140564251CCACB83E6B486F6B3CA3F7971506026C0B857F689962856DED4010ABD0BE621C3A3960A54E710C375F26375D7014103A4B54330C198AF126116D2276E11715F693877FAD7EF09CADB094AE91E1A1597"}[XPMobileSDKSettings.primeLength],16,1),o=str2bigInt("2",10,1),r=[],s=null;this.createPublicKey=function(){r=randBigInt(160,0);var e=t(bigInt2str(powMod(o,r,n),16));return e.push(0),Base64.encodeArray(e)},this.setServerPublicKey=function(e){var t=Base64.decodeBinary(e),n=[];for(i=t.length-1;0<=i;i--)n.push(t[i]);s=CryptoJS.enc.Base64.parse(Base64.encodeArray(n)).toString()},this.getSharedKey=function(){var e=t(bigInt2str(powMod(str2bigInt(s,16,1),r,n),16));return CryptoJS.enc.Base64.parse(Base64.encodeArray(e)).toString()},this.encodeString=function(e){var t=this._sharedKey||this.getSharedKey().substring(0,96),n=CryptoJS.enc.Hex.parse(t.substring(32,96)),t={iv:CryptoJS.enc.Hex.parse(t.substring(0,32))};return XPMobileSDKSettings.defaultEncryptionPadding&&CryptoJS.pad[XPMobileSDKSettings.defaultEncryptionPadding]&&(t.padding=CryptoJS.pad[XPMobileSDKSettings.defaultEncryptionPadding]),CryptoJS.AES.encrypt(e,n,t).ciphertext.toString(CryptoJS.enc.Base64)}},CryptoJS.pad.Iso10126={pad:function(e,t){t=(t=4*t)-e.sigBytes%t;e.concat(CryptoJS.lib.WordArray.random(t-1)).concat(CryptoJS.lib.WordArray.create([t<<24],1))},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},XPMobileSDK.library.PKCECode={codeVerifier:"",getCodeVerifier:function(){return this.codeVerifier=CryptoJS.lib.WordArray.random(28).toString(),this.codeVerifier},getCodeChallenge:function(){return this.codeVerifier||this.getCodeVerifier(),encodeURIComponent(CryptoJS.SHA256(this.codeVerifier).toString(CryptoJS.enc.Base64).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""))}},XPMobileSDK.library.Ajax=new function(){this.Request=function(e,t){var n=t.timeout||0,o=(delete t.timeout,t=Object.assign({method:"POST",contentType:"plain/text",responseType:"text",encoding:"utf-8",postBody:null,asynchronous:!0,onLoading:function(){},onComplete:function(){},onSuccess:function(){},onFailure:function(){},onTimeout:function(){}},t),new XMLHttpRequest);return o.onreadystatechange=function(){1==o.readyState?t.onLoading(o):4==o.readyState&&(t.onComplete(o),(""!=o.responseType&&"text"!=o.responseType||0!=o.status||""!=o.responseText)&&("arraybuffer"!=o.responseType||0!=o.status||null!=o.response&&""!=o.response)&&(200==o.status||0==o.status)?t.onSuccess(o):t.onFailure(o))},o.open(t.method,e,t.asynchronous),t.asynchronous&&(o.responseType=t.responseType,o.timeout=n,o.ontimeout=t.onTimeout),o.setRequestHeader("Content-Type",t.contentType+"; charset="+t.encoding),o.send(t.postBody),o}},XPMobileSDK.library.Bytes=new function(){function n(e,t){var e=(e=e.length%2?"0"+e:e).match(/../g).splice(-t),n=new Array(t?t-e.length:0);return n.push.apply(n,e),n.forEach(function(e,t){n[t]=parseInt(e||0,16)}),n}return{fromInt:function(e,t){return n(e.toString(16),t)},fromGuid:function(e,t){return n(e.replace(/[^a-f0-9]/gi,""),t)},fromBase64:function(e,t){for(var n=atob(e.replace(/^.*?,/,"")).slice(-t),o=new Array(t?t-n.length:0),r=0;r<n.length;r++)o.push(n.charCodeAt(r));return o},fromHex:n}},{MIN_REQUEST_TIME_LOWER_BOUND:100,MIN_REQUEST_TIME_UPPER_BOUND:1e3,MAX_REQUEST_TIME:1e4,MAX_REQUEST_TIME_ON_FAILURE:4e3,REQUEST_TIME_GROW_PER_EMPTY_FRAME:1.32,REQUEST_TIME_GROW_PER_HTTP_ERROR:10,MIN_REQUEST_TIME_GROW:1.4,MIN_REQUEST_TIME_DECREASE:3e4,MIN_REQUEST_TIME_INCREASE:15e3,VIDEO_PROTOCOL_RECOVER_PACE:13,VIDEO_FAILS_MONITOR:7e3,minRequestTime:10,requestTime:10,requestTimeOnFailure:2e3,websocketSendMessage:1e3}),CommunicationStability=new function(){var t=0,e=0,n=null;function o(e){return n&&(new Date).getTime()-n.getTime()>e}setInterval(function(){e=Math.max(0,e-1-parseInt(e/NETWORK.VIDEO_PROTOCOL_RECOVER_PACE)),NETWORK.requestTime=NETWORK.minRequestTime+e*NETWORK.REQUEST_TIME_GROW_PER_HTTP_ERROR,NETWORK.requestTimeOnFailure=Math.min(NETWORK.MAX_REQUEST_TIME_ON_FAILURE,NETWORK.requestTime*NETWORK.REQUEST_TIME_GROW_PER_HTTP_ERROR)},1e3),setInterval(function(){o(NETWORK.MIN_REQUEST_TIME_DECREASE)&&(NETWORK.minRequestTime=Math.max(NETWORK.MIN_REQUEST_TIME_LOWER_BOUND,.9*NETWORK.minRequestTime))},NETWORK.VIDEO_FAILS_MONITOR),this.addBreakDown=function(e){e.brokenDown||(t++,e.brokenDown=!0)},this.removeBreakDown=function(e){e.brokenDown&&(t--,e.brokenDown=!1)},this.addVideoBreakDown=function(){e++,n?o(NETWORK.MIN_REQUEST_TIME_INCREASE)&&(NETWORK.minRequestTime=Math.min(NETWORK.MIN_REQUEST_TIME_UPPER_BOUND,NETWORK.minRequestTime*NETWORK.MIN_REQUEST_TIME_GROW),n=new Date):n=new Date},this.isBrokenDown=function(){return 0<t}};if(XPMobileSDK.library.ConnectionStates={idle:1,connecting:2,loggingIn:3,working:4,lostConnection:5},XPMobileSDK.library.ConnectionObserverInterface={connectionStateChanged:function(){},connectionDidConnect:function(e){},connectionFailedToConnect:function(e){},connectionFailedToConnectWithId:function(e){},connectionRequiresCode:function(e){},connectionCodeError:function(){},connectionDidLogIn:function(){},connectionFailedToLogIn:function(e){},connectionLostConnection:function(){},connectionProcessingDisconnect:function(){},connectionDidDisconnect:function(){},connectionRequestSucceeded:function(e,t){},connectionVersionChanged:function(){},connectionReloadConfiguration:function(){},connectionReloadCameraConfiguration:function(){},closeStreamFinished:function(){}},Connection=function(){function e(){K(),A(XPMobileSDK.library.ConnectionStates.idle),XPMobileSDK.library.VideoConnectionPool.clear(),B("connectionProcessingDisconnect"),c.connectionId=null,B("connectionDidDisconnect"),c.destroy()}function o(){r=r||setTimeout(e,1e3*c.serverTimeout)}var r,c=this,s=(this.connectionId=null,this.serverId=null,this.currentUserName=null,this.currentUserEmail=null,this.serverTimeout=30,this.state=XPMobileSDK.library.ConnectionStates.idle,this.DSServerStatus={NotAvailable:0,DoNotEnforce:1,EnforceWheneverPossible:2,Enforce:3},[]),a=[],t=0,l=0,u=(this.initialize=function(e){e&&(c.storage=e,XPMobileSDK.features=c.storage.getItem("features"),c.resizeAvailable=c.storage.getItem("resizeAvailable"),c.webSocketServer=c.storage.getItem("webSocketServer"),c.webSocketBrowser=c.storage.getItem("webSocketBrowser"),c.directStreamingClient=c.storage.getItem("directStreamingClient"),c.directStreamingServer=c.storage.getItem("directStreamingServer"),c.exportToAvi=c.storage.getItem("exportToAvi"),c.exportToDb=c.storage.getItem("exportToDb"),c.exportToMkv=c.storage.getItem("exportToMkv"),c.analytics=c.storage.getItem("analytics")),c.server=XPMobileSDKSettings.MobileServerURL||window.location.origin,c.dh=new XPMobileSDK.library.DiffieHellman},this.addObserver=function(e){-1===a.indexOf(e)&&a.push(e)},this.removeObserver=function(e){e=a.indexOf(e);e<0?logger.error("Error removing observer. Observer does not exist."):a.splice(e,1)},this.cancelRequest=function(e){logger.log("Cancelling request: ",e),e.cancel(),T(e)},this.Connect=function(e,t,n){return e=e||{},A(XPMobileSDK.library.ConnectionStates.connecting),e.ProcessingMessage="No",c.sendCommand("Connect",e,{successCallback:t},u,n)},function(e){T(e);var t,n=e.response;!n||n.isError?(t=n&&n.error,B("connectionFailedToConnect",t),e.options.failCallback&&e.options.failCallback(t)):(c.connectionId=n.outputParameters.ConnectionId,c.serverTimeout=parseInt(n.outputParameters.Timeout),c.serverId=n.outputParameters.ServerId,c.storage&&(c.webSocketServer="Yes"===n.outputParameters.WebSocketSupport,c.storage.setItem("webSocketServer",c.webSocketServer),"boolean"==typeof c.storage.getItem("webSocketBrowser")&&window.WebSocket?c.webSocketBrowser=c.storage.getItem("webSocketBrowser"):(c.webSocketBrowser=!!window.WebSocket,c.storage.setItem("webSocketBrowser",c.webSocketBrowser)),"boolean"==typeof c.storage.getItem("directStreamingClient")?c.directStreamingClient=c.storage.getItem("directStreamingClient"):(c.directStreamingClient=!!XPMobileSDKSettings.DirectStreaming,c.storage.setItem("directStreamingClient",c.directStreamingClient)),c.analytics=c.storage.getItem("analytics")),n.outputParameters.SecurityEnabled&&(c.SecurityEnabled=n.outputParameters.SecurityEnabled),n.outputParameters.PublicKey&&(c.PublicKey=n.outputParameters.PublicKey,c.dh)&&c.dh.setServerPublicKey(n.outputParameters.PublicKey),n.outputParameters.CHAPSupported&&"Yes"===n.outputParameters.CHAPSupported&&(c.CHAPSupported=n.outputParameters.CHAPSupported,XPMobileSDK.library.CHAP.sharedKey=c.dh&&c.dh.getSharedKey()),n.outputParameters.ServerProductCode&&(c.ServerProductCode=n.outputParameters.ServerProductCode),logger.info("Established connection"),x(),t=n.outputParameters,B("connectionDidConnect",t),e.options.successCallback&&e.options.successCallback(t))}),d=(this.connectWithId=function(e,t,n){c.server=e,c.connectionId=t,c.serverId=n,logger.log("Connecting with Id "+c.connectionId),A(XPMobileSDK.library.ConnectionStates.connecting),c.sendLiveMessage(),c.connectingViaExternalConnectionID=!0},this.Login=function(e,t,n){return logger.log("Log in with authentication type "+(e=e||{}).LoginType+" username "+e.Username+" password "+e.Password),A(XPMobileSDK.library.ConnectionStates.loggingIn),c.sendCommand("LogIn",e,{successCallback:t},d,n)},function(e){T(e);var t,n=e.response;!n||n.isError?n&&n.error.code===XPMobileSDK.library.ConnectionError.SecondStepAuthenticationRequired?(t=n.outputParameters.SecondStepAuthenticationProvider,B("connectionRequiresCode",t),e.options.successCallback&&e.options.successCallback(t)):(c.connectionId=null,K(),t=n&&n.error,B("connectionFailedToLogIn",t),e.options.failCallback&&e.options.failCallback(t)):h(n,e.options.successCallback)}),h=function(e,t){c.directStreamingServer="Yes"===e.outputParameters.DirectStreamingLive,c.storage.setItem("directStreamingServer",c.directStreamingServer),c.exportToAvi="Yes"===e.outputParameters.ExportToAvi,c.storage.setItem("exportToAvi",c.exportToAvi),c.exportToDb="Yes"===e.outputParameters.ExportToDb,c.storage.setItem("exportToDb",c.exportToDb),c.exportToMkv="Yes"===e.outputParameters.ExportToMkv,c.storage.setItem("exportToMkv",c.exportToMkv),e.outputParameters.Username&&(c.currentUserName=e.outputParameters.Username),e.outputParameters.Email&&(c.currentUserEmail=e.outputParameters.Email),logger.info("Logged in"),Me(e.outputParameters),A(XPMobileSDK.library.ConnectionStates.working),B("connectionDidLogIn",e.outputParameters),t&&t()},n=(this.requestCode=function(e,t){return c.sendCommand("RequestSecondStepAuthenticationPin",{},{successCallback:e},n,t)},function(e){w(e,"Error requesting validation code.",e.options.successCallback)}),f=(this.verifyCode=function(e){return c.sendCommand("VerifySecondStepAuthenticationPin",{SecondStepAuthenticationPin:e},null,f)},function(e){T(e);e=e.response;!e||e.isError?e&&e.error.code===XPMobileSDK.library.ConnectionError.SecondStepAuthenticationCodeError?B("connectionCodeError"):(c.connectionId=null,K(),B("connectionFailedToLogIn",e&&e.error)):h(e)}),g=(this.Disconnect=function(e,t,n){B("connectionProcessingDisconnect"),K(),A(XPMobileSDK.library.ConnectionStates.idle),XPMobileSDK.library.VideoConnectionPool.clear();e=c.sendCommand("Disconnect",e=e||{},{successCallback:t},g,n);return c.connectionId=null,e},function(e){T(e),B("connectionDidDisconnect"),c.destroy()}),m=(this.getViews=function(e,t,n){return c.sendCommand("GetViews",{ViewId:e},{successCallback:t,ViewId:e},m,n)},function(c){w(c,null,function(){for(var e=[],t=c.response.subItems.getElementsByTagName("Item"),n=0,o=t.length;n<o;n++){for(var r=t[n],i={},s=0;s<r.attributes.length;s++)i[r.attributes[s].name]=r.attributes[s].value;e.push(i)}var a={id:c.options.ViewId,subViews:e};c.options.successCallback&&c.options.successCallback(a)})}),p=(this.getAllViews=function(e,t){return c.sendCommand("GetAllViewsAndCameras",{},{successCallback:e},p,t)},function(e){w(e,"Error executing GetAllViewsAndCameras on the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),b=(this.getAllCameras=function(e,t){return c.sendCommand("GetItems",{ItemKind:"Camera",Hierarchy:"UserDefined",IncludeRelatedDevices:"Yes"},{successCallback:e},b,t)},function(e){w(e,"Error executing GetItems on the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),C=(this.requestPushStream=function(e,t){return c.RequestStream({SignalType:"Upload",ByteOrder:"Network"},e,t)},this.requestStream=function(e,t,n,o,r){n=n||{};t={CameraId:e,DestWidth:Math.round(t.width),DestHeight:Math.round(t.height),SignalType:n.signal===XPMobileSDK.interfaces.VideoConnectionSignal.playback?"Playback":"Live",MethodType:"Push",Fps:15,ComprLevel:n.jpegCompressionLevel||70,KeyFramesOnly:n.keyFramesOnly?"Yes":"No",RequestSize:"Yes",StreamType:n.streamType===XPMobileSDK.library.VideoConnectionStream.FragmentedMP4?"FragmentedMP4":"Transcoded"};return n.fragmentDurationMs&&(t.FragmentDurationMs=n.fragmentDurationMs),n.time&&(t.SeekType="Time",t.Time=n.time),n.motionOverlay&&(t.MotionOverlay="Yes"),XPMobileSDK.features.MultiCameraPlayback&&n.playbackControllerId&&(t.PlaybackControllerId=n.playbackControllerId),n={successCallback:o,cameraId:e,signal:n.signal===XPMobileSDK.interfaces.VideoConnectionSignal.playback?"Playback":"Live",reuseConnection:!!n.reuseConnection},c.sendCommand("RequestStream",t,n,C,r)},this.RequestStream=function(e,t,n){return c.sendCommand("RequestStream",e,{successCallback:t},C,n)},function(t){let e="Error starting stream for camera "+t.options.cameraId;t.response.errorCode===XPMobileSDK.library.ConnectionError.InsufficientUserRights&&(e=""),w(t,e,function(){var e=t.response.outputParameters.VideoId,e=(logger.log("Server prepared video ID "+e+" for camera "+t.options.cameraId),new VideoStream(e,t));t.options.reuseConnection&&XPMobileSDK.library.VideoConnectionPool.addCamera(t.options.cameraId,e),t.options.successCallback&&t.options.successCallback(e)})}),S=(this.RequestAudioStreamIn=function(e,t,n){return c.sendCommand("RequestAudioStreamIn",e,{successCallback:t},S,n)},this.requestAudioStreamIn=function(e,t,n,o){e={ItemId:e,AudioEncoding:"Pcm",AudioSamplingRate:8e3,AudioBitsPerSample:16,AudioChannelsNumber:1,StreamDataType:"Audio",SignalType:"Live",MethodType:"Push",StreamHeaders:"AllPresent",ByteOrder:"Network"};return(t=t||{}).AudioSamplingRate&&(e.AudioSamplingRate=t.AudioSamplingRate),t.AudioBitsPerSample&&(e.AudioBitsPerSample=t.AudioBitsPerSample),t.AudioChannelsNumber&&(e.AudioChannelsNumber=t.AudioChannelsNumber),t={successCallback:n,timeout:t.timeout},c.sendCommand("RequestAudioStreamIn",e,t,S,o)},function(e){w(e,"Error requesting video push stream from the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})}),y=(this.RequestAudioStream=function(e,t,n){return c.sendCommand("RequestAudioStream",e,{successCallback:t},y,n)},this.requestAudioStream=function(e,t,n,o){var r={ItemId:e,MethodType:"Push",SignalType:(t=t||{}).signal===XPMobileSDK.interfaces.VideoConnectionSignal.playback?"Playback":"Live",StreamType:"Transcoded",StreamDataType:"Audio",AudioEncoding:"Mp3",CloseConnectionOnError:"Yes"};return t.playbackControllerId&&(r.PlaybackControllerId=t.playbackControllerId),t.AudioCompressionLevel?r.ComprLevel=t.AudioCompressionLevel:XPMobileSDKSettings.AudioCompressionLevel&&(r.ComprLevel=XPMobileSDKSettings.AudioCompressionLevel),c.sendCommand("RequestAudioStream",r,t={successCallback:n,microphoneId:e},y,o)},function(t){w(t,"Error starting stream for microphone "+t.options.microphoneId,function(){var e=t.response.outputParameters.StreamId;logger.log("Server prepared stream ID "+e+" for microphone "+t.options.microphoneId),t.options.successCallback&&t.options.successCallback(t)})}),v=(this.toggleDirectStreaming=function(e){c.directStreamingClient=!!e,c.storage&&c.storage.setItem("directStreamingClient",c.directStreamingClient),XPMobileSDK.library.VideoConnection.instances.forEach(function(e){e.getState()===XPMobileSDK.library.VideoConnectionState.running&&e.close()})},this.toggleAnalytics=function(e){c.analytics=!!e,c.storage&&c.storage.setItem("analytics",c.analytics),window.dispatchEvent(new CustomEvent("AnalyticsSettingChanged"))},this.changeStream=function(e,t,n,o,r){e={VideoConnection:e,VideoId:e.videoId,DestWidth:Math.round(n.width),DestHeight:Math.round(n.height)};return void 0!==t.top&&(e.SrcTop=Math.round(t.top)),void 0!==t.left&&(e.SrcLeft=Math.round(t.left)),void 0!==t.right?e.SrcRight=Math.round(t.right):void 0!==t.width&&(e.SrcRight=Math.round(t.width)+Math.round(t.left)),void 0!==t.bottom?e.SrcBottom=Math.round(t.bottom):void 0!==t.height&&(e.SrcBottom=Math.round(t.height)+Math.round(t.top)),c.ChangeStream(e,o,r)},this.ChangeStream=function(e,t,n){return c.sendCommand("ChangeStream",e,{successCallback:t},v,n)},function(e){w(e,"Error changing stream.",function(){e.options.successCallback&&e.options.successCallback()})}),_=(this.motionDetection=function(e,t){var e={VideoId:e.videoId,VideoConnection:e},n=t.motion||t.MotionAmount,n=(n&&(e.MotionAmount=Math.round(n)),t.sensitivity||t.SensitivityAmount),n=(n&&(e.SensitivityAmount=Math.round(n)),t.cpu||t.CPUImpactAmount),n=(n&&(e.CPUImpactAmount=Math.round(n)),t.grid||t.RegionGrid);return/^\d+x\d+(;\d+)+$/.test(n)&&(e.RegionGrid=n),c.ChangeStream(e)},this.getPtzPresets=function(e,t,n){return c.sendCommand("GetPtzPresets",{CameraId:e},{successCallback:t},_,n)},function(e){w(e,"Error getting PTZ presets.",function(){delete e.response.outputParameters.Challenge,e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})}),I=(this.closeStream=function(e){return c.CloseStream({VideoId:e})},this.closeAudioStream=function(e){return c.sendCommand("CloseStream",{VideoId:e},{successCallback:null},O)},this.CloseStream=function(e,t,n){return c.sendCommand("CloseStream",e,{successCallback:t},I,n)},function(e){P(e),B("closeStreamFinished")}),O=function(e){P(e)},P=function(e){T(e);var t=e.response;t&&!t.isError||R(e)&&X()},N=new function(){var e=!1,t=!1,n=15,o=1,r=0,i=(this.manage=function(e){e?(r=0,1<e&&this.decrease()):5<++r&&(this.increase(),r=0)}.bind(this),this.decrease=function(){e||1===n||(e=!0,n=o<n?o:1,logger.warn("Decreasing FPS to "+n),i(n,function(){e=!1}.bind(this)))}.bind(this),this.increase=function(){t||15===n||(t=!0,o=n++,logger.warn("Increasing FPS to "+n),i(n,function(){t=!1}.bind(this)))}.bind(this),function(e,t,n){for(var o,r=0;r<XPMobileSDK.library.VideoConnectionPool.cameras.length;r++)(o=XPMobileSDK.library.VideoConnectionPool.cameras[r]).videoConnection&&o.videoConnection.videoId&&(o={VideoId:o.videoConnection.videoId,Fps:e,VideoConnection:o.videoConnection},c.ChangeStream(o,t,n))}.bind(this))},F=(this.ptzPreset=function(e,t){e={CameraId:e.cameraId,PtzPreset:t};return c.sendCommand("ControlPTZ",e,null,k)},this.ptzMove=function(e,t){t={CameraId:e.cameraId,PtzMove:t,VideoConnection:e};return c.sendCommand("ControlPTZ",t,null,k)},this.ptzTapAndHold=function(e,t,n){return e.Type="TapAndHold",e.GestureTimeout=2e3,c.sendCommand("ControlPTZ",e,{successCallback:t},F,n)},function(e){w(e,"Error controlling PTZ",function(){e.options.successCallback&&e.options.successCallback()})}),k=(this.ptzSwipe=function(e,t){return e.Type="Swipe",e.GestureDuration=t,c.sendCommand("ControlPTZ",e,null,k)},function(e){w(e,"Error controlling PTZ")}),q=(this.playbackSpeed=function(e,t){t={VideoId:e.videoId,Speed:t,VideoConnection:e};return c.ChangeStream(t)},this.playbackSeek=function(e,t){t={VideoId:e.videoId,SeekType:t,VideoConnection:e};return c.ChangeStream(t)},this.playbackGoTo=function(e,t,n,o,r){n={VideoId:e.videoId,SeekType:n||"Time",Time:t,VideoConnection:e};return c.ChangeStream(n,o,r)},this.getThumbnail=function(e,t,n){return c.sendCommand("GetThumbnail",{CameraId:e,ComprLevel:70},{successCallback:t},q,n)},function(e){w(e,"Error getting thumbnail.",function(){e.response.thumbnailBase64&&e.options.successCallback&&e.options.successCallback(e.response.thumbnailBase64)})}),L=(this.getThumbnailByTime=function(e,t,n){var o={CameraId:e.cameraId,Time:e.time,SeekType:"Time"};return e.width&&(o.DestWidth=e.width),e.height&&(o.DestHeight=e.height),c.sendCommand("GetThumbnailByTime",o,{successCallback:t},L,n)},function(e){w(e,"Error getting thumbnail by time",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.Thumbnail,e.response.outputParameters.Timestamp)})}),H=(this.getDBStartTime=function(e,t,n){return c.sendCommand("GetRecordingTime",{CameraId:e,SeekType:"DbStart"},{successCallback:t},H,n)},function(e){w(e,"Error getting recording time",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.Time)})}),V=(this.getNextSequence=function(e,t,n,o){var r=parseInt(((new Date).getTime()-t)/1e3);return c.sendCommand("GetSequences",{ItemId:e,SeqType:"Recording",Time:t,AfterTime:r<0?0:r,AfterCount:1,ItemKind:"Camera"},{successCallback:n},V,o)},function(e){w(e,"Error getting sequences",function(){0<e.response.sequences.length?e.options.successCallback&&e.options.successCallback(e.response.sequences[0]):e.options.successCallback&&e.options.successCallback(null)})}),z=(this.getPrevSequence=function(e,t,n,o){e={ItemId:e,SeqType:"Recording",Time:t,BeforeTime:Date.daysToSeconds(30),BeforeCount:1,ItemKind:"Camera"};return c.sendCommand("GetSequences",e,{successCallback:n},z,o)},function(e){w(e,"Error getting sequences",function(){0<e.response.sequences.length?e.options.successCallback&&e.options.successCallback(e.response.sequences[0]):e.options.successCallback&&e.options.successCallback(null)})}),U=(this.getSequencesInInterval=function(e,t,n,o,r,i){e={ItemId:e,SeqType:"Recording",Time:t,AfterTime:parseInt((n-t)/1e3),AfterCount:1e4,ItemKind:"Camera"};return o&&(e.InvestigationId=o),c.sendCommand("GetSequences",e,{successCallback:r},U,i)},function(e){w(e,"Error getting sequences",function(){e.options.successCallback&&e.options.successCallback(e.response.sequences)})}),W=(this.getSequencesForView=function(e,t,n,o,r,i){var s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"Recording",a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"Camera",s={ItemId:e,SeqType:s,Time:t,AfterTime:parseInt((n-t)/1e3),AfterCount:1e4,ItemKind:a,MinTimeBetweenSequences:o||1};return c.sendCommand("GetSequences",s,{successCallback:r},W,i)},function(e){w(e,"Error getting sequences",function(){e.options.successCallback&&e.options.successCallback(e.response.sequences)})}),j=(this.getUserExports=function(e,t){return c.sendCommand("GetExport",{ExportId:"00000000-0000-0000-0000-000000000000"},{successCallback:e},j,t)},function(e){w(e,"Error getting user exports",function(){e.options.successCallback&&e.options.successCallback(e.response.exports)})}),G=(this.getAllExports=function(e,t){return c.sendCommand("GetExport",{ExportId:"{A3B9C5FB-FAAD-42C8-AB73-B79D6FFFDBC1}"},{successCallback:e},G,t)},function(e){w(e,"Error getting all exports",function(){e.options.successCallback&&e.options.successCallback(e.response.exports)})}),J=(this.createExportDownloadLink=function(e,t,n,o,r){return c.sendCommand("CreateExportDownloadLink",{ExportId:e,InvestigationId:t,Type:n},{successCallback:o},J,r)},function(e){w(e,"Error getting export download link",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.ExportLink)})}),Y=(this.getExport=function(e,t,n){return c.sendCommand("GetExport",{ExportId:e},{successCallback:t},Y,n)},function(e){w(e,"Error getting export",function(){0===e.response.exports.length?e.options.successCallback&&e.options.successCallback(null):e.options.successCallback&&e.options.successCallback(e.response.exports[0])})}),Q=(this.getOutputsAndEvents=function(e,t){return c.sendCommand("GetOutputsAndEvents",{CameraId:""},{successCallback:e},Q,t)},function(e){w(e,"Error getting outputs and events",function(){e.options.successCallback&&e.options.successCallback(e.response.actions)})}),Z=(this.getServerStatus=function(e,t){return c.sendCommand("GetServerStatus",{},{successCallback:e},Z,t)},function(e){w(e,"Error getting server status",function(){e.options.successCallback&&e.options.successCallback(e.response.ServerStatus)})}),ee=(this.triggerOutputOrEvent=function(e,t,n,o){return c.sendCommand("RequestActivation",{ObjectId:e,TriggerType:t},{successCallback:n},ee,o)},function(e){w(e,"Error triggering output or event.",function(){e.options.successCallback&&e.options.successCallback()})}),te=(this.getCameraCapabilities=function(e,t,n){return c.sendCommand("GetCapabilities",{CameraId:e},{successCallback:t},te,n)},function(e){w(e,"Error getting camera capabilities",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})}),ne=(this.requestChallenges=function(e,t,n){return c.sendCommand("RequestChallenges",e,{successCallback:t},ne,n)},function(e){w(e,"Error getting challenges.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})}),oe=(this.createPlaybackController=function(e,t,n){return e.MethodType="Push",e.CloseOldControllers||(e.CloseOldControllers="Yes"),c.sendCommand("CreatePlaybackController",e,{successCallback:t},oe,n)},function(e){var t=e.response,n=new XPMobileSDK.library.VideoConnection(t.outputParameters.PlaybackControllerId,e,{onClose:function(){},onRestart:function(){},onPushFailed:function(){}});w(e,"Error creating playback controller",function(){e.options.successCallback&&e.options.successCallback(n)})}),re=(this.changeMultipleStreams=function(e,t,n){return c.sendCommand("ChangeMultipleStreams",e,{successCallback:t},re,n)},function(e){w(e,"Error getting multiple stream data",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})}),D=(this.getAllInvestigations=function(e,t){return c.sendCommand("GetInvestigation",{ItemId:"{A3B9C5FB-FAAD-42C8-AB73-B79D6FFFDBC1}"},{successCallback:e},D,t)},this.getUserInvestigations=function(e,t){return c.sendCommand("GetInvestigation",{ItemId:"00000000-0000-0000-0000-000000000000"},{successCallback:e},D,t)},function(e){w(e,"Error getting investigations",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),ie=(this.getInvestigation=function(e,t,n){return c.sendCommand("GetInvestigation",{ItemId:e},{successCallback:t},ie,n)},function(e){w(e,"Error getting investigation",function(){e.options.successCallback&&e.options.successCallback(e.response.items[0])})}),se=(this.createInvestigation=function(e,t,n){return c.sendCommand("CreateInvestigation",e,{successCallback:t},se,n)},function(e){w(e,"Error creating investigation to the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})}),E=(this.updateInvestigation=function(e,t,n){return c.sendCommand("UpdateInvestigation",e,{successCallback:t},E,n)},this.updateInvestigationData=function(e,t,n){return c.sendCommand("UpdateInvestigationData",e,{successCallback:t},E,n)},function(e){w(e,"Error updating investigation to the server.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})}),ae=(this.deleteInvestigation=function(e,t,n){return c.sendCommand("DeleteInvestigation",{ItemId:e},{successCallback:t},ae,n)},function(e){w(e,"Error deleteing investigation from the server.",function(){e.options.successCallback&&e.options.successCallback(!e.response.isError)})}),ce=(this.cancelInvestigation=function(e){return c.sendCommand("CancelInvestigationUpdate",{ItemId:e},null,ce)},function(e){w(e,"Error canceling investigation update")}),le=(this.startInvestigationExport=function(e,t,n,o,r,i){e={InvestigationId:e,ExportType:t,IncludeAudio:n};return o&&(e.Password=o),c.sendCommand("StartInvestigationExport",e,{successCallback:r},le,i)},function(e){w(e,"Error starting investigation export.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters.ExportId)})}),ue=(this.deleteInvestigationExport=function(e,t,n,o){return c.sendCommand("DeleteInvestigationExport",{InvestigationId:e,ExportType:t},{successCallback:n},ue,o)},function(e){w(e,"Error deleting investigation export.",e.options.successCallback)}),de=(this.getAlarmList=function(e,t,n){return e={MyAlarms:e.MyAlarms||"No",Timestamp:e.Timestamp,Operator:"LessThan",Count:e.Count,Priority:e.Priority,State:e.State},c.sendCommand("GetAlarmList",e,{successCallback:t},de,n)},function(e){w(e,"Error getting alarms",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),he=(this.getAlarm=function(e,t,n){return c.sendCommand("GetAlarmList",{AlarmId:e},{successCallback:t},he,n)},function(e){w(e,"Error getting alarm",function(){e.options.successCallback&&e.options.successCallback(e.response.items[0])})}),fe=(this.updateAlarm=function(e,t,n){return c.sendCommand("UpdateAlarm",e,{successCallback:t},fe,n)},function(e){w(e,"Error updating alarms",function(){e.options.successCallback&&e.options.successCallback()})}),ge=(this.getAlarmDataSettings=function(e,t){return c.sendCommand("GetAlarmDataSettings",{},{successCallback:e},ge,t)},function(e){w(e,"Error getting alarm data settings",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),me=(this.getAlarmUsers=function(e,t,n){return c.sendCommand("GetPermittedUsers",{SourceId:e},{successCallback:t},me,n)},function(e){w(e,"Error getting permitted users for alarm",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),pe=(this.acknowledgeAlarm=function(e,t,n){return c.sendCommand("AcknowledgeAlarm",{Id:e},{successCallback:t},pe,n)},function(e){w(e,"Error acknowledging alarm",function(){e.options.successCallback&&e.options.successCallback()})}),M=(this.GetBookmarks=function(e,t,n){return c.sendCommand("GetBookmarks",e,{successCallback:t},M,n)},this.getBookmarks=function(e,t,n){var o={MyBookmarks:e.MyBookmarks||"No",BookmarkId:e.BookmarkId};return e.Count&&(o.Count=e.Count),e.StartTime&&(o.StartTime=e.StartTime),e.EndTime&&(o.EndTime=e.EndTime),e.Keyword&&(o.Keyword=e.Keyword),e.SearchCameraIds&&(o.SearchCameraIds=e.SearchCameraIds),c.sendCommand("GetBookmarks",o,{successCallback:t},M,n)},function(e){w(e,"Error getting bookmarks",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),be=(this.deleteBookmark=function(e,t,n){return c.sendCommand("DeleteBookmark",{BookmarkId:e},{successCallback:t},be,n)},function(e){w(e,"Error deleting bookmark.",function(){e.options.successCallback&&e.options.successCallback()})}),Ce=(this.prevCarouselCamera=function(e){return c.sendCommand("ControlCarousel",{VideoId:e,CarouselCommand:"PreviousCamera"},null,Ce)},function(e){w(e,"Error getting prev camera from carousel")}),Se=(this.nextCarouselCamera=function(e){return c.sendCommand("ControlCarousel",{VideoId:e,CarouselCommand:"NextCamera"},null,Se)},function(e){w(e,"Error getting next camera from carousel")}),ye=(this.pauseCarousel=function(e){return c.sendCommand("ControlCarousel",{VideoId:e,CarouselCommand:"PauseCarousel"},null,ye)},function(e){w(e,"Error pausing carousel")}),ve=(this.resumeCarousel=function(e){return c.sendCommand("ControlCarousel",{VideoId:e,CarouselCommand:"ResumeCarousel"},null,ve)},function(e){w(e,"Error resuming carousel")}),_e=(this.registerForNotifications=function(e,t,n){var o=$.getBrowser(),o=o.name+" "+o.version+", "+o.os,e={Settings:e,DeviceName:XPMobileSDK.library.Connection.dh.encodeString(o),DeviceId:XPMobileSDK.library.Connection.connectionId};return c.RegisterForNotifications(e,t,n)},this.RegisterForNotifications=function(e,t,n){return c.sendCommand("RegisterForNotifications",e,{successCallback:t},_e,n)},function(e){w(e,"Error register for notifications.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),Ie=(this.CreateBookmark=function(e,t,n){return c.sendCommand("CreateBookmark",e,{successCallback:t},Ie,n)},function(e){w(e,"Error creating a bookmark.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),Pe=(this.RequestBookmarkCreation=function(e,t,n){return c.sendCommand("RequestBookmarkCreation",e,{successCallback:t},Pe,n)},function(e){w(e,"Error requesting a bookmark.",function(){e.options.successCallback&&e.options.successCallback(e.response.outputParameters)})}),ke=(this.UpdateBookmark=function(e,t,n){return c.sendCommand("UpdateBookmark",e,{successCallback:t},ke,n)},function(e){w(e,"Error update a bookmark.",function(){e.options.successCallback&&e.options.successCallback(e.response.items)})}),w=function(e,t,n){T(e);var o=e.response;!o||o.isError?R(e)?(logger.error("The application has lost connection due to connectionRequestResponseIsTerminal"),logger.log(t),X()):(t&&logger.error(t),e.options.failCallback?e.options.failCallback(o.error,o):e.options.successCallback&&e.options.successCallback(null,o.error,o)):n&&n()},T=(this.sendCommand=function(e,t,n,o,r){if(t=t||{},XPMobileSDKSettings.supportsCHAP&&"Yes"===c.SecurityEnabled&&"Yes"===c.CHAPSupported){var i=XPMobileSDK.library.CHAP.calculate();if(i.Challenge&&i.ChalAnswer)t.Challenge=i.Challenge,t.ChalAnswer=i.ChalAnswer;else if(XPMobileSDK.library.Connection.state===XPMobileSDK.library.ConnectionStates.working)return void logger.error("No challenges to perform the action")}n=n||{},r&&(n.failCallback=r),logger.log("Sending "+e+" on "+new Date+"with ",t);i=new XPMobileSDK.library.ConnectionRequest(e,De(),t,n,o);return s.push(i),i},function(e){var t=s.indexOf(e),t=(-1<t&&s.splice(t,1),{parameters:e.params,options:e.options}),e=e.response&&{parameters:e.response.outputParameters};B("connectionRequestSucceeded",t,e)}),De=function(){return++t},A=function(e){c.state=e,B("connectionStateChanged")},B=function(){var t,n;arguments.length<1||(t=arguments[0],n=Array.prototype.slice.call(arguments,1),a.filter(e=>e[t]).forEach(function(e){try{e[t].apply(e,n)}catch(e){logger.error(e),logger.log(e.stack)}}))},x=function(){c.liveMessageTimer||(c.liveMessageTimer=setInterval(c.sendLiveMessage,1e3*c.serverTimeout/3))},K=(this.updateLiveMessageTimer=function(e){var t=1e3*c.serverTimeout/3;e&&"number"==typeof e&&(t=Math.min(t,e)),clearTimeout(c.liveMessageTimer),c.liveMessageTimer=setInterval(c.sendLiveMessage,t)},function(){c.liveMessageTimer&&(clearTimeout(c.liveMessageTimer),c.liveMessageTimer=null)}),Ee=(this.sendLiveMessage=function(){c.LiveMessage(),c.webSocketServer&&c.webSocketBrowser&&N.manage(l),l++},this.LiveMessage=function(e,t,n){c.sendCommand("LiveMessage",e=e||{},{successCallback:t},Ee,n=n||o)},function(e){l--,T(e),clearTimeout(r),r=void 0;var t=e.response;if(t&&!t.isError||!R(e)){if(c.connectingViaExternalConnectionID&&(c.connectingViaExternalConnectionID=!1,logger.log("Started connection from external connection ID"),A(XPMobileSDK.library.ConnectionStates.working),B("connectionDidLogIn"),B("connectionDidConnectWithId")),"Yes"!==t.outputParameters.FolderDefinitionsChanged&&"Yes"!==t.outputParameters.ViewDefinitionsChanged||B("connectionReloadConfiguration"),"Yes"===t.outputParameters.CameraDefinitionsChanged&&B("connectionReloadCameraConfiguration"),t.items&&0<t.items.length)for(var n=0;n<t.items.length;n++)"Notification"===t.items[n].Type&&B("receivedNotification",t.items[n]);x()}else c.connectingViaExternalConnectionID?(c.connectingViaExternalConnectionID=!1,logger.warn("Old connection ID has expired"),B("connectionFailedToConnectWithId",t&&t.error),c.connectionId=null):X(),K()}),Me=function(e){if(e){var t={};for(i in e)switch(i){case"Challenge":t.CHAPSupported=!0;break;case"ServerType":XPMobileSDKSettings.ServerType=e[i];break;case"ServerDescription":XPMobileSDKSettings.ServerDescription=e[i];break;default:var n=isNaN(Number(e[i]))?"Yes"===e[i]:Number(e[i]);t[i]=n}we(t),c.storage&&c.storage.setItem("features",t),XPMobileSDK.features=t}},we=function(e){e.NativeStreamingAvailable?e.TranscodedStreamingAvailable?e.NativeStreamingSuggested?e.DirectStreaming=c.DSServerStatus.EnforceWheneverPossible:e.DirectStreaming=c.DSServerStatus.DoNotEnforce:e.DirectStreaming=c.DSServerStatus.Enforce:e.DirectStreaming=c.DSServerStatus.NotAvailable},R=function(e){e=e.response;return void 0===e||e.errorCode===XPMobileSDK.library.ConnectionError.WrongID||e.errorCode===XPMobileSDK.library.ConnectionError.ChallengesLimitReached||"Wrong connection ID"===e.errorString},X=function(){c.state!==XPMobileSDK.library.ConnectionStates.lostConnection&&(A(XPMobileSDK.library.ConnectionStates.lostConnection),c.connectionId=null,XPMobileSDK.library.VideoConnectionPool.clear(),c.destroy(),B("connectionLostConnection"))};this.destroy=function(){s=[],c.storage&&(c.storage.removeItem("features"),c.storage.removeItem("webSocketServer"),c.storage.removeItem("directStreamingServer"))}},XPMobileSDK.library.ConnectionError={NotImplemented:1,NotFullyImplemented:2,BadCommandType:10,BadCommandKind:11,WrongID:12,MissingInputParameter:13,WrongInputParameter:14,InvalidCredentials:15,IncorrectPublicKey:16,SurveillanceServerDown:17,InvalidLicense:18,SecurityError:19,UnknownCameraID:20,UnknownItemID:21,NoPresetsAvailable:22,NotAllowedInThisState:23,FeatureIsDisabled:24,InsufficientUserRights:25,TooManySessions:26,NewConfigurationNotAvailable:27,AddressesNotReachable:28,PlaybackStreamsLimitReached:29,Redirection:30,MovingInvestigations:31,NoRecordingsFound:32,NoRecordingsInInterval:33,SecondStepAuthenticationRequired:34,SecondStepAuthenticationEnabledUsersOnly:35,SecondStepAuthenticationCodeError:36,SecondStepAuthenticationCodeExpired:37,InputParameterTooLong:43,ChallengesLimitReached:51,UknownIdOrInsufficientRightForSomeItems:52,UknownIdOrInsufficientRightForAllItems:53,ItemNotPlayable:54,ChangePassword:60,AccountLockedOut:61,Unknown:2147483647,IncorrectServerResponse:this.Unknown-21,SdkNotConnected:this.Unknown-20,HttpResponseError:this.Unknown-11,HttpRequestError:this.Unknown-10,CommandProcessingError:this.Unknown-3,CommandTimedOut:this.Unknown-2,InternalError:this.Unknown-1},!function(){var b=0;XPMobileSDK.library.ConnectionRequest=function(o,e,r,t,i){var s,n,a=this,c=(XPMobileSDK.addObserver(this),a.options=t||{},a.response=null,r.VideoConnection&&(a.VideoConnection=r.VideoConnection,delete r.VideoConnection),a.params=r||{},!1),l=0,u=function(){var t="";for(key in r){function n(e,t){return'<Param Name="'+e+'" Value="'+(t=(t=void 0!==t&&t.toString?t.toString():"").replaceAll("&","&amp;").replace(/(\r\n|\r|\n)/g,"&#10;").replaceAll('"',"&quot;").replaceAll("<","&lt;"))+'" />'}void 0!==r[key]&&r[key]instanceof Array?r[key].forEach(function(e){t+=n(key,e)}):t+=n(key,r[key])}return'<?xml version="1.0" encoding="utf-8"?><Communication xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">'+(XPMobileSDK.library.Connection.connectionId?"<ConnectionId>"+XPMobileSDK.library.Connection.connectionId+"</ConnectionId >":"")+'<Command SequenceId="'+e+'"><Type>Request</Type><Name>'+o+"</Name><InputParams>"+t+"</InputParams></Command></Communication>\r\n\r\n"}(),d=function(e){if(/^http(s)?:/i.test(e))return e;var t=window.location.protocol+"//",n=document.location.hostname,o=document.location.port&&!/^:\d+/.test(e)?":"+document.location.port:"";return t+n+o+e}(XPMobileSDK.library.Connection.server)+XPMobileSDKSettings.communicationChanel,h=!1;function f(){"LiveMessage"==o&&(b=Date.now()),logger.log(u),s=XPMobileSDK.library.Ajax.Request(d,{contentType:"text/xml",postBody:u,onSuccess:m,onComplete:g,onFailure:a.options.failCallback||function(){p()},timeout:t.timeout})}function g(e){4!=e.readyState||200==e.status||"LiveMessage"==o&&Date.now()-b<XPMobileSDKSettings.liveMessageMinimumInterval?XPMobileSDK.removeObserver(a):function(){h||(logger.error("Command "+o+" failed"),"LiveMessage"!=o&&"CloseStream"!=o&&"RequestStream"!=o&&"Disconnect"!=o)||(logger.warn("Restarting "+o),CommunicationStability.addBreakDown(a),setTimeout(function(){c=!1,f()}.bind(this),1e3))}()}function m(){CommunicationStability.removeBreakDown(a),n&&(clearTimeout(n),n=null),c||(p(),c=!0),s=null}function p(){var e;try{var t=s.responseText}catch(e){return}for("<?xml"!=t.trim().substr(0,5)&&(a.response={isError:!0,errorCode:"The response from the server is not well-formatted",outputParameters:[]},i)&&i(a);0<(e=t.indexOf("\r\n\r\n",l));){var n=t.substring(l,e);!n||(n=new XPMobileSDK.library.ConnectionResponse(n)).isProcessing||(a.response=n,c=!0,i&&i(a)),l=e+4}}f(),this.cancel=function(){n&&(clearTimeout(n),n=null),s&&(s.onreadystatechange=function(){},s.abort(),s=null,XPMobileSDK.library.Ajax.activeRequestCount--),XPMobileSDK.removeObserver(a)},this.connectionDidDisconnect=function(){h=!0,XPMobileSDK.removeObserver(a)}}}(),XPMobileSDK.library.ConnectionResponse=function(t){var n=this;n.sequenceID=0,n.command="",n.isResponse=!1,n.isProcessing=!1,n.isError=!1,n.outputParameters=null,n.subItems=null,n.thumbnailBase64=null,n.exports=[],n.sequences=[],n.actions=[],n.items=[],n.errorCode=0,n.errorString="";var o,r,i,e,s,a=parseXML(t).getElementsByTagName("Communication")[0].getElementsByTagName("Command")[0],c=a.getElementsByTagName("Type")[0];if("Processing"==XMLNodeTextContent(c))logger.log("Processing..."),n.isProcessing=!0;else if("Response"==XMLNodeTextContent(c)){if(n.isResponse=!0,0<(c=a.getElementsByTagName("OutputParams")).length){n.outputParameters={};for(var l=c[0].getElementsByTagName("Param"),u=0,d=l.length;u<d;u++){for(var h,f="",g="",m=l[u].attributes,p=0;p<m.length;p++){var b=m[p];"Name"==b.name?f=b.value:"Value"==b.name&&(g=b.value)}f&&g&&(this.outputParameters[f]&&"string"==typeof this.outputParameters[f]?(h=this.outputParameters[f],this.outputParameters[f]=new Array,this.outputParameters[f].push(h)):"object"==typeof this.outputParameters[f]?this.outputParameters[f].push(g):this.outputParameters[f]=g)}}0<(c=a.getElementsByTagName("SubItems")).length&&(n.subItems=c[0]),0<(c=a.getElementsByTagName("ServerStatus")).length&&(n.ServerStatus={},0<(e=c[0].getElementsByTagName("CpuUsage")).length&&(n.ServerStatus.CPU=XMLNodeTextContent(e[0])),0<(e=c[0].getElementsByTagName("DiskUsage")).length)&&(n.ServerStatus.HDD={},0<(s=e[0].getElementsByTagName("RecordingDiskUsageInBytes")).length&&(n.ServerStatus.HDD.recorded=XMLNodeTextContent(s[0])),0<(s=e[0].getElementsByTagName("ExportsDiskUsageInBytes")).length&&(n.ServerStatus.HDD.exports=XMLNodeTextContent(s[0])),0<(s=e[0].getElementsByTagName("UserDiskUsageInBytes")).length&&(n.ServerStatus.HDD.user=XMLNodeTextContent(s[0])),0<(s=e[0].getElementsByTagName("OtherDiskUsageInBytes")).length&&(n.ServerStatus.HDD.other=XMLNodeTextContent(s[0])),0<(s=e[0].getElementsByTagName("FreeSpaceInBytes")).length)&&(n.ServerStatus.HDD.free=XMLNodeTextContent(s[0])),(s=(e=a).getElementsByTagName("Thumbnail")[0])?n.thumbnailBase64="data:image/jpeg;base64,"+XMLNodeTextContent(s):(s=e.getElementsByTagName("ThumbnailJSON")[0])&&(n.thumbnailJSON=XMLNodeTextContent(s));var C=a;if(0<(C=C.getElementsByTagName("Exports")).length){n.exports=[];for(var S=C[0].getElementsByTagName("Export"),y=0;y<S.length;y++){var v=w(S[y],{numbers:["Size","State"],dates:["StartTime","EndTime","CompletedTime","QueuedTime"]});n.exports.push(v)}}var C=a;if(0<(C=C.getElementsByTagName("Sequences")).length){n.sequences=[];for(var _=C[0].getElementsByTagName("Sequence"),I=0;I<_.length;I++){var P=w(_[I],{dates:["StartTime","EndTime","TimeStamp"]});n.sequences.push(P)}}C=a,i="00000000-0000-0000-0000-000000000000",n.actions=[],0!=(C=C.getElementsByTagName("OEHeaderGroup")).length&&(Array.prototype.forEach.call(C,function(t){var e=t.getElementsByTagName("OEItem");Array.prototype.forEach.call(e,function(e){e=w(e);e.Type=t.getAttribute("Name"),n.actions.push(e)})}),n.actions.sort(function(e,t){return"Outputs"==e.Type&&"Events"==t.Type?-1:"Events"==e.Type&&"Outputs"==t.Type?1:e.CameraId!=i&&t.CameraId==i?-1:e.CameraId==i&&t.CameraId!=i?1:e.Name<t.Name?-1:e.Name>t.Name?1:0}));for(var k=function(e){for(var t=[],n=e.childNodes,o=0;o<n.length;o++)if("Item"==n[o].nodeName){var r={};if(0<n[o].attributes.length)for(var i=0;i<n[o].attributes.length;i++)r[n[o].attributes[i].name]=T(n[o].attributes[i].value);for(i=0;i<n[o].childNodes.length;i++)if("Properties"==n[o].childNodes[i].nodeName)for(var s=0;s<n[o].childNodes[i].attributes.length;s++)r[n[o].childNodes[i].attributes[s].name]=T(n[o].childNodes[i].attributes[s].value);else"Items"==n[o].childNodes[i].nodeName&&(r.Items=k(n[o].childNodes[i]));t.push(r)}return t},D=a.childNodes,E=null,M=0;M<D.length;M++)"Items"==D[M].nodeName&&(E=D[M]);E&&(n.items=k(E));C=a.getElementsByTagName("Result")[0];if("OK"!=XMLNodeTextContent(C)){n.isError=!0,0<(c=a.getElementsByTagName("ErrorString")).length&&(n.errorString=XMLNodeTextContent(c[0])),0<(c=a.getElementsByTagName("ErrorCode")).length&&(n.errorCode=parseInt(XMLNodeTextContent(c[0]))),n.error={code:n.errorCode||XPMobileSDK.library.ConnectionError.Unknown,message:n.errorString||""};C=a.getElementsByTagName("Name");if(0<C.length){c=XMLNodeTextContent(C[0]);let e="CloseStream"===c?!1:!0;(e="LogIn"===c&&n.errorCode===XPMobileSDK.library.ConnectionError.SecondStepAuthenticationRequired?!1:e)&&logger.error("Response error "+(n.errorString||(o=n.errorCode,Object.keys(XPMobileSDK.library.ConnectionError).forEach(function(e){XPMobileSDK.library.ConnectionError[e]==o&&(r=e)}),r))+" "+(n.errorCode||"")+" Complete response: "+t)}}}function w(e,t){for(var n={},o=0;o<e.attributes.length;o++){var r=e.attributes[o];t&&t.numbers&&-1!=t.numbers.indexOf(r.name)?n[r.name]=Number(r.value):t&&t.dates&&-1!=t.dates.indexOf(r.name)?n[r.name]=new Date(parseInt(r.value)):n[r.name]=T(r.value)}return n}function T(e){for(var t=["<",">"],n=0,o=t.length;n<o;++n)e=e.replace(new RegExp(t[n],"g"),"");return e}},void 0!==window.DOMParser)parseXML=function(e){return(new window.DOMParser).parseFromString(e,"text/xml")},XMLNodeTextContent=function(e){return e.textContent};else{if(void 0===window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))throw new Error("No XML parser found");parseXML=function(e){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t},XMLNodeTextContent=function(e){return e.text}}XPMobileSDK.library.PullConnectionObserverInterface={onError:function(e){},onHTTPError:function(e){},onPushFailed:function(){},notifyChannel:function(e){},notifyObservers:function(e){},videoConnectionTemporaryDown:function(e){},restart:function(){}},XPMobileSDK.library.PullConnection=function(t,e){var n={method:"post",contentType:"text/xml",onLoading:function(e){{var t;c()&&(d(),t=XPMobileSDKSettings.videoConnectionTimeout,r.ajaxRequestTimeout=setTimeout(function(){e&&(logger.warn("aborting video request for "+r.videoId),e.onreadystatechange=function(){},e.abort(),XPMobileSDK.library.Ajax.activeRequestCount--,h("onError",e))}.bind(this),t))}},onSuccess:function(t){if(0!=t.status||t.response&&0!==t.response.byteLength){if(a()){h("notifyChannel",!0),d();try{var e,n=t.response,o=new XPMobileSDK.library.VideoHeaderParser(n);o.duration&&(e=1e3*o.duration*.8),h("notifyObservers",o),d(),r.videoConnectionState==XPMobileSDK.library.VideoConnectionState.running&&(o.stream&&o.stream.timeBetweenFrames?(i=2*o.stream.timeBetweenFrames/3,r.requestNextFrameInterval=i):i?r.requestNextFrameInterval=i:o.dataSize||r.signalType!=XPMobileSDK.interfaces.VideoConnectionSignal.live?r.requestNextFrameInterval=e||NETWORK.requestTime:r.requestNextFrameInterval=Math.min(NETWORK.MAX_REQUEST_TIME,r.requestNextFrameInterval*function(e){var t=e-10,e=e+10;return Math.floor(Math.random()*(e-t+1))+t}(100*NETWORK.REQUEST_TIME_GROW_PER_EMPTY_FRAME)/100),s(r.requestNextFrameInterval)),0}catch(e){logger.error("Exception in video connection ajax response",e),logger.error(e.stack),h("onHTTPError",t)}}}else h("onHTTPError",t)},onFailure:function(e){logger.error("ERROR in ajax request for frame for video channel "+t),h("onHTTPError",e)}},r=(e.signalType,"undefined"!=typeof ArrayBuffer&&(n.responseType="arraybuffer"),this),o=(r.videoConnectionState=XPMobileSDK.library.VideoConnectionState.running,[]),i=0;function s(e){(c()||a()||l())&&function(e){{if(!CommunicationStability.isBrokenDown())return 1;setTimeout(function(){s(e)},200)}}(e)&&l()&&(r.nextFrameTimeout=setTimeout(function(){u(),r.videoConnectionState!=XPMobileSDK.library.VideoConnectionState.closed&&(r.ajaxRequest=new XPMobileSDK.library.Ajax.Request(t,n))},e||1))}function a(){return r.videoConnectionState!=XPMobileSDK.library.VideoConnectionState.closed}function c(){return!r.ajaxRequest}function l(){return!r.nextFrameTimeout}function u(){r.nextFrameTimeout&&(clearTimeout(r.nextFrameTimeout),r.nextFrameTimeout=null)}function d(){r.ajaxRequestTimeout&&(clearTimeout(r.ajaxRequestTimeout),r.ajaxRequestTimeout=null)}function h(t,n){o.forEach(function(e){e&&e[t]&&e[t](n)})}this.restartConnection=function(e){try{if(h("videoConnectionTemporaryDown",e?e.status:-2),r.videoConnectionState==XPMobileSDK.library.VideoConnectionState.closed)return;h("restart")}catch(e){h("videoConnectionTemporaryDown",-1)}},this.cleanupCommunication=function(){u(),d(),r.ajaxRequest&&(4==r.ajaxRequest.readyState&&200==r.ajaxRequest.status||r.ajaxRequest.abort(),delete r.ajaxRequest,r.ajaxRequest=null),i=0},this.startCommunication=function(e){this.cleanupCommunication(),s(e)},this.videoConnectionChangedState=function(e){r.videoConnectionState=e},this.addObserver=function(e){o.push(e)},this.removeObserver=function(e){e=o.indexOf(e);-1!=e&&o.splice(e,1)}},XPMobileSDK.library.PushConnectionObserverInterface={onError:function(e){},onHTTPError:function(e){},onPushFailed:function(){},notifyChannel:function(e){},notifyObservers:function(e){},videoConnectionTemporaryDown:function(e){},restart:function(){}},XPMobileSDK.library.PushConnection=function(e,t){t.signalType;var n,o=null,r=(this.videoConnectionState=XPMobileSDK.library.VideoConnectionState.notOpened,[]),i=null,s=(this.startCommunication=function(){n||(i?Date.now()-i<XPMobileSDKSettings.videoStreamRestartMinimumInterval?setTimeout(function(){logger.warn("Restarting socket."),s()}.bind(this),XPMobileSDKSettings.socketRestartMinimumInterval):d("restart"):s())}.bind(this),function(){try{n=new WebSocket(e)}catch(e){return this.videoConnectionState==XPMobileSDK.library.VideoConnectionState.closed?void 0:(logger.error("WebSocket initialization failed. Falling back to AJAX..."),void d("onPushFailed"))}n.binaryType="arraybuffer",n.onerror=function(e){d("onError",n)},n.onopen=a,n.onclose=function(){var e={readyState:n.readyState,status:n.status};n=null,i=i||new Date,d("onError",e)}.bind(this)}.bind(this)),a=(this.restartConnection=function(e){logger.warn("Restarting socket."),this.startCommunication()}.bind(this),this.close=function(){n&&(n.onopen=null,n.onmessage=null,n.onerror=null,n.onclose=null,n.close(),n=null,this.messageInterval&&(clearInterval(this.messageInterval),this.messageInterval=null),logger.log("WebSocket closed"))}.bind(this),function(e){n.onmessage=c,n.onerror=l,n.onclose=u,window.addEventListener("beforeunload",this.close),this.messageInterval=setInterval(function(){n&&n.send("")},NETWORK.websocketSendMessage),d("notifyChannel",!0),logger.log("WebSocket open")}.bind(this)),c=function(e){o&&(delete o,o=null),o=new XPMobileSDK.library.VideoHeaderParser(e.data),d("notifyObservers",o)}.bind(this),l=function(e){logger.error("WebSocket error",e),this.messageInterval&&(clearInterval(this.messageInterval),this.messageInterval=null)}.bind(this),u=function(e){n.onopen=null,n.onmessage=null,n.onerror=null,n.onclose=null,n=null,this.messageInterval&&(clearInterval(this.messageInterval),this.messageInterval=null),this.videoConnectionState==XPMobileSDK.library.VideoConnectionState.running&&XPMobileSDK.library.Connection.connectionId&&(this.restartConnection(),d("videoConnectionTemporaryDown"))}.bind(this),d=(this.cleanupCommunication=function(){this.close()},this.videoConnectionChangedState=function(e){this.videoConnectionState=e},this.addObserver=function(e){r.push(e)},this.removeObserver=function(e){e=r.indexOf(e);-1!=e&&r.splice(e,1)},function(t,n){r.forEach(function(e){e&&e[t]&&e[t](n)})}.bind(this))},XPMobileSDK.library.VideoConnectionSignal={live:1,playback:2},XPMobileSDK.library.VideoConnectionState={notOpened:0,running:1,closed:2,closing:3},XPMobileSDK.library.VideoConnectionStream={native:1,transcoded:3,FragmentedMP4:4},XPMobileSDK.library.VideoConnectionObserverInterface={videoConnectionReceivedFrame:function(e){},videoConnectionFailed:function(){},videoConnectionTemporaryDown:function(e){},videoConnectionRecovered:function(){},videoConnectionChangedState:function(){},videoConnectionStreamingError:function(){}},XPMobileSDK.library.VideoConnection=function(e,t,n){XPMobileSDK.library.VideoConnection.instances.push(this),(n=n||{}).onClose=n.onClose||function(e){},n.onRestart=n.onRestart||function(e){},n.onPushFailed=n.onPushFailed||function(){};var o=this,r=[],i=XPMobileSDK.library.VideoConnectionState.notOpened,s=(o.request={parameters:t.params,options:t.options},o.response={parameters:t.response.outputParameters},o.videoId=e,o.request.options&&(o.cameraId=o.request.options.cameraId,o.signalType=o.request.options.signal,o.isReusable=o.request.options.reuseConnection),o.isPush="Push"==o.request.parameters.MethodType,o.isDirectStreaming="FragmentedMP4"==o.request.parameters.StreamType,o.supportsPTZ="Yes"==o.response.parameters.PTZ,o.supportsPTZPresets="Yes"==o.response.parameters.Preset,o.supportsPlayback="Yes"==o.response.parameters.Playback,o.supportsExport="Yes"==o.response.parameters.ExportAvi,null),a=new function(e){this.connected=!1,this.current;for(var t,n=[],o=0;t=e["VideoChannel"+o];o++)n.push(m(t));n.length||n.push(m(XPMobileSDKSettings.MobileServerURL+XPMobileSDKSettings.videoChanel));logger.log("Available video channels: ",n),this.getNext=function(){return this.connected||(this.current=n.shift()),this.current}.bind(this),this.hasNext=function(){return!this.connected&&n.length}.bind(this),this.getNext()}(o.response.parameters),c=a.current,l=null,u=(this.open=function(){switch(i){case XPMobileSDK.library.VideoConnectionState.notOpened:p(XPMobileSDK.library.VideoConnectionState.running),window.Worker&&XPMobileSDKSettings.supportsMultiThreaded?(logger.info("Opening multithreaded video connection "+o.videoId+" with Web Worker"),o.worker=new Worker("js/ThreadConnection.js"),o.worker.addEventListener("message",function(e){"onPushFailed"==e.data.message?n.onPushFailed():v(e.data.message,e.data.result)},!1),o.worker.postMessage({message:"startCommunication",arguments:{url:c+"/"+o.videoId+"/",signalType:o.signalType,isPush:o.isPush}})):(o.isPush?(logger.info("Opening WebSocket video connection "+o.videoId),o.communication=new XPMobileSDK.library.PushConnection(c+"/"+o.videoId+"/",{signalType:o.signalType})):(logger.info("Opening AJAX video connection "+o.videoId),o.communication=new XPMobileSDK.library.PullConnection(c+"/"+o.videoId+"/",{signalType:o.signalType})),o.communication.addObserver({onError:S,onHTTPError:C,onPushFailed:b,notifyChannel:f,notifyObservers:h,videoConnectionTemporaryDown:y,restart:o.restart}),o.addObserver(o.communication),o.communication.startCommunication()),v("videoConnectionChangedState",i),i==XPMobileSDK.library.VideoConnectionState.running&&u();break;case XPMobileSDK.library.VideoConnectionState.running:o.isReusable?logger.info("Opening a reusable video connection from the pool "+o.videoId):logger.warn("WARNING: Attempting to open a running connection!"),u();break;case XPMobileSDK.library.VideoConnectionState.closed:logger.warn("WARNING: Attempting to re-open a closed connection!"),d()}},function(){l&&clearTimeout(l),l=setTimeout(function(){v("noVideoTimeout")},XPMobileSDKSettings.NoVideoTimeout)}),d=function(){l&&clearTimeout(l)};function h(e){if(e.stream&&e.stream.error)switch(e.stream.error){case XPMobileSDK.library.ItemHeaderParser.Error.NonFatal:o.request.parameters.StreamType="Transcoded",o.restart();break;case XPMobileSDK.library.ItemHeaderParser.Error.Fatal:v("videoConnectionStreamingError"),o.close()}else 0<r.length?(v("videoConnectionReceivedFrame",e),u(),o.wasConnectionDown&&(o.wasConnectionDown=!1,v("videoConnectionRecovered"))):(logger.warn("Video connection received an item but doesn't have observer to send it to!"),o.close())}function f(e){a.connected=e}function g(){v("cleanupCommunication"),o.worker&&XPMobileSDKSettings.supportsMultiThreaded&&(o.worker.terminate(),o.worker=null)}function m(e){return/^(http|ws)(s)?:/i.test(e)||(e=window.location.protocol+"//"+document.location.hostname+(document.location.port&&!/^:\d+/.test(e)?":"+document.location.port:"")+e),o.isPush?e.replace(/^http(s)?:/i,"ws$1:"):e.replace(/^ws(s)?:/i,"http$1:")}function p(e){i!=e&&v("videoConnectionChangedState",i=e)}function b(){n.onPushFailed()}function C(e){a.connected&&CommunicationStability.addVideoBreakDown(),S(e)}function S(e){if(i!=XPMobileSDK.library.VideoConnectionState.closed&&null!=XPMobileSDK.library.Connection.connectionId){if(a.connected)if(e.status){if(410==e.status)return void v("restartConnection",e);y(e.status)}else e.readyState&&e.readyState==WebSocket.CLOSED||0!=e.status||e.response&&0!==e.response.byteLength||y(e.status);else{if(!a.hasNext())return void v("videoConnectionNotAvailable");logger.log("Try next video channel."),c=a.getNext()}v("startCommunication",NETWORK.requestTimeOnFailure)}}function y(e){o.wasConnectionDown=!0,v("videoConnectionTemporaryDown",e)}function v(t,n){r.forEach(function(e){e&&e[t]&&e[t](n),o.worker&&o.worker.postMessage({message:t,arguments:n})})}this.restart=function(){i!=XPMobileSDK.library.VideoConnectionState.closed&&(logger.warn("Restarting video connection "+o.videoId+" for camera "+o.cameraId),p(XPMobileSDK.library.VideoConnectionState.closed),n.onRestart(o),g())},this.close=function(){d(),i!=XPMobileSDK.library.VideoConnectionState.closed&&i!=XPMobileSDK.library.VideoConnectionState.closing&&(p(XPMobileSDK.library.VideoConnectionState.closing),o.worker&&XPMobileSDKSettings.supportsMultiThreaded&&o.worker.terminate(),logger.log("Closing video connection "+o.videoId+" for camera "+o.cameraId),p(XPMobileSDK.library.VideoConnectionState.closed),n.onClose(o),g())},this.addObserver=function(e){r.push(e)},this.removeObserver=function(e){e=r.indexOf(e);-1!=e&&r.splice(e,1)},this.resetCommunication=function(){v("startCommunication")},this.destroy=function(){o.close(),s&&(s.destroy(),s=null),r=[],o.isPush||(onAjaxComplete=null,onAjaxFailure=null,onAjaxLoading=null,frameRequestParams=null,-1!=XPMobileSDK.library.VideoConnection.indexOf(this)&&XPMobileSDK.library.VideoConnection.splice(XPMobileSDK.library.VideoConnection.indexOf(this),1))},this.getState=function(){return i}},XPMobileSDK.library.VideoConnection.instances=[];let VideoStreamState={new:0,open:1,closed:2};class VideoStream{constructor(e,t,n){this.videoConnectionElement=document.createElement("video-connection"),this.videoConnectionElement.videoId=this.videoId=e,this.videoConnectionElement.location=XPMobileSDKSettings.MobileServerURL+XPMobileSDKSettings.videoChanel,this.videoConnectionElement.addEventListener("onReceivedFrame",this.onReceivedFrame.bind(this)),this.videoConnectionElement.addEventListener("onConnectionError",this.onConnectionError.bind(this)),this.request={parameters:t.params,options:t.options},this.response={parameters:t.response.outputParameters},this.request.options&&(this.cameraId=this.request.options.cameraId,this.signalType=this.request.options.signal,this.isReusable=this.request.options.reuseConnection),this.isPush="Push"==this.request.parameters.MethodType,this.isDirectStreaming="FragmentedMP4"==this.request.parameters.StreamType,this.supportsPTZ="Yes"==this.response.parameters.PTZ,this.supportsPTZPresets="Yes"==this.response.parameters.Preset,this.supportsPlayback="Yes"==this.response.parameters.Playback,this.supportsExport="Yes"==this.response.parameters.ExportAvi,this.callbacks=n||{},this.callbacks.onClose=this.callbacks.onClose||function(e){},this.callbacks.onRestart=this.callbacks.onRestart||function(e){},this.callbacks.onPushFailed=this.callbacks.onPushFailed||function(){},this.observers=[],this.state=VideoStreamState.new}get isClosed(){return this.state===VideoStreamState.closed}open(){this.isClosed||(this.videoConnectionElement.dispatchEvent(new CustomEvent("start")),this.state=VideoStreamState.open)}close(){this.isClosed||(this.videoConnectionElement.dispatchEvent(new CustomEvent("destroy")),XPMobileSDK.closeStream(this.videoId),this.state=VideoStreamState.closed)}onReceivedFrame(e){0<this.observers.length?this.callMethodOnObservers("videoConnectionReceivedFrame",e.detail.frame):(logger.warn("Video connection received an item but doesn't have observer to send it to!"),this.close())}onConnectionError(){this.isClosed||(this.close(),this.callMethodOnObservers("videoConnectionError"))}refresh(){this.videoConnectionElement.refresh()}addObserver(e){this.observers.push(e)}removeObserver(e){e=this.observers.indexOf(e);-1!=e&&this.observers.splice(e,1)}callMethodOnObservers(t,n){this.observers.forEach(function(e){e&&e[t]&&e[t](n)})}}!function(){function h(a){var i=this,c=0,t=function(e){return e},n=function(e){return Array.prototype.reverse.call(e)};function s(e){c+=e}function l(e){var t=new Uint8Array(a,c,e),n=0;c+=e;for(var o=0;o<e;o++)n+=t[o]*Math.pow(2,8*o);return n}function o(e,t){for(var n,o,r=t(new Uint8Array(a,c,e)),i="",s=0;s<e;s++)i+=(n=r[s],o=void 0,""+(o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"])[(240&n)>>4]+o[15&n]);return c+=e,i}function r(e){return o(e,t)}function u(e){return o(e,n)}function d(){var e="";return e+u(4)+"-"+u(2)+"-"+u(2)+"-"+r(2)+"-"+r(6)}i.readBytes=l,i.skipBytes=s,i.getGUID=d,i.parseSizeInformation=function(){i.sizeInfo={sourceSize:{},sourceCrop:{},destinationSize:{}},i.sizeInfo.sourceSize.width=l(4),i.sizeInfo.sourceSize.height=l(4),i.sizeInfo.sourceCrop.left=l(4),i.sizeInfo.sourceCrop.top=l(4),i.sizeInfo.sourceCrop.right=l(4),i.sizeInfo.sourceCrop.bottom=l(4),i.sizeInfo.sourceCrop.width=i.sizeInfo.sourceCrop.right-i.sizeInfo.sourceCrop.left,i.sizeInfo.sourceCrop.height=i.sizeInfo.sourceCrop.bottom-i.sizeInfo.sourceCrop.top,i.sizeInfo.destinationSize.width=l(4),i.sizeInfo.destinationSize.height=l(4),i.sizeInfo.destinationSize.resampling=l(4),i.sizeInfo.destinationSize.top=l(4),i.sizeInfo.destinationSize.right=l(4),i.sizeInfo.destinationSize.bottom=l(4)},i.parseLiveInformation=function(){i.currentLiveEvents=l(4),i.changedLiveEvents=l(4)},i.parsePlaybackInformation=function(){i.currentPlaybackEvents=l(4),i.changedPlaybackEvents=l(4)},i.parsePlaybackInfo=function(){i.requestedTimeStampUtcMs=l(8),l(4),l(4)},i.parseStreamInfo=function(){i.stream={},i.stream.headerSize=l(4),i.stream.headerVesion=l(4),i.stream.reserved=l(4),i.stream.validFields=l(4),i.stream.timeBetweenFrames=l(4),i.stream.dataType=function(e,t){for(var n=[],o=0;o<e;o++)n.push(String.fromCharCode(l(1)));return(t?n.reverse():n).join("")}(4,!0),i.stream.flags=l(4),i.stream.profile=l(4),i.stream.level=l(4),i.stream.compatibility=l(4),i.stream.constrains=l(8),i.stream.frameCount=l(4),i.stream.hasKeyFrame=(i.stream.flags&h.StreamInfoFlags.HasKeyFrame)===h.StreamInfoFlags.HasKeyFrame},i.retrieveData=function(){i.data=new Uint8Array(a,i.headerSize,i.dataSize)},i.parseDynamicInformation=function(){var e;if(s(8),e=l(4),l(4)==h.DynamicInfoDataType.HeaderTypeDeviceStateInfo){var t,n,o=e;i.errorCodes=[];for(var r=0;r<o;r++)n=d(),t=l(8),i.errorCodes.push({code:t,guid:n})}}}(h.Type={}).Frame=1,h.Type.Fragment=2,(h.Error={}).NonFatal=1,h.Error.Fatal=2,h.MainHeaderLength=36,h.SizeInfoHeaderLength=32,h.LiveInfoHeaderLength=8,h.PlaybackInfoHeaderLength=8,h.HeaderExtensionSize=1,h.HeaderExtensionLiveEvents=2,h.HeaderExtensionPlaybackEvents=4,h.HeaderExtensionNative=8,h.HeaderExtensionMotionEvents=16,h.HeaderExtensionLocationInfo=32,h.HeaderExtensionStreamInfo=64,h.HeaderExtensionCarouselInfo=128,h.HeaderExtensionDynamicInfo=256,h.HeaderExtensionPlaybackInfo=512,(h.LiveFlags={}).LiveFeed=1,h.LiveFlags.Motion=2,h.LiveFlags.Recording=4,h.LiveFlags.Notification=8,h.LiveFlags.CameraConnectionLost=16,h.LiveFlags.DatabaseFail=32,h.LiveFlags.DiskFull=64,h.LiveFlags.ClientLiveStopped=128,(h.PlaybackFlags={}).Stopped=1,h.PlaybackFlags.Forward=2,h.PlaybackFlags.Backward=4,h.PlaybackFlags.DatabaseStart=16,h.PlaybackFlags.DatabaseEnd=32,h.PlaybackFlags.DatabaseError=64,h.PlaybackFlags.RangeNoData=256,h.PlaybackFlags.OutOfRange=512,(h.DynamicInfoDataType={}).HeaderTypeDeviceStateInfo=0,(h.StreamInfoFlags={}).HasKeyFrame=1,XPMobileSDK.library.ItemHeaderParser=h}(),XPMobileSDK.library.VideoHeaderParser=function(e){var t=this;XPMobileSDK.library.ItemHeaderParser.call(t,e),t.parseMotionInformation=function(){t.motionHeaderSize=readBytes(4),t.motionAmount=readBytes(4)},t.convertToImage=function(){t.type=XPMobileSDK.library.ItemHeaderParser.Type.Frame,t.blob=new Blob([t.data],{type:"image/jpeg"})},t.parseCarouselInfo=function(){t.carousel={},t.carousel.headerSize=readBytes(4),t.carousel.headerVesion=readBytes(4),t.carousel.itemId=getGUID()},t.uuid=t.getGUID(),t.timestamp=new Date(t.readBytes(8)),t.frameNumber=t.readBytes(4),t.dataSize=t.readBytes(4),t.headerSize=t.readBytes(2),e=t.readBytes(2),t.hasSizeInformation=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionSize,t.hasLiveInformation=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionLiveEvents,t.hasPlaybackInformation=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionPlaybackEvents,t.hasNativeData=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionNative,t.hasMotionInformation=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionMotionEvents,t.hasLocationData=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionLocationInfo,t.hasStreamInfo=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionStreamInfo,t.hasCarouselInfo=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionCarouselInfo,t.hasPlaybackInfo=e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionPlaybackInfo,t.hasSizeInformation&&t.parseSizeInformation(),t.hasLiveInformation&&t.parseLiveInformation(),t.hasPlaybackInformation&&t.parsePlaybackInformation(),t.hasNativeData&&t.readBytes(readBytes(4)),t.hasMotionInformation&&t.parseMotionInformation(),t.hasLocationData&&t.readBytes(readBytes(4)),t.hasStreamInfo&&t.parseStreamInfo(),t.hasCarouselInfo&&t.parseCarouselInfo(),t.hasPlaybackInfo&&t.parsePlaybackInfo(),t.dataSize<=0||(t.retrieveData(),t.stream&&"JPEG"!==t.stream.dataType)||t.convertToImage()},XPMobileSDK.library.AudioHeaderParser=function(e){var t=this;XPMobileSDK.library.ItemHeaderParser.call(t,e),t.uuid=t.getGUID(),t.skipBytes(18),e=t.readBytes(2),t.skipBytes(4),e&XPMobileSDK.library.ItemHeaderParser.HeaderExtensionDynamicInfo&&t.parseDynamicInformation()},XPMobileSDK.library.VideoConnectionPool=new function(){function n(e,t){this.id=e,this.videoConnection=t,this.response=void 0,this.count=1,this.pendingCallbacks=[]}this.cameras=[],this.containsCameraByVideoId=function(t,n){return this.cameras.some(e=>e.id===t&&e.videoConnection&&e.videoConnection.videoId===n)},this.addCamera=function(e,t){this.cameras.push(new n(e,t))},this.removeCamera=function(t,n){var e=this.cameras.findIndex(e=>e.id==t&&e.videoConnection&&e.videoConnection.videoId==n);this.cameras.splice(e,1)},this.clear=function(){this.cameras=[]},this.getCameraByVideoId=function(t,n){return this.cameras.find(e=>e.id===t&&e.videoConnection&&e.videoConnection.videoId==n)}.bind(this)},XPMobileSDK.library.VideoPushConnection=function(e,t,n){this.open=function(e,t){l.onStreamSuccess=e||l.onStreamSuccess,l.onStreamError=t||l.onStreamError,g()||(r=XPMobileSDK.requestPushStream(f))},this.close=h,this.send=function(e){var e=XPMobileSDK.library.Bytes.fromBase64(e),t=new ArrayBuffer(a+e.length),n=new Uint8Array(t),n=(n.set(XPMobileSDK.library.Bytes.fromGuid(o.videoId,16)),n.set(XPMobileSDK.library.Bytes.fromInt((new Date).getTime(),8),16),n.set(XPMobileSDK.library.Bytes.fromInt(++c,4),24),n.set(XPMobileSDK.library.Bytes.fromInt(e.length,4),28),n.set(XPMobileSDK.library.Bytes.fromInt(a,2),32),n.set(XPMobileSDK.library.Bytes.fromInt(0,2),34),n.set(e,a),XPMobileSDKSettings.MobileServerURL+XPMobileSDKSettings.videoChanel+"/"+o.videoId+"/"),e={method:"post",contentType:"arraybuffer",postBody:t,onLoading:m,onSuccess:p,onFailure:b};new XPMobileSDK.library.Ajax.Request(n,e)},this.destroy=function(){h(),i&&(i.getTracks().forEach(function(e){e.stop()}),i=null)},this.isOpen=g,this.getMediaStream=function(){return i};var o,r,i,s=this,a=36,c=0,l={onSuccess:function(e){},onError:function(e){},onStreamSuccess:function(e){},onStreamError:function(e){}};function u(e){i=e,l.onSuccess(s)}function d(e){logger.error(e.name),l.onError(e)}function h(){g()&&(r&&(XPMobileSDK.cancelRequest(r),r=null),o)&&(XPMobileSDK.closeStream(o.videoId),o=null)}function f(e,t){r=null,e?(o=e,l.onStreamSuccess(s)):l.onStreamError(t)}function g(){return o||r}function m(e){}function p(e){}function b(e){logger.error("ERROR in ajax request for video push with videoId "+o.videoId)}l.onSuccess=e||l.onSuccess,l.onError=t||l.onError,n?l.onSuccess(s):navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(u).catch(d):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:!0,audio:!1},u,d):logger.warn("Video push not supported!"))},XPMobileSDK.library.AudioPushConnection=function(o,r,e,t){this.open=function(e,t,n){l.onStreamSuccess=e||l.onStreamSuccess,l.onStreamError=t||l.onStreamError,f()||(e={AudioSamplingRate:r||8e3,AudioBitsPerSample:16,timeout:5e3},s=XPMobileSDK.requestAudioStreamIn(o,e,d,h))},this.close=u,this.send=function(e){var t,n;i&&(t=new ArrayBuffer(a+e.length),(n=new Int8Array(t)).set(XPMobileSDK.library.Bytes.fromGuid(i.StreamId,16)),n.set(XPMobileSDK.library.Bytes.fromInt((new Date).getTime(),8),16),n.set(XPMobileSDK.library.Bytes.fromInt(++c,4),24),n.set(XPMobileSDK.library.Bytes.fromInt(e.length,4),28),n.set(XPMobileSDK.library.Bytes.fromInt(a,2),32),n.set(XPMobileSDK.library.Bytes.fromInt(0,2),34),n.set(e,a),n=XPMobileSDKSettings.MobileServerURL+XPMobileSDKSettings.audioChannel+"/"+i.StreamId,e={method:"post","Transfer-Encoding":"chunked",contentType:"arraybuffer",postBody:t,timeout:2e3,responseType:"arraybuffer",onLoading:l.onAjaxLoading,onSuccess:l.onAjaxSuccess,onFailure:l.onAjaxFailure,onTimeout:l.onAjaxFailure},new XPMobileSDK.library.Ajax.Request(n,e))},this.destroy=function(){u()},this.isOpen=f;var i,s,n=this,a=36,c=0,l={onStreamSuccess:function(e){},onStreamError:function(e){},onAjaxLoading:function(){},onAjaxSuccess:function(e){},onAjaxFailure:function(){logger.error("ERROR in ajax request for audio push")}};function u(){f()&&(s&&(XPMobileSDK.cancelRequest(s),s=null),i)&&(XPMobileSDK.closeStream(i.StreamId),i=null)}function d(e,t){s=null,e?(i=e,l.onStreamSuccess(n)):l.onStreamError(t)}function h(e){i=s=null,l.onStreamError(e)}function f(){return i||s}l.onAjaxSuccess=e||l.onAjaxSuccess,l.onAjaxFailure=t||l.onAjaxFailure};class AudioAvailability{static isOutgoingAudioNotSupported(){return!XPMobileSDKSettings.SupportsAudioIn||!XPMobileSDK.features.SupportsOutgoingAudio}static isOutgoingPTTAudioNotSupported(){return!XPMobileSDKSettings.SupportsAudioIn||!XPMobileSDK.features.SupportsOutgoingPTTAudio}static isLiveFeatureNotSupported(){return AudioAvailability.isOutgoingAudioNotSupported()}static isPlaybackFeatureNotSupported(){return AudioAvailability.isOutgoingAudioNotSupported()&&AudioAvailability.isOutgoingPTTAudioNotSupported()}static noAvailableMics(e){return AudioAvailability.isOutgoingAudioNotSupported()||!e||!e.length}static noAvailableSpeakers(e){return AudioAvailability.isOutgoingPTTAudioNotSupported()||!e||!e.length}}_defineProperty(AudioAvailability,"mimecodec","audio/mpeg"),XPMobileSDK.library.AudioAvailability=AudioAvailability;
//# sourceMappingURL=../maps/XPMobileSDK.library.js.map
